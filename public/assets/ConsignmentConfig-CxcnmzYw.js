import{B as ce,b as p,a as S,l as Z,I as g,Z as pe,C as $,D as v,H as l,P as o,_ as P,O as w,U as ge,G as n,$ as f,X as Q,u as D,aK as L,a1 as c}from"./vue-BMJJ5Kg4.js";import{c as m,_ as _e}from"./index-DRv2sWQF.js";const ve={class:"consignment-config"},Ce={class:"card-header"},xe={class:"card-actions"},ye={class:"card-header"},we={class:"card-actions"},be={class:"card-header"},Ve={class:"card-actions"},Ue={class:"card-header"},he={class:"card-actions"},ke={class:"card-header"},Se={class:"card-actions"},Pe={key:0,class:"form-tip",style:{color:"#f56c6c"}},De={key:1,class:"form-tip",style:{color:"#67c23a"}},Le="/admin/ajax/upload",Ee=ce({__name:"ConsignmentConfig",setup(Me){const E=p(!1),G=p(!1),a=S({min_increase:.04,max_increase:.06,service_fee_rate:.03,expire_days:7}),M=p(!1),O=p(!1),x=S({expire_days:7}),T=p(!1),B=p(!1),b=S({unlock_hours:null}),z=p(!1),F=p(!1),_=S({profit_balance_rate:.5,profit_score_rate:.5}),R=p(!1),H=p(!1),r=S({video_url:"",title:"",description:""}),Y=p(),I=p([]),ee=Z(()=>({"X-Requested-With":"XMLHttpRequest"})),le=Z(()=>{const t=a.min_increase||0,e=a.max_increase||0;return(t+e)/2*100}),y=Z(()=>{const t=_.profit_balance_rate||0,e=_.profit_score_rate||0;return t+e}),N=()=>{E.value=!0,Promise.all([m({url:"/admin/content.DrawCountConfig/collectionPriceIncreaseConfig",method:"GET"}),m({url:"/admin/content.DrawCountConfig/consignmentServiceFeeConfig",method:"GET"}),m({url:"/admin/content.DrawCountConfig/consignmentCouponExpireConfig",method:"GET"})]).then(t=>{a.min_increase=t[0].data.min_increase??.04,a.max_increase=t[0].data.max_increase??.06,a.service_fee_rate=t[1].data.service_fee_rate??.03,a.expire_days=t[2].data.expire_days??7}).finally(()=>{E.value=!1})},oe=()=>{if(a.min_increase>a.max_increase){c.warning("最小涨幅不能大于最大涨幅");return}G.value=!0,Promise.all([m({url:"/admin/content.DrawCountConfig/collectionPriceIncreaseConfig",method:"POST",data:{min_increase:a.min_increase,max_increase:a.max_increase}},{showSuccessMessage:!1}),m({url:"/admin/content.DrawCountConfig/consignmentServiceFeeConfig",method:"POST",data:{service_fee_rate:a.service_fee_rate}},{showSuccessMessage:!1}),m({url:"/admin/content.DrawCountConfig/consignmentCouponExpireConfig",method:"POST",data:{expire_days:a.expire_days}},{showSuccessMessage:!1})]).then(()=>{c.success("配置更新成功"),N()}).finally(()=>{G.value=!1})},W=()=>{M.value=!0,m({url:"/admin/content.DrawCountConfig/consignmentExpireDaysConfig",method:"GET"}).then(t=>{x.expire_days=t.data.expire_days??7}).finally(()=>{M.value=!1})},te=()=>{if(x.expire_days<1||x.expire_days>365){c.warning("寄售失败天数必须在1-365天之间");return}O.value=!0,m({url:"/admin/content.DrawCountConfig/consignmentExpireDaysConfig",method:"POST",data:{expire_days:x.expire_days}},{showSuccessMessage:!0}).then(()=>{W()}).finally(()=>{O.value=!1})},X=()=>{T.value=!0,m({url:"/admin/content.DrawCountConfig/consignmentUnlockHoursConfig",method:"GET"}).then(t=>{b.unlock_hours=t.data.unlock_hours??null}).finally(()=>{T.value=!1})},ne=()=>{const t=b.unlock_hours;if(t==null||t<0||t>8760){c.warning("请填写有效的寄售解锁小时数（0-8760）");return}B.value=!0,m({url:"/admin/content.DrawCountConfig/consignmentUnlockHoursConfig",method:"POST",data:{unlock_hours:t}},{showSuccessMessage:!0}).then(()=>{X()}).finally(()=>{B.value=!1})},q=()=>{z.value=!0,m({url:"/admin/content.DrawCountConfig/consignmentSettlementConfig",method:"GET"}).then(t=>{_.profit_balance_rate=t.data.profit_balance_rate??.5,_.profit_score_rate=t.data.profit_score_rate??.5}).finally(()=>{z.value=!1})},ae=()=>{const t=y.value;if(t>1.01||t<.99){c.warning("利润余额分配比例和利润积分分配比例之和必须等于1（100%）");return}F.value=!0,m({url:"/admin/content.DrawCountConfig/consignmentSettlementConfig",method:"POST",data:{profit_balance_rate:_.profit_balance_rate,profit_score_rate:_.profit_score_rate}},{showSuccessMessage:!0}).then(()=>{q()}).finally(()=>{F.value=!1})},j=()=>{R.value=!0,m({url:"/admin/content.DrawCountConfig/liveVideoConfig",method:"GET"}).then(t=>{r.video_url=t.data.video_url??"",r.title=t.data.title??"",r.description=t.data.description??""}).finally(()=>{R.value=!1})},ie=()=>{if(!r.video_url.trim()&&I.value.length===0){c.warning("请填写视频地址或上传视频文件");return}if(r.video_url.trim())try{new URL(r.video_url)}catch{c.warning("请输入有效的视频地址URL");return}H.value=!0,m({url:"/admin/content.DrawCountConfig/liveVideoConfig",method:"POST",data:{video_url:r.video_url,title:r.title,description:r.description}},{showSuccessMessage:!0}).then(()=>{j()}).finally(()=>{H.value=!1})},se=t=>{const e=t.type==="video/mp4"||t.name.toLowerCase().endsWith(".mp4"),u=t.size/1024/1024<100;return e?u?!0:(c.error("上传视频文件大小不能超过100MB!"),!1):(c.error("只能上传MP4格式的视频文件!"),!1)},re=(t,e,u)=>{if(console.log("Upload response:",t),t.code===0||t.code===200||t.code==="0"){let d="";t.data&&t.data.file&&t.data.file.url&&(d=t.data.file.url),d?(d.startsWith("http")||(d=window.location.origin+(d.startsWith("/")?"":"/")+d),r.video_url=d,I.value=[e],c.success("视频上传成功")):(c.warning("上传成功但无法获取文件URL，请手动填写"),console.warn("Cannot find video URL in response:",t))}else{const d=t.msg||t.message||t.error||"上传失败";c.error(d),console.error("Upload failed:",t)}},de=(t,e,u)=>{c.error("视频上传失败，请重试"),console.error("Upload error:",t)},ue=(t,e)=>{I.value=e,e.length===0&&r.video_url.trim()};return N(),W(),q(),X(),j(),(t,e)=>{const u=g("el-button"),d=g("el-alert"),s=g("el-form-item"),C=g("el-input-number"),J=g("el-tag"),fe=g("el-divider"),V=g("el-form"),U=g("el-card"),h=g("el-col"),A=g("el-row"),K=g("el-input"),me=g("el-upload"),k=pe("loading");return v(),$("div",ve,[l(A,{gutter:20},{default:o(()=>[l(h,{xs:24,lg:12},{default:o(()=>[l(U,{class:"config-card",shadow:"hover"},{header:o(()=>[n("div",Ce,[e[13]||(e[13]=n("span",{class:"card-title"},"藏品价格上涨配置",-1)),n("div",xe,[l(u,{size:"small",onClick:N,loading:E.value,icon:D(L)},{default:o(()=>e[11]||(e[11]=[f("刷新")])),_:1},8,["loading","icon"]),l(u,{size:"small",type:"primary",onClick:oe,loading:G.value},{default:o(()=>e[12]||(e[12]=[f("保存")])),_:1},8,["loading"])])])]),default:o(()=>[P((v(),w(V,{model:a,"label-width":"140px"},{default:o(()=>[l(s,{label:"配置说明"},{default:o(()=>[l(d,{type:"info",closable:!1,"show-icon":""},{default:o(()=>e[14]||(e[14]=[n("div",null,"商品每次被买走后，价格会自动上涨（在最小涨幅和最大涨幅之间随机）",-1),n("div",{class:"alert-tip"},"例如：最小涨幅4%，最大涨幅6%，则每次购买后价格会在原价基础上上涨4%-6%之间（随机，平均5.5%）",-1),n("div",{class:"alert-tip"},"示例：1000元买入，下次卖出价在 1040~1060元之间",-1)])),_:1})]),_:1}),l(s,{label:"最小涨幅"},{default:o(()=>[l(C,{modelValue:a.min_increase,"onUpdate:modelValue":e[0]||(e[0]=i=>a.min_increase=i),min:0,max:1,step:.01,precision:2,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[15]||(e[15]=n("span",{class:"form-tip"},"例如：0.04 表示 4%",-1))]),_:1}),l(s,{label:"最大涨幅"},{default:o(()=>[l(C,{modelValue:a.max_increase,"onUpdate:modelValue":e[1]||(e[1]=i=>a.max_increase=i),min:0,max:1,step:.01,precision:2,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[16]||(e[16]=n("span",{class:"form-tip"},"例如：0.06 表示 6%",-1))]),_:1}),l(s,{label:"平均涨幅"},{default:o(()=>[l(J,{type:"info",size:"large"},{default:o(()=>[f(Q(le.value.toFixed(2))+"%",1)]),_:1}),e[17]||(e[17]=n("span",{class:"form-tip"},"平均涨幅 = (最小涨幅 + 最大涨幅) / 2",-1))]),_:1}),a.min_increase>a.max_increase?(v(),w(s,{key:0},{default:o(()=>[l(d,{type:"warning",closable:!1,"show-icon":""},{default:o(()=>e[18]||(e[18]=[f("警告：最小涨幅不能大于最大涨幅")])),_:1})]),_:1})):ge("",!0),l(fe),l(s,{label:"寄售服务费费率"},{default:o(()=>[l(C,{modelValue:a.service_fee_rate,"onUpdate:modelValue":e[2]||(e[2]=i=>a.service_fee_rate=i),min:0,max:1,step:.01,precision:2,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[19]||(e[19]=n("span",{class:"form-tip"},"例如：0.03 表示 3%",-1))]),_:1}),l(s,{label:"寄售券有效期"},{default:o(()=>[l(C,{modelValue:a.expire_days,"onUpdate:modelValue":e[3]||(e[3]=i=>a.expire_days=i),min:1,max:365,step:1,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[20]||(e[20]=n("span",{class:"form-tip"},"天（用户购买商品后获得的寄售券有效期天数）",-1))]),_:1})]),_:1},8,["model"])),[[k,E.value]])]),_:1})]),_:1}),l(h,{xs:24,lg:12},{default:o(()=>[l(U,{class:"config-card",shadow:"hover"},{header:o(()=>[n("div",ye,[e[23]||(e[23]=n("span",{class:"card-title"},"寄售解锁配置",-1)),n("div",we,[l(u,{size:"small",onClick:X,loading:T.value,icon:D(L)},{default:o(()=>e[21]||(e[21]=[f("刷新")])),_:1},8,["loading","icon"]),l(u,{size:"small",type:"primary",onClick:ne,loading:B.value},{default:o(()=>e[22]||(e[22]=[f("保存")])),_:1},8,["loading"])])])]),default:o(()=>[P((v(),w(V,{model:b,"label-width":"140px"},{default:o(()=>[l(s,{label:"配置说明"},{default:o(()=>[l(d,{type:"info",closable:!1,"show-icon":""},{default:o(()=>e[24]||(e[24]=[n("div",null,"购买后需等待指定小时数才能上架寄售。此配置必须在后台显式设置，系统不使用默认硬编码。",-1),n("div",{class:"alert-tip"},"例如：填写48表示购买后48小时可寄售",-1)])),_:1})]),_:1}),l(s,{label:"解锁小时数"},{default:o(()=>[l(C,{modelValue:b.unlock_hours,"onUpdate:modelValue":e[4]||(e[4]=i=>b.unlock_hours=i),min:0,max:8760,step:1,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[25]||(e[25]=n("span",{class:"form-tip"},"单位：小时，必须显式设置（0-8760）",-1))]),_:1})]),_:1},8,["model"])),[[k,T.value]])]),_:1})]),_:1}),l(h,{xs:24,lg:12},{default:o(()=>[l(U,{class:"config-card",shadow:"hover"},{header:o(()=>[n("div",be,[e[28]||(e[28]=n("span",{class:"card-title"},"寄售失败（流拍）配置",-1)),n("div",Ve,[l(u,{size:"small",onClick:W,loading:M.value,icon:D(L)},{default:o(()=>e[26]||(e[26]=[f("刷新")])),_:1},8,["loading","icon"]),l(u,{size:"small",type:"primary",onClick:te,loading:O.value},{default:o(()=>e[27]||(e[27]=[f("保存")])),_:1},8,["loading"])])])]),default:o(()=>[P((v(),w(V,{model:x,"label-width":"140px"},{default:o(()=>[l(s,{label:"配置说明"},{default:o(()=>[l(d,{type:"info",closable:!1,"show-icon":""},{default:o(()=>e[29]||(e[29]=[n("div",null,"寄售商品超过指定天数未售出时，系统会自动标记为流拍失败",-1),n("div",{class:"alert-tip"},"例如：设置为7天，则寄售超过7天未售出的商品会自动标记为流拍失败",-1),n("div",{class:"alert-tip"},"注意：此配置由定时任务每天执行，建议设置为1-365天之间",-1)])),_:1})]),_:1}),l(s,{label:"流拍天数"},{default:o(()=>[l(C,{modelValue:x.expire_days,"onUpdate:modelValue":e[5]||(e[5]=i=>x.expire_days=i),min:1,max:365,step:1,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[30]||(e[30]=n("span",{class:"form-tip"},"天（寄售超过此天数未售出时，自动标记为流拍失败）",-1))]),_:1})]),_:1},8,["model"])),[[k,M.value]])]),_:1})]),_:1})]),_:1}),l(A,{gutter:20,style:{"margin-top":"20px"}},{default:o(()=>[l(h,{xs:24},{default:o(()=>[l(U,{class:"config-card",shadow:"hover"},{header:o(()=>[n("div",Ue,[e[33]||(e[33]=n("span",{class:"card-title"},"直播视频配置",-1)),n("div",he,[l(u,{size:"small",onClick:j,loading:R.value,icon:D(L)},{default:o(()=>e[31]||(e[31]=[f("刷新")])),_:1},8,["loading","icon"]),l(u,{size:"small",type:"primary",onClick:ie,loading:H.value},{default:o(()=>e[32]||(e[32]=[f("保存")])),_:1},8,["loading"])])])]),default:o(()=>[P((v(),w(V,{model:r,"label-width":"120px"},{default:o(()=>[l(s,{label:"配置说明"},{default:o(()=>[l(d,{type:"info",closable:!1,"show-icon":""},{default:o(()=>e[34]||(e[34]=[n("div",null,"配置直播视频，支持MP4格式的视频文件",-1),n("div",{class:"alert-tip"},"可以直接填写视频URL地址，或上传本地视频文件",-1),n("div",{class:"alert-tip"},"示例：http://example.com/video.mp4",-1)])),_:1})]),_:1}),l(s,{label:"视频地址"},{default:o(()=>[l(K,{modelValue:r.video_url,"onUpdate:modelValue":e[6]||(e[6]=i=>r.video_url=i),placeholder:"请输入MP4视频文件的完整URL地址，或使用下方上传功能"},null,8,["modelValue"]),e[37]||(e[37]=n("span",{class:"form-tip"},"可以直接填写URL或上传本地视频文件",-1)),l(me,{ref_key:"videoUploadRef",ref:Y,class:"upload-demo",action:Le,headers:ee.value,limit:1,"file-list":I.value,"on-success":re,"on-error":de,"on-change":ue,"before-upload":se,accept:".mp4,.MP4"},{tip:o(()=>e[36]||(e[36]=[n("div",{class:"el-upload__tip"},"只能上传MP4格式的视频文件，文件大小不超过100MB",-1)])),default:o(()=>[l(u,{size:"small",type:"primary"},{default:o(()=>e[35]||(e[35]=[f("上传视频")])),_:1})]),_:1},8,["headers","file-list"])]),_:1}),l(s,{label:"视频标题"},{default:o(()=>[l(K,{modelValue:r.title,"onUpdate:modelValue":e[7]||(e[7]=i=>r.title=i),placeholder:"请输入视频标题（可选）"},null,8,["modelValue"]),e[38]||(e[38]=n("span",{class:"form-tip"},"显示在直播视频旁的标题文字",-1))]),_:1}),l(s,{label:"视频描述"},{default:o(()=>[l(K,{modelValue:r.description,"onUpdate:modelValue":e[8]||(e[8]=i=>r.description=i),type:"textarea",rows:3,placeholder:"请输入视频描述（可选）"},null,8,["modelValue"]),e[39]||(e[39]=n("span",{class:"form-tip"},"视频的详细描述信息",-1))]),_:1})]),_:1},8,["model"])),[[k,R.value]])]),_:1})]),_:1})]),_:1}),l(A,{gutter:20,style:{"margin-top":"20px"}},{default:o(()=>[l(h,{xs:24},{default:o(()=>[l(U,{class:"config-card",shadow:"hover"},{header:o(()=>[n("div",ke,[e[42]||(e[42]=n("span",{class:"card-title"},"交易结算配置",-1)),n("div",Se,[l(u,{size:"small",onClick:q,loading:z.value,icon:D(L)},{default:o(()=>e[40]||(e[40]=[f("刷新")])),_:1},8,["loading","icon"]),l(u,{size:"small",type:"primary",onClick:ae,loading:F.value},{default:o(()=>e[41]||(e[41]=[f("保存")])),_:1},8,["loading"])])])]),default:o(()=>[P((v(),w(V,{model:_,"label-width":"180px"},{default:o(()=>[l(s,{label:"配置说明"},{default:o(()=>[l(d,{type:"info",closable:!1,"show-icon":""},{default:o(()=>e[43]||(e[43]=[n("div",null,"成功卖出后，系统会自动进行交易结算：",-1),n("div",{class:"alert-tip"},"1. 本金：全额退回给卖家余额",-1),n("div",{class:"alert-tip"},"2. 利润（卖出价 - 买入价）：按配置比例分配，一部分进余额，一部分进积分",-1)])),_:1})]),_:1}),l(s,{label:"利润余额分配比例"},{default:o(()=>[l(C,{modelValue:_.profit_balance_rate,"onUpdate:modelValue":e[9]||(e[9]=i=>_.profit_balance_rate=i),min:0,max:1,step:.01,precision:2,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[44]||(e[44]=n("span",{class:"form-tip"},"例如：0.5 表示 50%",-1))]),_:1}),l(s,{label:"利润积分分配比例"},{default:o(()=>[l(C,{modelValue:_.profit_score_rate,"onUpdate:modelValue":e[10]||(e[10]=i=>_.profit_score_rate=i),min:0,max:1,step:.01,precision:2,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[45]||(e[45]=n("span",{class:"form-tip"},"例如：0.5 表示 50%",-1))]),_:1}),l(s,{label:"比例总和"},{default:o(()=>[l(J,{type:y.value>1.01||y.value<.99?"danger":"success",size:"large"},{default:o(()=>[f(Q((y.value*100).toFixed(2))+"% ",1)]),_:1},8,["type"]),y.value>1.01||y.value<.99?(v(),$("span",Pe," 警告：两个比例之和必须等于1（100%） ")):(v(),$("span",De,"正确：比例总和为100%"))]),_:1})]),_:1},8,["model"])),[[k,z.value]])]),_:1})]),_:1})]),_:1})])}}}),Re=_e(Ee,[["__scopeId","data-v-b16450f8"]]);export{Re as default};
