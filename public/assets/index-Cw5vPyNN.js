import{b as B}from"./baTable-CpxZN4RR.js";import{T as A,a as N}from"./index-B5mnDXNW.js";import{a5 as P,ab as h,c as D,f as v}from"./index-BR6nH71S.js";import{B as R,a as I,a1 as b,I as p,C as S,D as m,O as u,U as y,H as a,u as g,P as l,$ as i,X as s,at as $}from"./vue-DnSQgQf0.js";import"./index-DGD6GkL-.js";const K={class:"default-main ba-table-box"},X=R({name:"finance/rechargeOrder",__name:"index",setup(L){const _=new B(new P("/admin/finance.RechargeOrder/"),{column:[{type:"selection",align:"center",operator:!1},{label:"ID",prop:"id",align:"center",operator:"=",operatorPlaceholder:"ID",width:70},{label:"订单号",prop:"order_no",align:"center",operator:"LIKE",operatorPlaceholder:"模糊查询"},{label:"用户ID",prop:"user_id",align:"center",operator:"=",operatorPlaceholder:"用户ID",width:100},{label:"充值金额",prop:"amount",align:"center",operator:"RANGE",width:120,render:(r=>"¥"+parseFloat(r.amount).toFixed(2))},{label:"支付方式",prop:"payment_type_text",align:"center",operator:"select",operatorOptions:[{label:"银行卡",value:"bank_card"},{label:"支付宝",value:"alipay"},{label:"微信",value:"wechat"},{label:"USDT",value:"usdt"},{label:"线上支付",value:"online"}],width:100},{label:"用户手机号",prop:"user.mobile",align:"center",operator:"LIKE",operatorPlaceholder:"手机号",width:130},{label:"支付通道",prop:"payment_channel",align:"center",operator:"LIKE",operatorPlaceholder:"通道名称",width:150},{label:"订单状态",prop:"status_text",align:"center",operator:"select",operatorOptions:[{label:"待审核",value:"0"},{label:"已通过",value:"1"},{label:"已拒绝",value:"2"}],render:"tag",custom:{待审核:"warning",已通过:"success",已拒绝:"danger",待支付:"primary",线上支付已到账:"success"},width:100},{label:"创建时间",prop:"create_time",align:"center",render:"datetime",sortable:"custom",operator:"RANGE",width:160},{label:"操作",align:"center",width:"200",render:"buttons",buttons:(r=>{const e=[];return e.push({render:"tipButton",name:"read",title:"查看详情",text:"",type:"primary",icon:"fa fa-eye",class:"table-row-read",display:()=>h("read"),click:()=>{C(r)}}),r.status==0&&!(r.payment_type==="online"&&r.audit_remark==="线上支付自动到账")&&e.push({render:"tipButton",name:"approve",title:"审核通过",text:"",type:"success",icon:"fa fa-check",class:"table-row-approve",display:()=>h("approve"),click:()=>{x(r,"approve")}}),r.status==0&&r.payment_type!=="online"&&e.push({render:"tipButton",name:"reject",title:"审核拒绝",text:"",type:"warning",icon:"fa fa-times",class:"table-row-reject",display:()=>h("reject"),click:()=>{x(r,"reject")}}),e}),operator:!1}],dblClickNotEditColumn:[void 0]}),t=I({visible:!1,loading:!1,type:"approve",title:"",form:{id:0,order_no:"",user_id:"",amount:"",payment_type_text:"",payment_screenshot:"",audit_remark:""}}),o=I({visible:!1,data:null}),x=(r,e)=>{t.type=e,t.title=e==="approve"?"审核通过":"审核拒绝",t.form={id:r.id,order_no:r.order_no,user_id:r.user_id,amount:r.amount,payment_type_text:r.payment_type_text||"",payment_screenshot:r.payment_screenshot||"",audit_remark:""},t.visible=!0},U=async()=>{if(t.type==="reject"&&!t.form.audit_remark.trim()){b.warning("拒绝原因不能为空");return}t.loading=!0;try{const r=t.type==="approve"?"/admin/finance.RechargeOrder/approve":"/admin/finance.RechargeOrder/reject",e=await D({url:r,method:"post",data:{id:t.form.id,audit_remark:t.form.audit_remark}});e.code==1?(b.success(e.msg),t.visible=!1,_.getData()):b.error(e.msg)}catch(r){b.error(r.message||"操作失败")}finally{t.loading=!1}},C=async r=>{try{const e=await D({url:"/admin/finance.RechargeOrder/read",method:"get",params:{id:r.id}});e.code==1?(o.data=e.data.row,o.visible=!0):b.error(e.msg)}catch(e){b.error(e.message||"获取详情失败")}};return _.mount(),_.getData(),$("baTable",_),(r,e)=>{const T=p("el-alert"),f=p("el-input"),c=p("el-form-item"),V=p("el-image"),E=p("el-form"),k=p("el-button"),w=p("el-dialog"),d=p("el-descriptions-item"),O=p("el-tag"),j=p("el-descriptions");return m(),S("div",K,[g(_).table.remark?(m(),u(T,{key:0,class:"ba-table-alert",title:g(_).table.remark,type:"info","show-icon":""},null,8,["title"])):y("",!0),a(A,{buttons:["refresh","comSearch","quickSearch","columnDisplay"],"quick-search-placeholder":"快速搜索：订单号/ID/手机号"}),a(N),a(w,{modelValue:t.visible,"onUpdate:modelValue":e[7]||(e[7]=n=>t.visible=n),title:t.title,width:"600px","close-on-click-modal":!1},{footer:l(()=>[a(k,{onClick:e[6]||(e[6]=n=>t.visible=!1)},{default:l(()=>e[11]||(e[11]=[i("取消")])),_:1}),a(k,{type:"primary",onClick:U,loading:t.loading},{default:l(()=>[i(s(t.type==="approve"?"通过":"拒绝"),1)]),_:1},8,["loading"])]),default:l(()=>[a(E,{model:t.form,"label-width":"120px"},{default:l(()=>[a(c,{label:"订单号"},{default:l(()=>[a(f,{modelValue:t.form.order_no,"onUpdate:modelValue":e[0]||(e[0]=n=>t.form.order_no=n),disabled:""},null,8,["modelValue"])]),_:1}),a(c,{label:"用户ID"},{default:l(()=>[a(f,{modelValue:t.form.user_id,"onUpdate:modelValue":e[1]||(e[1]=n=>t.form.user_id=n),disabled:""},null,8,["modelValue"])]),_:1}),a(c,{label:"充值金额"},{default:l(()=>[a(f,{modelValue:t.form.amount,"onUpdate:modelValue":e[2]||(e[2]=n=>t.form.amount=n),disabled:""},{append:l(()=>e[10]||(e[10]=[i("元")])),_:1},8,["modelValue"])]),_:1}),a(c,{label:"支付方式"},{default:l(()=>[a(f,{modelValue:t.form.payment_type_text,"onUpdate:modelValue":e[3]||(e[3]=n=>t.form.payment_type_text=n),disabled:""},null,8,["modelValue"])]),_:1}),t.form.payment_screenshot?(m(),u(c,{key:0,label:"付款截图"},{default:l(()=>[a(V,{src:g(v)(t.form.payment_screenshot),style:{width:"300px",height:"auto"},"preview-src-list":[g(v)(t.form.payment_screenshot)],fit:"contain"},null,8,["src","preview-src-list"])]),_:1})):y("",!0),t.type==="reject"?(m(),u(c,{key:1,label:"审核备注"},{default:l(()=>[a(f,{modelValue:t.form.audit_remark,"onUpdate:modelValue":e[4]||(e[4]=n=>t.form.audit_remark=n),type:"textarea",rows:4,placeholder:"请输入拒绝原因"},null,8,["modelValue"])]),_:1})):(m(),u(c,{key:2,label:"审核备注"},{default:l(()=>[a(f,{modelValue:t.form.audit_remark,"onUpdate:modelValue":e[5]||(e[5]=n=>t.form.audit_remark=n),type:"textarea",rows:4,placeholder:"请输入审核备注（可选）"},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(w,{modelValue:o.visible,"onUpdate:modelValue":e[9]||(e[9]=n=>o.visible=n),title:"充值订单详情",width:"800px","close-on-click-modal":!1},{footer:l(()=>[a(k,{onClick:e[8]||(e[8]=n=>o.visible=!1)},{default:l(()=>e[12]||(e[12]=[i("关闭")])),_:1})]),default:l(()=>[o.data?(m(),u(j,{key:0,column:2,border:""},{default:l(()=>[a(d,{label:"订单号"},{default:l(()=>[i(s(o.data.order_no),1)]),_:1}),a(d,{label:"订单状态"},{default:l(()=>[a(O,{type:o.data.status_color},{default:l(()=>[i(s(o.data.status_text),1)]),_:1},8,["type"])]),_:1}),a(d,{label:"用户ID"},{default:l(()=>[i(s(o.data.user_id),1)]),_:1}),a(d,{label:"充值金额"},{default:l(()=>[i("¥"+s(o.data.amount),1)]),_:1}),a(d,{label:"支付方式"},{default:l(()=>[i(s(o.data.payment_type_text),1)]),_:1}),a(d,{label:"支付通道"},{default:l(()=>[i(s(o.data.payment_channel||"-"),1)]),_:1}),a(d,{label:"用户手机号"},{default:l(()=>{var n;return[i(s(((n=o.data.user)==null?void 0:n.mobile)||"-"),1)]}),_:1}),a(d,{label:"创建时间"},{default:l(()=>[i(s(o.data.create_time_text),1)]),_:1}),o.data.audit_time_text?(m(),u(d,{key:0,label:"审核时间"},{default:l(()=>[i(s(o.data.audit_time_text),1)]),_:1})):y("",!0),o.data.audit_remark?(m(),u(d,{key:1,label:"审核备注"},{default:l(()=>[i(s(o.data.audit_remark),1)]),_:1})):y("",!0),o.data.payment_screenshot?(m(),u(d,{key:2,label:"付款截图",span:2},{default:l(()=>[a(V,{src:g(v)(o.data.payment_screenshot),style:{width:"400px",height:"auto"},"preview-src-list":[g(v)(o.data.payment_screenshot)],fit:"contain"},null,8,["src","preview-src-list"])]),_:1})):y("",!0)]),_:1})):y("",!0)]),_:1},8,["modelValue"])])}}});export{X as default};
