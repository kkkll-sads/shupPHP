import{B as j,b as V,a as S,o as A,I as s,Z as K,C as O,D as B,H as e,P as a,G as k,$ as c,X as _,_ as $,a9 as G,O as H,ai as D,a1 as b}from"./vue-DnSQgQf0.js";import{c as h,_ as R}from"./index-BR6nH71S.js";const X={class:"default-main ba-table-box"},Z={class:"stats-row"},F={class:"table-header mb-4"},J={class:"table-pagination mt-4"},Q=j({__name:"index",setup(W){const y=V(!1),w=V([]),r=S({page:1,limit:10,total:0}),n=S({quickSearch:"",status:"",platform:""}),p=S({total:0,success:0,failed:0,pending:0,today_total:0,today_success:0}),d=async()=>{y.value=!0;try{const l=await h({url:"/admin/system.SmsLog/index",method:"get",params:{page:r.page,limit:r.limit,quickSearch:n.quickSearch,status:n.status,platform:n.platform}});l.data.code===1&&(w.value=l.data.data.list||[],r.total=l.data.data.total||0)}catch(l){console.error(l)}finally{y.value=!1}},v=async()=>{try{const l=await h({url:"/admin/system.SmsLog/stats",method:"get"});l.data.code===1&&Object.assign(p,l.data.data)}catch(l){console.error(l)}},z=()=>{n.quickSearch="",n.status="",n.platform="",r.page=1,d()},q=async l=>{try{await D.confirm("确定删除该条记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=await h({url:"/admin/system.SmsLog/del",method:"post",data:{ids:[l]}});t.data.code===1?(b.success("删除成功"),d(),v()):b.error(t.data.msg||"删除失败")}catch{}},L=async()=>{try{await D.confirm("确定清空全部短信记录吗？此操作不可恢复！","警告",{confirmButtonText:"确定清空",cancelButtonText:"取消",type:"error"});const l=await h({url:"/admin/system.SmsLog/clear",method:"post"});l.data.code===1?(b.success(l.data.msg||"清空成功"),d(),v()):b.error(l.data.msg||"清空失败")}catch{}};return A(()=>{d(),v()}),(l,t)=>{const u=s("el-tag"),I=s("el-alert"),T=s("el-input"),f=s("el-col"),m=s("el-option"),C=s("el-select"),x=s("Icon"),g=s("el-button"),U=s("el-row"),i=s("el-table-column"),E=s("el-table"),M=s("el-pagination"),N=s("el-card"),P=K("loading");return B(),O("div",X,[e(I,{title:"短信发送记录管理",type:"info",closable:!1,class:"mb-4"},{default:a(()=>[k("div",Z,[e(u,null,{default:a(()=>[c("总计: "+_(p.total),1)]),_:1}),e(u,{type:"success"},{default:a(()=>[c("发送成功: "+_(p.success),1)]),_:1}),e(u,{type:"danger"},{default:a(()=>[c("发送失败: "+_(p.failed),1)]),_:1}),e(u,{type:"info"},{default:a(()=>[c("今日发送: "+_(p.today_total),1)]),_:1})])]),_:1}),e(N,{shadow:"hover"},{default:a(()=>[k("div",F,[e(U,{gutter:20,class:"search-row"},{default:a(()=>[e(f,{span:6},{default:a(()=>[e(T,{modelValue:n.quickSearch,"onUpdate:modelValue":t[0]||(t[0]=o=>n.quickSearch=o),placeholder:"搜索手机号/内容",clearable:"",onKeyup:G(d,["enter"])},null,8,["modelValue"])]),_:1}),e(f,{span:4},{default:a(()=>[e(C,{modelValue:n.status,"onUpdate:modelValue":t[1]||(t[1]=o=>n.status=o),placeholder:"发送状态",clearable:""},{default:a(()=>[e(m,{label:"待发送",value:0}),e(m,{label:"发送成功",value:1}),e(m,{label:"发送失败",value:2})]),_:1},8,["modelValue"])]),_:1}),e(f,{span:4},{default:a(()=>[e(C,{modelValue:n.platform,"onUpdate:modelValue":t[2]||(t[2]=o=>n.platform=o),placeholder:"短信平台",clearable:""},{default:a(()=>[e(m,{label:"短信宝",value:"smsbao"}),e(m,{label:"麦讯通",value:"weiwebs"})]),_:1},8,["modelValue"])]),_:1}),e(f,{span:10},{default:a(()=>[e(g,{type:"primary",onClick:d},{default:a(()=>[e(x,{name:"el-icon-Search"}),t[5]||(t[5]=c(" 搜索"))]),_:1}),e(g,{onClick:z},{default:a(()=>[e(x,{name:"el-icon-RefreshLeft"}),t[6]||(t[6]=c(" 重置"))]),_:1}),e(g,{type:"danger",onClick:L,disabled:w.value.length===0},{default:a(()=>[e(x,{name:"el-icon-Delete"}),t[7]||(t[7]=c(" 清空全部"))]),_:1},8,["disabled"])]),_:1})]),_:1})]),$((B(),H(E,{data:w.value,stripe:"",border:"",style:{width:"100%"}},{default:a(()=>[e(i,{prop:"id",label:"ID",width:"80"}),e(i,{prop:"mobile",label:"手机号",width:"130"}),e(i,{prop:"content",label:"短信内容","min-width":"250","show-overflow-tooltip":""}),e(i,{prop:"platform_text",label:"短信平台",width:"100"}),e(i,{prop:"status",label:"发送状态",width:"100",align:"center"},{default:a(({row:o})=>[e(u,{type:o.status===1?"success":o.status===2?"danger":"info"},{default:a(()=>[c(_(o.status_text),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"result_code",label:"返回码",width:"100"}),e(i,{prop:"result_msg",label:"返回信息",width:"150","show-overflow-tooltip":""}),e(i,{prop:"send_time_text",label:"发送时间",width:"170"}),e(i,{prop:"create_time_text",label:"创建时间",width:"170"}),e(i,{label:"操作",width:"100",fixed:"right"},{default:a(({row:o})=>[e(g,{type:"danger",size:"small",link:"",onClick:Y=>q(o.id)},{default:a(()=>t[8]||(t[8]=[c("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[P,y.value]]),k("div",J,[e(M,{"current-page":r.page,"onUpdate:currentPage":t[3]||(t[3]=o=>r.page=o),"page-size":r.limit,"onUpdate:pageSize":t[4]||(t[4]=o=>r.limit=o),"page-sizes":[10,20,50,100],total:r.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:d,onCurrentChange:d},null,8,["current-page","page-size","total"])])]),_:1})])}}}),ae=R(Q,[["__scopeId","data-v-85bad96a"]]);export{ae as default};
