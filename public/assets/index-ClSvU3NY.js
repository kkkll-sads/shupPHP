import{B as S,b as w,I as b,Z as $,C as V,D as d,O as u,U as W,H as r,u as y,P as p,G as m,_ as g,a9 as A,a1 as a,ai as k,at as K}from"./vue-BMJJ5Kg4.js";import{b as N,d as O}from"./baTable-57jWdOQZ.js";import P from"./popupForm-DSlGhZT5.js";import{T as F,a as L}from"./index-DONpsK3B.js";import{x as R,a5 as j,as as h,c as _,_ as q}from"./index-DRv2sWQF.js";import"./validate-CzjpH8Rv.js";import"./index-CqVz8jMs.js";const G={class:"default-main ba-table-box"},H={class:"single-mobile-input"},U=S({name:"user/mobileWhitelist",__name:"index",setup(z){R();const D=w(),f=w(""),x=w(!1),v=()=>{const e=f.value.trim();if(!e){a.warning("请输入手机号");return}if(!/^1[3-9]\d{9}$/.test(e)){a.warning("手机号格式不正确");return}x.value=!0,_({url:"/admin/user.MobileWhitelist/add",method:"post",data:{mobile:e,status:1,remark:"手动添加"}}).then(t=>{t.code===1?(a.success("添加成功"),f.value="",i.getData()):a.error(t.msg||"添加失败")}).catch(t=>{var l,o;a.error(((o=(l=t==null?void 0:t.response)==null?void 0:l.data)==null?void 0:o.msg)||"添加失败")}).finally(()=>{x.value=!1})},T=e=>{var s;if(!e||!e.raw)return;const t=["txt","xlsx","xls","csv"],l=(s=e.name.split(".").pop())==null?void 0:s.toLowerCase();if(!l||!t.includes(l)){a.error("不支持的文件格式，仅支持："+t.join(", "));return}if(e.size>10*1024*1024){a.error("文件大小不能超过 10MB");return}const o=new FormData;o.append("file",e.raw),a.info("正在导入，请稍候..."),_({url:"/admin/user.MobileWhitelist/import",method:"post",data:o}).then(n=>{B(n)}).catch(n=>{M(n)})},B=e=>{if(e.code===1){if(a.success(e.msg||"导入成功"),e.data){const{success_count:t,skip_count:l,error_count:o,errors:s}=e.data;let n=`成功导入 ${t} 条`;if(l>0&&(n+=`，跳过 ${l} 条重复记录`),o>0&&(n+=`，错误 ${o} 条`,s&&s.length>0)){const c=s.slice(0,3).join("；");a.warning("部分错误："+c+(s.length>3?"...":""))}a.info(n)}i.getData()}else a.error(e.msg||"导入失败")},M=e=>{var l,o,s,n,c;let t="导入失败";(o=(l=e==null?void 0:e.response)==null?void 0:l.data)!=null&&o.msg?t+="："+e.response.data.msg:(n=(s=e==null?void 0:e.response)==null?void 0:s.data)!=null&&n.message?t+="："+e.response.data.message:e!=null&&e.message?t+="："+e.message:(c=e==null?void 0:e.response)!=null&&c.statusText?t+="："+e.response.statusText:typeof e=="string"?t+="："+e:t+="：未知错误",a.error(t)},C=()=>{const e=i.getSelectionIds();if(e.length===0){a.warning("请选择要启用的记录");return}k.confirm(`确定要启用选中的 ${e.length} 条记录吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{_({url:"/admin/user.MobileWhitelist/batchStatus",method:"post",data:{ids:e,status:1}}).then(t=>{t.code===1?(a.success("操作成功"),i.getData()):a.error(t.msg||"操作失败")})})},E=()=>{const e=i.getSelectionIds();if(e.length===0){a.warning("请选择要禁用的记录");return}k.confirm(`确定要禁用选中的 ${e.length} 条记录吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{_({url:"/admin/user.MobileWhitelist/batchStatus",method:"post",data:{ids:e,status:0}}).then(t=>{t.code===1?(a.success("操作成功"),i.getData()):a.error(t.msg||"操作失败")})})},i=new N(new j("/admin/user.MobileWhitelist/"),{column:[{type:"selection",align:"center",operator:!1},{label:"ID",prop:"id",align:"center",operator:"=",width:80},{label:"手机号",prop:"mobile",align:"center",operator:"LIKE",operatorPlaceholder:"手机号",width:130},{label:"状态",prop:"status",align:"center",operator:"select",operatorOptions:[{label:"启用",value:"1"},{label:"禁用",value:"0"}],render:"tag",custom:{1:"success",0:"danger"},replaceValue:{1:"启用",0:"禁用"},width:100},{label:"备注",prop:"remark",align:"left",operator:"LIKE",operatorPlaceholder:"备注",showOverflowTooltip:!0},{label:"创建时间",prop:"create_time",align:"center",render:"datetime",sortable:"custom",operator:"RANGE",width:170},{label:"操作",align:"center",width:"100",render:"buttons",buttons:O(["edit","delete"]),operator:!1}]});return i.mount(),i.getData(),K("baTable",i),(e,t)=>{const l=b("el-alert"),o=b("el-input"),s=b("el-button"),n=b("el-upload"),c=$("blur");return d(),V("div",G,[y(i).table.remark?(d(),u(l,{key:0,class:"ba-table-alert",title:y(i).table.remark,type:"info","show-icon":""},null,8,["title"])):W("",!0),r(F,{buttons:["refresh","add","edit","delete","comSearch","quickSearch","columnDisplay"],"quick-search-placeholder":"手机号 / 备注"},{default:p(()=>[m("div",H,[r(o,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=I=>f.value=I),placeholder:"输入手机号",style:{width:"140px"},maxlength:"11",onKeyup:A(v,["enter"])},null,8,["modelValue"]),g((d(),u(s,{type:"success",onClick:v,loading:x.value},{default:p(()=>[r(h,{name:"fa fa-plus"}),t[1]||(t[1]=m("span",{class:"table-header-operate-text"},"添加",-1))]),_:1},8,["loading"])),[[c]])]),r(n,{ref_key:"uploadRef",ref:D,"auto-upload":!1,"show-file-list":!1,accept:".txt,.xlsx,.xls,.csv","on-change":T,class:"mlr-12"},{trigger:p(()=>[g((d(),u(s,{class:"table-header-operate",type:"primary"},{default:p(()=>[r(h,{name:"fa fa-upload"}),t[2]||(t[2]=m("span",{class:"table-header-operate-text"},"批量导入",-1))]),_:1})),[[c]])]),_:1},512),g((d(),u(s,{class:"table-header-operate mlr-12",type:"success",onClick:C},{default:p(()=>[r(h,{name:"fa fa-check"}),t[3]||(t[3]=m("span",{class:"table-header-operate-text"},"批量启用",-1))]),_:1})),[[c]]),g((d(),u(s,{class:"table-header-operate",type:"warning",onClick:E},{default:p(()=>[r(h,{name:"fa fa-ban"}),t[4]||(t[4]=m("span",{class:"table-header-operate-text"},"批量禁用",-1))]),_:1})),[[c]])]),_:1}),r(L),r(P)])}}}),ae=q(U,[["__scopeId","data-v-223c41ea"]]);export{ae as default};
