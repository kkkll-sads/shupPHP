import{b as q,a as J,f as te,_ as L,e as ne,c as W,X as E,Y as U,v as oe,u as se,m as ae}from"./index-BR6nH71S.js";import{H as G,F as X,i as le}from"./footer-CaioOt3i.js";import{o as re,r as ce,a as ue}from"./router-Op2AwQek.js";import{B as M,O as S,D as u,I as _,P as d,G as l,H as c,u as m,X as I,_ as j,C as y,W as F,V as B,N as Z,Y,Z as ie,U as H,a0 as me,ae as pe,aj as K,b as h,l as _e,o as O,ad as Q,w as V,F as z,a8 as de,p as fe,z as ve}from"./vue-DnSQgQf0.js";import"./darkSwitch-BHIsliwO.js";import"./useDark-C9IatcGc.js";const he={class:"userinfo"},ye=["src"],ge={class:"username"},we={class:"user-menus"},be={key:0,class:"user-menu-max-title"},ke=["onClick"],Ae=M({__name:"aside",setup(k){const p=Z(),n=Y(),e=q(),o=J(),s=t=>{typeof t=="string"?n.push({name:t}):re(t)};return(t,a)=>{const f=_("Icon"),r=_("el-button"),A=_("el-button-group"),C=_("el-aside"),x=ie("blur");return u(),S(C,{class:"ba-user-layouts"},{default:d(()=>[l("div",he,[l("div",{onClick:a[0]||(a[0]=g=>s("account/profile")),class:"user-avatar-box"},[l("img",{class:"user-avatar",src:m(te)(m(e).avatar?m(e).avatar:"/static/images/avatar.png"),alt:""},null,8,ye),c(f,{class:"user-avatar-gender",name:m(e).getGenderIcon().name,size:"14",color:m(e).getGenderIcon().color},null,8,["name","color"])]),l("p",ge,I(m(e).nickname),1),c(A,null,{default:d(()=>[j((u(),S(r,{onClick:a[1]||(a[1]=g=>s("account/integral")),class:"userinfo-button-item",title:t.$t("Integral")+" "+m(e).score,size:"default",plain:""},{default:d(()=>[l("span",null,I(t.$t("Integral")+" "+m(e).score),1)]),_:1},8,["title"])),[[x]]),j((u(),S(r,{onClick:a[2]||(a[2]=g=>s("account/balance")),class:"userinfo-button-item",title:t.$t("Balance")+" "+m(e).money,size:"default",plain:""},{default:d(()=>[l("span",null,I(t.$t("Balance")+" "+m(e).money),1)]),_:1},8,["title"])),[[x]])]),_:1})]),l("div",we,[(u(!0),y(B,null,F(m(o).state.viewRoutes,(g,v)=>{var b;return u(),y(B,{key:v},[m(o).state.showHeadline?(u(),y("div",be,I((b=g.meta)==null?void 0:b.title),1)):H("",!0),(u(!0),y(B,null,F(g.children,(w,D)=>{var N,i;return u(),y("div",{key:D,onClick:$=>s(w),class:me(["user-menu-item",m(p).fullPath==w.path?"active":""])},[c(f,{name:(N=w.meta)==null?void 0:N.icon,size:"16",color:"var(--el-text-color-secondary)"},null,8,["name"]),l("span",null,I((i=w.meta)==null?void 0:i.title),1)],10,ke)}),128))],64)}),128))])]),_:1})}}}),Ie=L(Ae,[["__scopeId","data-v-be8e7096"]]),Se=M({__name:"main",setup(k){const p=ne();return(n,e)=>{const o=_("router-view"),s=_("el-main");return u(),S(s,{class:"layout-main"},{default:d(()=>[c(o,null,{default:d(({Component:t})=>[c(pe,{name:m(p).layout.mainAnimation,mode:"out-in"},{default:d(()=>[(u(),S(K(t)))]),_:2},1032,["name"])]),_:1})]),_:1})}}}),Ce=L(Se,[["__scopeId","data-v-bc73de31"]]),$e={key:0,class:"announcement-scroll-container"},Me={class:"announcement-scroll-wrapper"},xe={class:"announcement-scroll-text"},Le=M({__name:"scroll",emits:["pause","resume"],setup(k,{expose:p}){const n=h([]),e=h(0),o=h(null),s=h(1),t=h(!1),a=_e(()=>n.value.length===0?[]:[...n.value,...n.value,...n.value]),f=async()=>{try{const v=await W.get("/api/Announcement/getScrollAnnouncements");v.data.code===1&&(n.value=v.data.data.list)}catch(v){console.error("获取滚动公告失败:",v)}},r=()=>{if(o.value)return;const v=()=>{if(!t.value&&n.value.length>0){e.value-=s.value;const w=n.value.length*300;Math.abs(e.value)>=w&&(e.value=0)}o.value=requestAnimationFrame(v)};o.value=requestAnimationFrame(v)},A=()=>{o.value&&(cancelAnimationFrame(o.value),o.value=null)},C=()=>{t.value=!0},x=()=>{t.value=!1},g=()=>{f(),r()};return O(()=>{g()}),Q(()=>{A()}),V(n,()=>{e.value=0,n.value.length>0?r():A()}),p({pauseScroll:C,resumeScroll:x,refresh:f}),(v,b)=>n.value.length>0?(u(),y("div",$e,[l("div",Me,[l("div",{class:"announcement-scroll-content",style:z({transform:`translateX(${e.value}px)`})},[(u(!0),y(B,null,F(a.value,(w,D)=>(u(),y("div",{key:`${w.id}-${D}`,class:"announcement-scroll-item"},[b[0]||(b[0]=l("svg",{class:"announcement-scroll-icon",viewBox:"0 0 24 24",width:"16",height:"16"},[l("path",{fill:"currentColor",d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,6V8H13V6H11M11,10V18H13V10H11Z"})],-1)),l("span",xe,I(w.title),1),b[1]||(b[1]=l("span",{class:"announcement-scroll-separator"},"·",-1))]))),128))],4)])])):H("",!0)}}),De=L(Le,[["__scopeId","data-v-f0597add"]]),Ne={class:"announcement-popup-header"},Pe={class:"announcement-popup-title"},Re={class:"announcement-popup-content"},Be=["innerHTML"],He={class:"announcement-popup-footer"},ze={key:1,class:"announcement-popup-countdown"},Te=M({__name:"popup",setup(k){const p=h(!1),n=h(!1),e=h(0),o=h(null),s=h([]),t=h(0),a=h(0);let f=null,r=null;const A=async()=>{try{const i=await W.get("/api/Announcement/getPopupAnnouncements");i.data.code===1&&(s.value=i.data.data.list,s.value.length>0&&C())}catch(i){console.error("获取弹出公告失败:",i)}},C=()=>{t.value>=s.value.length||(o.value=s.value[t.value],a.value=o.value.popup_delay||3e3,p.value=!0,n.value=!1,e.value=Math.ceil(a.value/1e3),r=window.setTimeout(()=>{n.value=!0,x()},a.value))},x=()=>{f=window.setInterval(()=>{e.value--,e.value<=0&&g()},1e3)},g=()=>{f&&(clearInterval(f),f=null)},v=()=>{p.value=!1,g(),r&&(clearTimeout(r),r=null),t.value++,setTimeout(()=>{C()},500)},b=()=>{n.value&&v()},w=()=>{const i=localStorage.getItem("shown_announcements");if(i){const $=JSON.parse(i),P=new Date().toDateString(),R=$.filter(T=>T.date===P);localStorage.setItem("shown_announcements",JSON.stringify(R)),s.value=s.value.filter(T=>!R.some(ee=>ee.id===T.id))}},D=i=>{const $=localStorage.getItem("shown_announcements")||"[]",P=JSON.parse($),R=new Date().toDateString();P.push({id:i,date:R}),localStorage.setItem("shown_announcements",JSON.stringify(P))},N=()=>{A()};return V(s,i=>{w(),i.length>0&&!p.value&&C()},{immediate:!0}),O(()=>{N()}),Q(()=>{g(),r&&clearTimeout(r)}),V(p,i=>{!i&&o.value&&D(o.value.id)}),(i,$)=>p.value?(u(),y("div",{key:0,class:"announcement-popup-overlay",onClick:de(b,["self"])},[l("div",{class:"announcement-popup",style:z({animationDelay:a.value+"ms"})},[l("div",Ne,[l("h3",Pe,I(o.value.title),1),n.value?(u(),y("button",{key:0,class:"announcement-popup-close",onClick:v,title:"关闭"},$[0]||($[0]=[l("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[l("path",{fill:"currentColor",d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})],-1)]))):H("",!0)]),l("div",Re,[l("div",{innerHTML:o.value.content},null,8,Be)]),l("div",He,[n.value?(u(),y("button",{key:0,class:"announcement-popup-btn announcement-popup-btn-primary",onClick:v}," 我知道了 ")):(u(),y("div",ze,I(e.value)+"秒后可关闭 ",1))])],4)])):H("",!0)}}),Fe=L(Te,[["__scopeId","data-v-963092f6"]]),Ve=M({__name:"default",setup(k){return(p,n)=>{const e=_("el-col"),o=_("el-row"),s=_("el-scrollbar"),t=_("el-container");return u(),S(t,{class:"is-vertical"},{default:d(()=>[c(G),c(De),c(s,{style:z(m(U)),ref_key:"layoutMainScrollbarRef",ref:E},{default:d(()=>[c(o,{class:"frontend-footer-brother",justify:"center"},{default:d(()=>[c(e,{class:"user-layouts",span:16,xs:24},{default:d(()=>[c(Ie,{class:"hidden-sm-and-down"}),c(Ce)]),_:1})]),_:1}),c(X)]),_:1},8,["style"]),c(Fe)]),_:1})}}}),Oe=L(Ve,[["__scopeId","data-v-e441c789"]]),je=M({__name:"disable",setup(k){return(p,n)=>{const e=_("el-alert"),o=_("el-col"),s=_("el-row"),t=_("el-scrollbar"),a=_("el-container");return u(),S(a,{class:"is-vertical"},{default:d(()=>[c(G),c(t,{style:z(m(U)),ref_key:"layoutMainScrollbarRef",ref:E},{default:d(()=>[c(s,{class:"frontend-footer-brother",justify:"center"},{default:d(()=>[c(o,{class:"user-layouts",span:16,xs:24},{default:d(()=>[c(e,{center:!0,title:p.$t("Member center disabled"),type:"error"},null,8,["title"])]),_:1})]),_:1}),c(X)]),_:1},8,["style"])]),_:1})}}}),qe=L(je,[["__scopeId","data-v-88053b8c"]]);function Je(){return new Promise(k=>{k({type:"continue"})})}const Ye=M({components:{Default:Oe,Disable:qe},__name:"user",setup(k){const{t:p}=oe.useI18n(),n=Z(),e=Y(),o=q(),s=se(),t=J();return O(async()=>{const a=await Je();if(a.type=="break")return;if(a.type=="reload")return window.location.href=a.url;if(!o.token)return e.push({name:"userLogin"});const f=()=>{if(a.type=="jump")return e.push(a.url);if(n.params.to){const r=JSON.parse(n.params.to);if(r.path!=ae){let A=fe(r.query)?{}:r.query;ce({path:r.path,query:A});return}}if(n.name=="userMainLoading"){let r=ue(t.state.viewRoutes);r?e.push({path:r.path}):ve({type:"error",message:p("No route found to jump~")})}};s.userInitialize?f():le(f,!0),document.body.clientWidth<1024?t.setShrink(!0):t.setShrink(!1)}),(a,f)=>(u(),S(K(m(t).state.layoutMode)))}});export{Ye as default};
