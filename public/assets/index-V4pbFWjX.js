import{B as K,b as M,a as q,o as L,I as r,Z as O,C as R,D as S,H as e,_ as X,G as y,P as t,X as g,O as P,U as Z,$ as h,u as U,aJ as Q,aK as W,aL as Y,a1 as f}from"./vue-BMJJ5Kg4.js";import{a5 as ee,_ as te}from"./index-DRv2sWQF.js";const ae={class:"default-main ba-table-box"},le={style:{color:"#67c23a","font-weight":"bold"}},ne={style:{color:"#e6a23c"}},oe={style:{color:"#f56c6c","font-weight":"bold"}},ie={style:{"font-size":"12px"}},de={class:"pagination-container",style:{"margin-top":"15px","text-align":"right"}},se=K({name:"collection/miningMachine",__name:"index",setup(re){const V=new ee("/admin/collection.MiningMachine/"),k=M(!1),B=M([]),b=M([]),m=q({page:1,limit:20,total:0}),i=q({total_count:0,total_value:0,today_count:0,user_count:0,today_dividend_balance:0,today_dividend_score:0,total_dividend_balance:0,total_dividend_score:0,dividend_trend:[]}),o=q({mobile:"",user_id:void 0,item_id:void 0,quick_search:""}),z=async()=>{var d,a,u,s,_,p,w,n,x;try{const c=await V.postData("statistics",{});c.code===1&&(i.total_count=((d=c.data)==null?void 0:d.total_count)||0,i.total_value=((a=c.data)==null?void 0:a.total_value)||0,i.today_count=((u=c.data)==null?void 0:u.today_count)||0,i.user_count=((s=c.data)==null?void 0:s.user_count)||0,i.today_dividend_balance=((_=c.data)==null?void 0:_.today_dividend_balance)||0,i.today_dividend_score=((p=c.data)==null?void 0:p.today_dividend_score)||0,i.total_dividend_balance=((w=c.data)==null?void 0:w.total_dividend_balance)||0,i.total_dividend_score=((n=c.data)==null?void 0:n.total_dividend_score)||0,i.dividend_trend=((x=c.data)==null?void 0:x.dividend_trend)||[])}catch(c){console.error("获取统计数据失败:",c)}},v=async()=>{var d,a;k.value=!0;try{const u={page:m.page,limit:m.limit};o.mobile&&(u.mobile=o.mobile),o.user_id&&(u.user_id=o.user_id),o.item_id&&(u.item_id=o.item_id),o.quick_search&&(u.quick_search=o.quick_search);const s=await V.index(u);s.code===1?(B.value=((d=s.data)==null?void 0:d.list)||[],m.total=((a=s.data)==null?void 0:a.total)||0):f.error(s.msg||"查询失败")}catch(u){f.error(u.message||"查询失败")}finally{k.value=!1}},T=()=>{o.mobile="",o.user_id=void 0,o.item_id=void 0,o.quick_search="",m.page=1,v()},$=d=>{b.value=d.map(a=>a.id)},j=async d=>{try{const a=await V.postData("cancelMining",{user_collection_id:d.id});a.code===1?(f.success(a.msg||"操作成功"),v(),z()):f.error(a.msg||"操作失败")}catch(a){f.error(a.message||"操作失败")}},A=async()=>{if(b.value.length===0){f.warning("请先选择要操作的记录");return}try{const d=await V.postData("batchCancelMining",{ids:b.value});d.code===1?(f.success(d.msg||"操作成功"),b.value=[],v(),z()):f.error(d.msg||"操作失败")}catch(d){f.error(d.message||"操作失败")}};return L(()=>{z(),v()}),(d,a)=>{const u=r("el-alert"),s=r("el-statistic"),_=r("el-card"),p=r("el-col"),w=r("el-row"),n=r("el-table-column"),x=r("el-table"),c=r("el-input"),C=r("el-form-item"),N=r("el-input-number"),I=r("el-icon"),D=r("el-button"),E=r("el-popconfirm"),F=r("el-form"),G=r("el-tag"),H=r("el-pagination"),J=O("loading");return S(),R("div",ae,[e(u,{class:"ba-table-alert",title:"矿机管理 - 管理已转为矿机状态的藏品，支持查看分红统计和批量操作",type:"info","show-icon":""}),e(w,{gutter:20,style:{"margin-bottom":"15px"}},{default:t(()=>[e(p,{span:6},{default:t(()=>[e(_,{shadow:"hover"},{default:t(()=>[e(s,{title:"矿机总数",value:i.total_count},null,8,["value"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(_,{shadow:"hover"},{default:t(()=>[e(s,{title:"矿机总价值",value:i.total_value,precision:2,prefix:"¥"},null,8,["value"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(_,{shadow:"hover"},{default:t(()=>[e(s,{title:"今日新增",value:i.today_count},null,8,["value"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(_,{shadow:"hover"},{default:t(()=>[e(s,{title:"涉及用户数",value:i.user_count},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(w,{gutter:20,style:{"margin-bottom":"15px"}},{default:t(()=>[e(p,{span:6},{default:t(()=>[e(_,{shadow:"hover",class:"dividend-card"},{default:t(()=>[e(s,{title:"今日分红(余额)",value:i.today_dividend_balance,precision:2,prefix:"¥","value-style":"color: #67c23a"},null,8,["value"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(_,{shadow:"hover",class:"dividend-card"},{default:t(()=>[e(s,{title:"今日分红(积分)",value:i.today_dividend_score,"value-style":"color: #e6a23c"},null,8,["value"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(_,{shadow:"hover",class:"dividend-card"},{default:t(()=>[e(s,{title:"累计分红(余额)",value:i.total_dividend_balance,precision:2,prefix:"¥","value-style":"color: #409eff"},null,8,["value"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(_,{shadow:"hover",class:"dividend-card"},{default:t(()=>[e(s,{title:"累计分红(积分)",value:i.total_dividend_score,"value-style":"color: #909399"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(_,{shadow:"never",style:{"margin-bottom":"15px"}},{header:t(()=>a[6]||(a[6]=[y("span",{style:{"font-weight":"bold"}},"近7日分红趋势",-1)])),default:t(()=>[e(x,{data:i.dividend_trend,stripe:"",size:"small"},{default:t(()=>[e(n,{prop:"date",label:"日期",align:"center",width:"100"}),e(n,{prop:"count",label:"分红笔数",align:"center",width:"100"}),e(n,{prop:"balance",label:"余额分红(元)",align:"center"},{default:t(({row:l})=>[y("span",le,"¥"+g(l.balance),1)]),_:1}),e(n,{prop:"score",label:"积分分红",align:"center"},{default:t(({row:l})=>[y("span",ne,g(l.score),1)]),_:1})]),_:1},8,["data"])]),_:1}),e(_,{class:"search-card",shadow:"never",style:{"margin-bottom":"15px"}},{default:t(()=>[e(F,{model:o,inline:""},{default:t(()=>[e(C,{label:"手机号"},{default:t(()=>[e(c,{modelValue:o.mobile,"onUpdate:modelValue":a[0]||(a[0]=l=>o.mobile=l),placeholder:"请输入手机号",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),e(C,{label:"用户ID"},{default:t(()=>[e(N,{modelValue:o.user_id,"onUpdate:modelValue":a[1]||(a[1]=l=>o.user_id=l),min:0,placeholder:"用户ID","controls-position":"right",style:{width:"100px"}},null,8,["modelValue"])]),_:1}),e(C,{label:"藏品ID"},{default:t(()=>[e(N,{modelValue:o.item_id,"onUpdate:modelValue":a[2]||(a[2]=l=>o.item_id=l),min:0,placeholder:"藏品ID","controls-position":"right",style:{width:"100px"}},null,8,["modelValue"])]),_:1}),e(C,{label:"关键词"},{default:t(()=>[e(c,{modelValue:o.quick_search,"onUpdate:modelValue":a[3]||(a[3]=l=>o.quick_search=l),placeholder:"手机号/昵称/藏品名/确权编号",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(C,null,{default:t(()=>[e(D,{type:"primary",onClick:v,loading:k.value},{default:t(()=>[e(I,null,{default:t(()=>[e(U(Q))]),_:1}),a[7]||(a[7]=h(" 搜索 "))]),_:1},8,["loading"]),e(D,{onClick:T},{default:t(()=>[e(I,null,{default:t(()=>[e(U(W))]),_:1}),a[8]||(a[8]=h(" 重置 "))]),_:1}),b.value.length>0?(S(),P(E,{key:0,title:"确定要批量取消选中的矿机状态吗？",onConfirm:A},{reference:t(()=>[e(D,{type:"danger"},{default:t(()=>[e(I,null,{default:t(()=>[e(U(Y))]),_:1}),h(" 批量取消 ("+g(b.value.length)+") ",1)]),_:1})]),_:1})):Z("",!0)]),_:1})]),_:1},8,["model"])]),_:1}),X((S(),P(x,{data:B.value,stripe:"",border:"",style:{width:"100%"},onSelectionChange:$},{default:t(()=>[e(n,{type:"selection",width:"55",align:"center"}),e(n,{prop:"id",label:"记录ID",width:"80",align:"center"}),e(n,{prop:"user_id",label:"用户ID",width:"80",align:"center"}),e(n,{prop:"mobile",label:"手机号",width:"130",align:"center"}),e(n,{prop:"nickname",label:"昵称",width:"100",align:"center"}),e(n,{prop:"item_id",label:"藏品ID",width:"80",align:"center"}),e(n,{prop:"item_title",label:"藏品名称","min-width":"150",align:"center"}),e(n,{prop:"buy_price",label:"购买价格",width:"100",align:"center"},{default:t(({row:l})=>[y("span",oe,"¥"+g(l.buy_price),1)]),_:1}),e(n,{prop:"current_price",label:"当前价格",width:"100",align:"center"},{default:t(({row:l})=>[h(" ¥"+g(l.current_price),1)]),_:1}),e(n,{prop:"session_title",label:"所属专场",width:"120",align:"center"}),e(n,{prop:"mining_start_time_text",label:"矿机启动时间",width:"160",align:"center"}),e(n,{prop:"mining_days",label:"运行天数",width:"90",align:"center"},{default:t(({row:l})=>[e(G,{type:"success",size:"small"},{default:t(()=>[h(g(l.mining_days)+" 天",1)]),_:2},1024)]),_:1}),e(n,{prop:"last_dividend_time_text",label:"上次分红时间",width:"160",align:"center"},{default:t(({row:l})=>[h(g(l.last_dividend_time_text||"未分红"),1)]),_:1}),e(n,{prop:"asset_code",label:"确权编号",width:"160",align:"center"},{default:t(({row:l})=>[y("span",ie,g(l.asset_code||"-"),1)]),_:1}),e(n,{label:"操作",width:"100",align:"center",fixed:"right"},{default:t(({row:l})=>[e(E,{title:"确定要取消此藏品的矿机状态吗？",onConfirm:ce=>j(l)},{reference:t(()=>[e(D,{type:"danger",link:"",size:"small"},{default:t(()=>a[9]||(a[9]=[h("取消矿机")])),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[J,k.value]]),y("div",de,[e(H,{"current-page":m.page,"onUpdate:currentPage":a[4]||(a[4]=l=>m.page=l),"page-size":m.limit,"onUpdate:pageSize":a[5]||(a[5]=l=>m.limit=l),"page-sizes":[10,20,50,100],total:m.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"])])])}}}),pe=te(se,[["__scopeId","data-v-40d949dd"]]);export{pe as default};
