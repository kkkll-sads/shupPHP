import{B as oe,am as ie,b as P,l as ae,w as q,I as u,Z as A,O as U,D as _,P as a,_ as Y,G as s,F as re,u as l,a0 as ne,U as v,a9 as se,H as o,C as b,X as p,$ as c,V as R,W as me}from"./vue-BMJJ5Kg4.js";import{v as de,e as ue}from"./index-BHof7fb5.js";import{F as j}from"./index-BuGVnaur.js";const pe={class:"title"},fe={style:{color:"#999","font-size":"12px","margin-top":"5px"}},_e={style:{color:"#999","font-size":"12px","margin-top":"8px"}},ce={key:0},ye={key:1},ge={key:2},ve={style:{"margin-left":"10px",color:"#999"}},be={style:{"margin-left":"10px"}},Ve={style:{"font-size":"12px"}},xe={style:{"margin-left":"10px"}},Ue={style:{"font-size":"12px"}},ke={style:{width:"100%"}},ze={style:{display:"flex","align-items":"center",gap:"10px","flex-wrap":"wrap"}},Se={style:{color:"#606266","font-weight":"500"}},he={style:{"margin-right":"auto"}},Pe={style:{display:"flex","align-items":"center",gap:"10px"}},qe={style:{"font-size":"12px"}},Ce={class:"dialog-footer"},Ae=oe({__name:"popupForm",setup(Ne){const t=ie("baTable"),{t:r}=de.useI18n(),T=ue(),C=P(),y=P([]),V=P(!1),f=P({buy:1,gift:1,gift_product_id:0}),B=ae(()=>{var k,m;const n=((k=t.form.items)==null?void 0:k.cycle_value)||0,e=((m=t.form.items)==null?void 0:m.cycle_type)||"day";return e==="day"?n:e==="month"?n*30:e==="year"?n*365:0});q([()=>{var n;return(n=t.form.items)==null?void 0:n.cycle_value},()=>{var n;return(n=t.form.items)==null?void 0:n.cycle_type}],()=>{t.form.items&&(t.form.items.cycle_days=B.value)},{immediate:!0}),q(()=>t.form.items,n=>{if(n){if(n.stage_income_config)try{const e=typeof n.stage_income_config=="string"?JSON.parse(n.stage_income_config):n.stage_income_config;y.value=Array.isArray(e)?e:[]}catch{y.value=[]}else y.value=[];if(n.gift_rule)try{const e=typeof n.gift_rule=="string"?JSON.parse(n.gift_rule):n.gift_rule;e&&e.enabled&&(V.value=!0,f.value={buy:e.buy||1,gift:e.gift||1,gift_product_id:e.gift_product_id||0})}catch{V.value=!1}n.income_mode||(n.income_mode="period"),n.income_value_type||(n.income_value_type="percent"),n.return_principal===void 0&&(n.return_principal=1),n.compound_interest===void 0&&(n.compound_interest=0),n.daily_income_value===void 0&&(n.daily_income_value=0),n.period_days===void 0&&(n.period_days=30),n.period_income_value===void 0&&(n.period_income_value=0)}},{immediate:!0,deep:!0}),q(y,n=>{t.form.items&&(t.form.items.stage_income_config=JSON.stringify(n))},{deep:!0}),q([V,f],()=>{t.form.items&&(V.value?t.form.items.gift_rule=JSON.stringify({enabled:!0,buy:f.value.buy,gift:f.value.gift,gift_product_id:f.value.gift_product_id}):t.form.items.gift_rule=null)},{deep:!0});const K=()=>{const n=y.value[y.value.length-1],e=n?n.end+1:1;y.value.push({start:e,end:e+29,value:5,type:"percent",description:""})},L=n=>{y.value.splice(n,1)},G={name:[{required:!0,message:r("finance.product.Name is required"),trigger:"blur"}],price:[{required:!0,message:r("finance.product.Price must be numeric"),trigger:"change"}],cycle_value:[{required:!0,message:"请输入周期数值",trigger:"change"}],cycle_type:[{required:!0,message:"请选择周期类型",trigger:"change"}],yield_rate:[{required:!0,message:r("Please input field",{field:r("finance.product.Yield Rate")}),trigger:"change"}],income_mode:[{required:!0,message:"请选择收益模式",trigger:"change"}],income_value_type:[{required:!0,message:"请选择收益值类型",trigger:"change"}],total_amount:[{required:!0,message:r("finance.product.Total amount must be integer"),trigger:"change"}],min_purchase:[{required:!0,message:r("finance.product.Min purchase must be greater than zero"),trigger:"change"}],status:[{required:!0,message:r("finance.product.Status value is incorrect"),trigger:"change"}]};return(n,e)=>{const k=u("el-input"),m=u("el-form-item"),d=u("el-input-number"),E=u("el-col"),z=u("el-option"),I=u("el-select"),H=u("el-row"),S=u("el-divider"),N=u("el-radio-button"),M=u("el-radio-group"),O=u("el-radio"),x=u("el-alert"),h=u("el-button"),w=u("el-switch"),X=u("el-form"),Z=u("el-scrollbar"),Q=u("el-dialog"),ee=A("drag"),le=A("zoom"),te=A("loading");return _(),U(Q,{class:"ba-operate-dialog","close-on-click-modal":!1,"destroy-on-close":!0,"model-value":["Add","Edit"].includes(l(t).form.operate),onClose:l(t).toggleForm},{header:a(()=>[Y((_(),b("div",pe,[c(p(l(t).form.operate?l(r)(String(l(t).form.operate)):""),1)])),[[ee,[".ba-operate-dialog",".el-dialog__header"]],[le,".ba-operate-dialog"]])]),footer:a(()=>[s("div",Ce,[o(h,{onClick:l(t).toggleForm},{default:a(()=>[c(p(l(r)("Cancel")),1)]),_:1},8,["onClick"]),o(h,{type:"primary",onClick:e[27]||(e[27]=D=>l(t).onSubmit(C.value))},{default:a(()=>[c(p(l(r)("Confirm")),1)]),_:1})])]),default:a(()=>[Y((_(),U(Z,{class:"ba-table-form-scrollbar"},{default:a(()=>{var D,J,$,W;return[s("div",{class:ne(["ba-operate-form","ba-"+l(t).form.operate+"-form"]),style:re((J=(D=l(T))==null?void 0:D.layout)!=null&&J.shrink?"":"width: calc(100% - "+(l(t).form.labelWidth||160)/2+"px)")},[l(t).form.loading?v("",!0):(_(),U(X,{key:0,ref_key:"formRef",ref:C,onKeyup:e[26]||(e[26]=se(i=>l(t).onSubmit(C.value),["enter"])),model:l(t).form.items,"label-position":(W=($=l(T))==null?void 0:$.layout)!=null&&W.shrink?"top":"right","label-width":(l(t).form.labelWidth||160)+"px",rules:G},{default:a(()=>[o(m,{prop:"name",label:l(r)("finance.product.Name")},{default:a(()=>[o(k,{modelValue:l(t).form.items.name,"onUpdate:modelValue":e[0]||(e[0]=i=>l(t).form.items.name=i),type:"string",placeholder:l(r)("Please input field",{field:l(r)("finance.product.Name")})},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(j,{label:l(r)("finance.product.Thumbnail"),type:"image",modelValue:l(t).form.items.thumbnail,"onUpdate:modelValue":e[1]||(e[1]=i=>l(t).form.items.thumbnail=i),prop:"thumbnail","input-attr":{returnFullUrl:!0,limit:1}},null,8,["label","modelValue"]),o(m,{prop:"summary",label:l(r)("finance.product.Summary")},{default:a(()=>[o(k,{modelValue:l(t).form.items.summary,"onUpdate:modelValue":e[2]||(e[2]=i=>l(t).form.items.summary=i),type:"textarea",rows:3,placeholder:l(r)("Please input field",{field:l(r)("finance.product.Summary")})},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(m,{prop:"price",label:l(r)("finance.product.Price")},{default:a(()=>[o(d,{modelValue:l(t).form.items.price,"onUpdate:modelValue":e[3]||(e[3]=i=>l(t).form.items.price=i),min:0,step:.01,"controls-position":"right",placeholder:l(r)("Please input field",{field:l(r)("finance.product.Price")})},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(m,{label:"收益周期",required:""},{default:a(()=>[o(H,{gutter:10},{default:a(()=>[o(E,{span:12},{default:a(()=>[o(d,{modelValue:l(t).form.items.cycle_value,"onUpdate:modelValue":e[4]||(e[4]=i=>l(t).form.items.cycle_value=i),min:1,"controls-position":"right",placeholder:"请输入周期数值",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(E,{span:12},{default:a(()=>[o(I,{modelValue:l(t).form.items.cycle_type,"onUpdate:modelValue":e[5]||(e[5]=i=>l(t).form.items.cycle_type=i),placeholder:"选择周期类型",style:{width:"100%"}},{default:a(()=>[o(z,{label:"天",value:"day"}),o(z,{label:"月",value:"month"}),o(z,{label:"年",value:"year"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s("div",fe," 自动计算天数："+p(B.value)+" 天 ",1)]),_:1}),o(m,{prop:"yield_rate",label:l(r)("finance.product.Yield Rate")},{default:a(()=>[o(d,{modelValue:l(t).form.items.yield_rate,"onUpdate:modelValue":e[6]||(e[6]=i=>l(t).form.items.yield_rate=i),min:0,step:.01,precision:2,"controls-position":"right",placeholder:l(r)("Please input field",{field:l(r)("finance.product.Yield Rate")})},null,8,["modelValue","placeholder"]),e[28]||(e[28]=s("span",{style:{"margin-left":"10px",color:"#999"}},"%（年化收益率，用于展示）",-1))]),_:1},8,["label"]),o(S,{"content-position":"left"},{default:a(()=>e[29]||(e[29]=[c("收益发放配置")])),_:1}),o(m,{label:"收益模式",required:"",prop:"income_mode"},{default:a(()=>[o(M,{modelValue:l(t).form.items.income_mode,"onUpdate:modelValue":e[7]||(e[7]=i=>l(t).form.items.income_mode=i)},{default:a(()=>[o(N,{label:"daily"},{default:a(()=>e[30]||(e[30]=[c("每日返息")])),_:1}),o(N,{label:"period"},{default:a(()=>e[31]||(e[31]=[c("周期返息")])),_:1}),o(N,{label:"stage"},{default:a(()=>e[32]||(e[32]=[c("阶段返息")])),_:1})]),_:1},8,["modelValue"]),s("div",_e,[l(t).form.items.income_mode==="daily"?(_(),b("span",ce,"每天自动发放收益")):v("",!0),l(t).form.items.income_mode==="period"?(_(),b("span",ye,"按固定周期发放收益")):v("",!0),l(t).form.items.income_mode==="stage"?(_(),b("span",ge,"按时间阶段发放不同收益")):v("",!0)])]),_:1}),o(m,{label:"收益值类型",required:"",prop:"income_value_type"},{default:a(()=>[o(M,{modelValue:l(t).form.items.income_value_type,"onUpdate:modelValue":e[8]||(e[8]=i=>l(t).form.items.income_value_type=i)},{default:a(()=>[o(O,{label:"percent"},{default:a(()=>e[33]||(e[33]=[c("百分比")])),_:1}),o(O,{label:"fixed"},{default:a(()=>e[34]||(e[34]=[c("固定金额")])),_:1})]),_:1},8,["modelValue"]),s("span",ve,p(l(t).form.items.income_value_type==="percent"?"按投资金额百分比计算":"固定金额"),1)]),_:1}),l(t).form.items.income_mode==="daily"?(_(),U(m,{key:0,label:"每日收益",required:"",prop:"daily_income_value"},{default:a(()=>[o(d,{modelValue:l(t).form.items.daily_income_value,"onUpdate:modelValue":e[9]||(e[9]=i=>l(t).form.items.daily_income_value=i),min:0,step:.01,precision:2,"controls-position":"right",placeholder:"每日返息数值",style:{width:"200px"}},null,8,["modelValue"]),s("span",be,p(l(t).form.items.income_value_type==="percent"?"%":"元"),1),o(x,{type:"info",closable:!1,style:{"margin-top":"10px"}},{title:a(()=>[s("span",Ve," 示例：投资10000元，每日"+p(l(t).form.items.income_value_type==="percent"?"0.1%返10元":"固定返息"),1)]),_:1})]),_:1})):v("",!0),l(t).form.items.income_mode==="period"?(_(),b(R,{key:1},[o(m,{label:"返息周期",required:"",prop:"period_days"},{default:a(()=>[o(d,{modelValue:l(t).form.items.period_days,"onUpdate:modelValue":e[10]||(e[10]=i=>l(t).form.items.period_days=i),min:1,"controls-position":"right",placeholder:"返息周期天数",style:{width:"200px"}},null,8,["modelValue"]),e[35]||(e[35]=s("span",{style:{"margin-left":"10px"}},"天",-1))]),_:1}),o(m,{label:"周期收益",required:"",prop:"period_income_value"},{default:a(()=>[o(d,{modelValue:l(t).form.items.period_income_value,"onUpdate:modelValue":e[11]||(e[11]=i=>l(t).form.items.period_income_value=i),min:0,step:.01,precision:2,"controls-position":"right",placeholder:"每周期返息数值",style:{width:"200px"}},null,8,["modelValue"]),s("span",xe,p(l(t).form.items.income_value_type==="percent"?"%":"元"),1),o(x,{type:"info",closable:!1,style:{"margin-top":"10px"}},{title:a(()=>[s("span",Ue," 每"+p(l(t).form.items.period_days)+"天发放一次收益， "+p(l(t).form.items.income_value_type==="percent"?"按投资金额百分比":"固定金额"),1)]),_:1})]),_:1})],64)):v("",!0),l(t).form.items.income_mode==="stage"?(_(),U(m,{key:2,label:"阶段收益配置",required:""},{default:a(()=>[s("div",ke,[o(h,{onClick:K,type:"primary",size:"small",icon:"Plus",style:{"margin-bottom":"10px"}},{default:a(()=>e[36]||(e[36]=[c(" 添加阶段 ")])),_:1}),(_(!0),b(R,null,me(y.value,(i,F)=>(_(),b("div",{key:F,style:{border:"1px solid #e4e7ed","border-radius":"4px",padding:"15px","margin-bottom":"10px",background:"#f9fafc"}},[s("div",ze,[s("span",Se,"第"+p(F+1)+"阶段",1),o(d,{modelValue:i.start,"onUpdate:modelValue":g=>i.start=g,min:1,placeholder:"开始天",size:"small",style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),e[38]||(e[38]=s("span",null,"至",-1)),o(d,{modelValue:i.end,"onUpdate:modelValue":g=>i.end=g,min:i.start||1,placeholder:"结束天",size:"small",style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue","min"]),e[39]||(e[39]=s("span",null,"天，收益：",-1)),o(d,{modelValue:i.value,"onUpdate:modelValue":g=>i.value=g,min:0,step:.01,precision:2,placeholder:"收益值",size:"small",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"]),o(I,{modelValue:i.type,"onUpdate:modelValue":g=>i.type=g,size:"small",style:{width:"100px"}},{default:a(()=>[o(z,{label:"百分比",value:"percent"}),o(z,{label:"固定",value:"fixed"})]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("span",he,p(i.type==="percent"?"%":"元"),1),o(h,{onClick:g=>L(F),type:"danger",size:"small",icon:"Delete"},{default:a(()=>e[37]||(e[37]=[c("删除")])),_:2},1032,["onClick"])]),o(k,{modelValue:i.description,"onUpdate:modelValue":g=>i.description=g,placeholder:"阶段说明（选填）",size:"small",style:{"margin-top":"10px"}},null,8,["modelValue","onUpdate:modelValue"])]))),128)),y.value.length===0?(_(),U(x,{key:0,type:"warning",closable:!1},{title:a(()=>e[40]||(e[40]=[s("span",{style:{"font-size":"12px"}},"请至少添加一个收益阶段",-1)])),_:1})):v("",!0)])]),_:1})):v("",!0),o(S,{"content-position":"left"},{default:a(()=>e[41]||(e[41]=[c("到期设置")])),_:1}),o(m,{label:"到期返本",prop:"return_principal"},{default:a(()=>[o(w,{modelValue:l(t).form.items.return_principal,"onUpdate:modelValue":e[12]||(e[12]=i=>l(t).form.items.return_principal=i),"active-value":1,"inactive-value":0,"active-text":"是","inactive-text":"否"},null,8,["modelValue"]),e[42]||(e[42]=s("span",{style:{"margin-left":"10px",color:"#999"}},"产品到期后是否返还本金",-1))]),_:1}),o(m,{label:"到期复利",prop:"compound_interest"},{default:a(()=>[o(w,{modelValue:l(t).form.items.compound_interest,"onUpdate:modelValue":e[13]||(e[13]=i=>l(t).form.items.compound_interest=i),"active-value":1,"inactive-value":0,"active-text":"是","inactive-text":"否"},null,8,["modelValue"]),e[44]||(e[44]=s("span",{style:{"margin-left":"10px",color:"#999"}},"到期后本金+收益自动再投资",-1)),l(t).form.items.compound_interest===1?(_(),U(x,{key:0,type:"warning",closable:!1,style:{"margin-top":"10px"}},{title:a(()=>e[43]||(e[43]=[s("span",{style:{"font-size":"12px"}},"开启复利后，到期时会自动创建新订单，金额=本金+累计收益",-1)])),_:1})):v("",!0)]),_:1}),o(S,{"content-position":"left"},{default:a(()=>e[45]||(e[45]=[c("赠送规则")])),_:1}),o(m,{label:"启用赠送",prop:"gift_enabled"},{default:a(()=>[o(w,{modelValue:V.value,"onUpdate:modelValue":e[14]||(e[14]=i=>V.value=i),"active-text":"启用","inactive-text":"关闭"},null,8,["modelValue"])]),_:1}),V.value?(_(),b(R,{key:3},[o(m,{label:"赠送规则"},{default:a(()=>[s("div",Pe,[e[46]||(e[46]=s("span",null,"买",-1)),o(d,{modelValue:f.value.buy,"onUpdate:modelValue":e[15]||(e[15]=i=>f.value.buy=i),min:1,"controls-position":"right",style:{width:"100px"}},null,8,["modelValue"]),e[47]||(e[47]=s("span",null,"送",-1)),o(d,{modelValue:f.value.gift,"onUpdate:modelValue":e[16]||(e[16]=i=>f.value.gift=i),min:1,"controls-position":"right",style:{width:"100px"}},null,8,["modelValue"])]),o(x,{type:"success",closable:!1,style:{"margin-top":"10px"}},{title:a(()=>[s("span",qe," 示例：买"+p(f.value.buy)+"送"+p(f.value.gift)+"，购买"+p(f.value.buy)+"份将额外赠送"+p(f.value.gift)+"份 ",1)]),_:1})]),_:1}),o(m,{label:"赠送产品"},{default:a(()=>[o(d,{modelValue:f.value.gift_product_id,"onUpdate:modelValue":e[17]||(e[17]=i=>f.value.gift_product_id=i),min:0,"controls-position":"right",placeholder:"产品ID",style:{width:"200px"}},null,8,["modelValue"]),e[48]||(e[48]=s("span",{style:{"margin-left":"10px",color:"#999"}},"0表示赠送当前产品",-1))]),_:1})],64)):v("",!0),o(S,{"content-position":"left"},{default:a(()=>e[49]||(e[49]=[c("额度设置")])),_:1}),o(m,{prop:"total_amount",label:l(r)("finance.product.Total Amount")},{default:a(()=>[o(d,{modelValue:l(t).form.items.total_amount,"onUpdate:modelValue":e[18]||(e[18]=i=>l(t).form.items.total_amount=i),min:0,"controls-position":"right",placeholder:l(r)("Please input field",{field:l(r)("finance.product.Total Amount")})},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(m,{prop:"sold_amount",label:l(r)("finance.product.Sold Amount")},{default:a(()=>[o(d,{modelValue:l(t).form.items.sold_amount,"onUpdate:modelValue":e[19]||(e[19]=i=>l(t).form.items.sold_amount=i),min:0,"controls-position":"right",placeholder:l(r)("Please input field",{field:l(r)("finance.product.Sold Amount")})},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(m,{prop:"progress",label:"项目进度"},{default:a(()=>[o(d,{modelValue:l(t).form.items.progress,"onUpdate:modelValue":e[20]||(e[20]=i=>l(t).form.items.progress=i),min:0,max:100,step:.01,precision:2,"controls-position":"right",placeholder:"手动设置项目进度"},null,8,["modelValue"]),e[51]||(e[51]=s("span",{style:{"margin-left":"10px",color:"#999"}},"%（0-100）",-1)),o(x,{type:"info",closable:!1,style:{"margin-top":"10px"}},{title:a(()=>e[50]||(e[50]=[s("span",{style:{"font-size":"12px"}},"可手动设置项目进度百分比，不设置则自动根据销售额计算",-1)])),_:1})]),_:1}),o(m,{prop:"min_purchase",label:l(r)("finance.product.Min Purchase")},{default:a(()=>[o(d,{modelValue:l(t).form.items.min_purchase,"onUpdate:modelValue":e[21]||(e[21]=i=>l(t).form.items.min_purchase=i),min:1,"controls-position":"right",placeholder:l(r)("Please input field",{field:l(r)("finance.product.Min Purchase")})},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(m,{prop:"max_purchase",label:l(r)("finance.product.Max Purchase")},{default:a(()=>[o(d,{modelValue:l(t).form.items.max_purchase,"onUpdate:modelValue":e[22]||(e[22]=i=>l(t).form.items.max_purchase=i),min:0,"controls-position":"right",placeholder:l(r)("Please input field",{field:l(r)("finance.product.Max Purchase")})},null,8,["modelValue","placeholder"]),e[52]||(e[52]=s("span",{style:{"margin-left":"10px",color:"#999"}},"0表示不限",-1))]),_:1},8,["label"]),o(m,{prop:"per_user_limit",label:"每人限购份数"},{default:a(()=>[o(d,{modelValue:l(t).form.items.per_user_limit,"onUpdate:modelValue":e[23]||(e[23]=i=>l(t).form.items.per_user_limit=i),min:0,"controls-position":"right",placeholder:"每人限购份数"},null,8,["modelValue"]),e[54]||(e[54]=s("span",{style:{"margin-left":"10px",color:"#999"}},"0表示不限购",-1)),o(x,{type:"warning",closable:!1,style:{"margin-top":"10px"}},{title:a(()=>e[53]||(e[53]=[s("span",{style:{"font-size":"12px"}},"设置每个用户最多可购买的份数，0表示不限制",-1)])),_:1})]),_:1}),o(j,{label:l(r)("finance.product.Status"),modelValue:l(t).form.items.status,"onUpdate:modelValue":e[24]||(e[24]=i=>l(t).form.items.status=i),type:"radio",prop:"status","input-attr":{border:!0,content:{1:l(r)("Enable"),0:l(r)("Disable")}}},null,8,["label","modelValue","input-attr"]),o(m,{prop:"sort",label:l(r)("finance.product.Sort")},{default:a(()=>[o(d,{modelValue:l(t).form.items.sort,"onUpdate:modelValue":e[25]||(e[25]=i=>l(t).form.items.sort=i),min:0,max:999,"controls-position":"right",placeholder:l(r)("Please input field",{field:l(r)("finance.product.Sort")})},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","label-position","label-width"]))],6)]}),_:1})),[[te,l(t).form.loading]])]),_:1},8,["model-value","onClose"])}}});export{Ae as _};
