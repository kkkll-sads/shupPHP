import{b as N}from"./baTable-57jWdOQZ.js";import{T as P,a as S}from"./index-DONpsK3B.js";import{a5 as $,ab as y,c as j,f as V,T as K}from"./index-DRv2sWQF.js";import{B as L,a as I,a1 as c,I as u,C as q,D as f,O as g,U as v,H as l,u as b,P as t,$ as n,X as d,at as G}from"./vue-BMJJ5Kg4.js";import"./index-CqVz8jMs.js";const H={class:"default-main ba-table-box"},Q=L({name:"user/agentReview",__name:"index",setup(F){const _=new N(new $("/admin/user.AgentReview/"),{column:[{type:"selection",align:"center",operator:!1},{label:"ID",prop:"id",align:"center",operator:"=",operatorPlaceholder:"ID",width:80},{label:"用户ID",prop:"user_id",align:"center",operator:"=",operatorPlaceholder:"用户ID",width:100},{label:"用户名",prop:"username",align:"center",operator:"LIKE",operatorPlaceholder:"模糊查询"},{label:"企业名称",prop:"company_name",align:"center",operator:"LIKE",operatorPlaceholder:"模糊查询"},{label:"企业法人",prop:"legal_person",align:"center",operator:"LIKE",operatorPlaceholder:"模糊查询"},{label:"主体类型",prop:"subject_type",align:"center",operator:!1,render:"tag",custom:{1:"info",2:"primary"},replaceValue:{1:"个体户",2:"企业法人"},width:100},{label:"审核状态",prop:"status",align:"center",operator:!1,render:"tag",custom:{0:"warning",1:"success",2:"danger"},replaceValue:{0:"待审核",1:"已通过",2:"已拒绝"},width:100},{label:"创建时间",prop:"create_time",align:"center",render:"datetime",sortable:"custom",operator:"RANGE",width:160},{label:"审核时间",prop:"audit_time",align:"center",render:"datetime",sortable:"custom",operator:"RANGE",width:160},{label:"操作",align:"center",width:320,render:"buttons",buttons:(o=>{const e=[];return e.push({render:"tipButton",name:"read",title:"查看详情",type:"primary",icon:"fa fa-eye",class:"table-row-read",display:()=>y("read"),click:()=>{U(o)}}),o.status==0&&(e.push({render:"tipButton",name:"approve",title:"审核通过",type:"success",icon:"fa fa-check",class:"table-row-approve",display:()=>y("approve"),click:()=>{w(o,"approve")}}),e.push({render:"tipButton",name:"reject",title:"审核拒绝",type:"danger",icon:"fa fa-times",class:"table-row-reject",display:()=>y("reject"),click:()=>{w(o,"reject")}})),e.push({render:"confirmButton",name:"delete",title:"删除",type:"danger",icon:"fa fa-trash",class:"table-row-delete",display:()=>y("del"),popconfirm:{confirmButtonText:"删除",cancelButtonText:"取消",confirmButtonType:"danger",title:"确定要删除该代理商审核记录吗？"},click:()=>{B(o)}}),e}),operator:!1}],dblClickNotEditColumn:[void 0]}),a=I({visible:!1,loading:!1,type:"approve",title:"",form:{id:"",user_id:"",username:"",company_name:"",legal_person:"",legal_id_number:"",subject_type_text:"",license_image:"",audit_remark:""}}),r=I({visible:!1,data:null}),w=(o,e)=>{a.type=e,a.title=e==="approve"?"审核通过":"审核拒绝",a.form={id:o.id,user_id:o.user_id,username:o.username||"",company_name:o.company_name||"",legal_person:o.legal_person||"",legal_id_number:o.legal_id_number||"",subject_type_text:o.subject_type_text||(o.subject_type==2?"企业法人":"个体户"),license_image:o.license_image||"",audit_remark:""},a.visible=!0},T=async()=>{if(a.type==="reject"&&!a.form.audit_remark.trim()){c.warning("拒绝原因不能为空");return}a.loading=!0;try{const o=a.type==="approve"?"/admin/user.AgentReview/approve":"/admin/user.AgentReview/reject",e=await j({url:o,method:"post",data:{id:a.form.id,audit_remark:a.form.audit_remark}});e.code==1||e.code==0&&(!e.msg||e.msg==="")?(c.success(e.msg||"操作成功"),a.visible=!1,_.getData()):c.error(e.msg||"操作失败")}catch(o){c.error(o.message||"操作失败")}finally{a.loading=!1}},U=async o=>{try{const e=await j({url:"/admin/user.AgentReview/read",method:"get",params:{id:o.id}});e.code==1?(r.data=e.data.row,r.visible=!0):c.error(e.msg||"获取详情失败")}catch(e){c.error(e.message||"获取详情失败")}},B=async o=>{try{const e=await _.api.del([o.id]);e.code==1||e.code==0&&(!e.msg||e.msg==="")?(c.success(e.msg||"删除成功"),_.getData()):c.error(e.msg||"删除失败")}catch(e){c.error(e.message||"删除失败")}},A=o=>({0:"warning",1:"success",2:"danger"})[o]||"info";return _.mount(),_.getData(),G("baTable",_),(o,e)=>{const C=u("el-alert"),p=u("el-input"),m=u("el-form-item"),x=u("el-image"),E=u("el-form"),k=u("el-button"),D=u("el-dialog"),s=u("el-descriptions-item"),h=u("el-tag"),R=u("el-descriptions");return f(),q("div",H,[b(_).table.remark?(f(),g(C,{key:0,class:"ba-table-alert",title:b(_).table.remark,type:"info","show-icon":""},null,8,["title"])):v("",!0),l(P,{buttons:["refresh","comSearch","quickSearch","columnDisplay"],"quick-search-placeholder":"快速搜索：ID/用户名/企业名称/法人"}),l(S),l(D,{modelValue:a.visible,"onUpdate:modelValue":e[10]||(e[10]=i=>a.visible=i),title:a.title,width:"700px","close-on-click-modal":!1},{footer:t(()=>[l(k,{onClick:e[9]||(e[9]=i=>a.visible=!1)},{default:t(()=>e[13]||(e[13]=[n("取消")])),_:1}),l(k,{type:"primary",onClick:T,loading:a.loading},{default:t(()=>[n(d(a.type==="approve"?"通过":"拒绝"),1)]),_:1},8,["loading"])]),default:t(()=>[l(E,{model:a.form,"label-width":"120px"},{default:t(()=>[l(m,{label:"记录ID"},{default:t(()=>[l(p,{modelValue:a.form.id,"onUpdate:modelValue":e[0]||(e[0]=i=>a.form.id=i),disabled:""},null,8,["modelValue"])]),_:1}),l(m,{label:"用户ID"},{default:t(()=>[l(p,{modelValue:a.form.user_id,"onUpdate:modelValue":e[1]||(e[1]=i=>a.form.user_id=i),disabled:""},null,8,["modelValue"])]),_:1}),l(m,{label:"用户名"},{default:t(()=>[l(p,{modelValue:a.form.username,"onUpdate:modelValue":e[2]||(e[2]=i=>a.form.username=i),disabled:""},null,8,["modelValue"])]),_:1}),l(m,{label:"企业名称"},{default:t(()=>[l(p,{modelValue:a.form.company_name,"onUpdate:modelValue":e[3]||(e[3]=i=>a.form.company_name=i),disabled:""},null,8,["modelValue"])]),_:1}),l(m,{label:"企业法人"},{default:t(()=>[l(p,{modelValue:a.form.legal_person,"onUpdate:modelValue":e[4]||(e[4]=i=>a.form.legal_person=i),disabled:""},null,8,["modelValue"])]),_:1}),l(m,{label:"法人证件号"},{default:t(()=>[l(p,{modelValue:a.form.legal_id_number,"onUpdate:modelValue":e[5]||(e[5]=i=>a.form.legal_id_number=i),disabled:""},null,8,["modelValue"])]),_:1}),l(m,{label:"主体类型"},{default:t(()=>[l(p,{modelValue:a.form.subject_type_text,"onUpdate:modelValue":e[6]||(e[6]=i=>a.form.subject_type_text=i),disabled:""},null,8,["modelValue"])]),_:1}),a.form.license_image?(f(),g(m,{key:0,label:"营业执照"},{default:t(()=>[l(x,{src:b(V)(a.form.license_image),style:{width:"400px",height:"auto","max-height":"300px"},"preview-src-list":[b(V)(a.form.license_image)],fit:"contain"},null,8,["src","preview-src-list"])]),_:1})):v("",!0),a.type==="reject"?(f(),g(m,{key:1,label:"审核备注"},{default:t(()=>[l(p,{modelValue:a.form.audit_remark,"onUpdate:modelValue":e[7]||(e[7]=i=>a.form.audit_remark=i),type:"textarea",rows:4,placeholder:"请输入拒绝原因"},null,8,["modelValue"])]),_:1})):(f(),g(m,{key:2,label:"审核备注"},{default:t(()=>[l(p,{modelValue:a.form.audit_remark,"onUpdate:modelValue":e[8]||(e[8]=i=>a.form.audit_remark=i),type:"textarea",rows:4,placeholder:"请输入审核备注（可选）"},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(D,{modelValue:r.visible,"onUpdate:modelValue":e[12]||(e[12]=i=>r.visible=i),title:"代理商审核详情",width:"800px","close-on-click-modal":!1},{footer:t(()=>[l(k,{onClick:e[11]||(e[11]=i=>r.visible=!1)},{default:t(()=>e[14]||(e[14]=[n("关闭")])),_:1})]),default:t(()=>[r.data?(f(),g(R,{key:0,column:2,border:""},{default:t(()=>[l(s,{label:"记录ID"},{default:t(()=>[n(d(r.data.id),1)]),_:1}),l(s,{label:"用户ID"},{default:t(()=>[n(d(r.data.user_id),1)]),_:1}),l(s,{label:"用户名"},{default:t(()=>[n(d(r.data.username||"--"),1)]),_:1}),l(s,{label:"昵称"},{default:t(()=>[n(d(r.data.nickname||"--"),1)]),_:1}),l(s,{label:"手机号"},{default:t(()=>[n(d(r.data.mobile||"--"),1)]),_:1}),l(s,{label:"企业名称"},{default:t(()=>[n(d(r.data.company_name||"--"),1)]),_:1}),l(s,{label:"企业法人"},{default:t(()=>[n(d(r.data.legal_person||"--"),1)]),_:1}),l(s,{label:"法人证件号"},{default:t(()=>[n(d(r.data.legal_id_number||"--"),1)]),_:1}),l(s,{label:"主体类型"},{default:t(()=>[l(h,null,{default:t(()=>[n(d(r.data.subject_type_text||"--"),1)]),_:1})]),_:1}),l(s,{label:"审核状态"},{default:t(()=>[l(h,{type:A(r.data.status)},{default:t(()=>[n(d(r.data.status_text),1)]),_:1},8,["type"])]),_:1}),l(s,{label:"审核时间"},{default:t(()=>[n(d(r.data.audit_time?b(K)(r.data.audit_time):"--"),1)]),_:1}),l(s,{label:"审核备注",span:2},{default:t(()=>[n(d(r.data.audit_remark||"--"),1)]),_:1}),r.data.license_image?(f(),g(s,{key:0,label:"营业执照",span:2},{default:t(()=>[l(x,{src:b(V)(r.data.license_image),style:{width:"400px",height:"auto"},"preview-src-list":[b(V)(r.data.license_image)],fit:"contain"},null,8,["src","preview-src-list"])]),_:1})):v("",!0)]),_:1})):v("",!0)]),_:1},8,["modelValue"])])}}});export{Q as default};
