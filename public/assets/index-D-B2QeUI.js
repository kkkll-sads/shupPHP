import{b as R}from"./baTable-C5P52-5P.js";import{a5 as B,c as I,_ as G}from"./index-BHof7fb5.js";import{T as O,a as $}from"./index-CY3WncDq.js";import{B as K,a as L,o as M,b as q,I as m,C as H,D as w,O as y,U as k,H as e,u as D,P as a,$ as s,X as l,G as g,F as E,a1 as C,at as U}from"./vue-BMJJ5Kg4.js";import"./index-1f7Hqibh.js";const X={class:"default-main ba-table-box"},j={style:{color:"#67c23a","font-weight":"bold"}},J={style:{color:"#67c23a","font-weight":"bold"}},Q=K({name:"collection/consignment",__name:"index",setup(W){const n=L({total:0,status:{},today_new:0,today_sold:0,total_sold_amount:0,today_sold_amount:0,packages:[],package_options:[],package_zones:[]}),N=async()=>{var u;try{const d=await I({url:"/admin/collection.Consignment/stats",method:"get"});if(d.code===1&&((u=d.data)!=null&&u.stats)){const p=d.data.stats;n.total=p.total||0,n.status=p.status||{},n.today_new=p.today_new||0,n.today_sold=p.today_sold||0,n.total_sold_amount=p.total_sold_amount||0,n.today_sold_amount=p.today_sold_amount||0,n.packages=p.packages||[],n.package_options=p.package_options||[],n.package_zones=p.package_zones||[]}}catch(d){console.error("获取统计数据失败:",d)}};M(()=>{N()});const o=q({visible:!1,data:null}),S=async u=>{var d,p;try{const r=await I({url:"/admin/collection.Consignment/detail",method:"get",params:{id:u.id}});r.code===1?(o.value.data=r.data.data,o.value.visible=!0):C.error(r.msg||"获取详情失败")}catch(r){console.error("获取详情失败:",r),C.error((r==null?void 0:r.msg)||((p=(d=r==null?void 0:r.response)==null?void 0:d.data)==null?void 0:p.msg)||"获取详情失败")}},V=u=>({1:"warning",2:"success",3:"info",4:"danger"})[u]||"info",v=new R(new B("/admin/collection.Consignment/"),{pk:"id",column:[{type:"selection",align:"center",operator:!1},{label:"ID",prop:"id",align:"center",width:70,operator:"RANGE",sortable:"custom"},{label:"用户名",prop:"username",align:"center",operator:"LIKE",operatorPlaceholder:"模糊查询"},{label:"手机号",prop:"user_mobile",align:"center",operator:"LIKE",operatorPlaceholder:"模糊查询"},{label:"藏品标题",prop:"item_title",align:"center",operator:"LIKE",operatorPlaceholder:"模糊查询",width:200},{label:"资产包",prop:"package_name",align:"center",operator:"LIKE",operatorPlaceholder:"模糊查询",width:150},{label:"价格分区",prop:"zone_id",align:"center",operator:"=",comSearchRender:"select",comSearchOptions:[{label:"全部",value:""},{label:"分区1",value:1},{label:"分区2",value:2},{label:"分区3",value:3},{label:"分区4",value:4},{label:"分区5",value:5}],width:100},{label:"寄售价格",prop:"price",align:"center",operator:"RANGE",render:"customTemplate",customTemplate:u=>`¥${parseFloat(u.price).toFixed(2)}`,width:100},{label:"原价",prop:"original_price",align:"center",operator:"RANGE",render:"customTemplate",customTemplate:u=>`¥${parseFloat(u.original_price).toFixed(2)}`,width:100},{label:"手续费",prop:"service_fee",align:"center",render:"customTemplate",customTemplate:u=>`¥${parseFloat(u.service_fee).toFixed(2)}`,width:90},{label:"使用券",prop:"coupon_used",align:"center",render:"tag",replaceValue:{0:"否",1:"是"},custom:{0:"info",1:"success"},width:80},{label:"状态",prop:"status",align:"center",operator:"=",comSearchRender:"select",comSearchOptions:[{label:"全部",value:""},{label:"寄售中",value:1},{label:"已售出",value:2},{label:"流拍",value:3},{label:"已取消",value:4}],render:"tag",replaceValue:{1:"寄售中",2:"已售出",3:"流拍",4:"已取消"},custom:{1:"warning",2:"success",3:"info",4:"danger"},width:90},{label:"创建时间",prop:"create_time",align:"center",render:"datetime",operator:"RANGE",sortable:"custom",width:160},{label:"成交时间",prop:"sold_time",align:"center",render:"datetime",operator:"RANGE",sortable:"custom",width:160},{label:"操作",align:"center",width:100,render:"buttons",buttons:(u=>[{name:"detail",text:"详情",type:"primary",icon:"fa fa-info-circle",render:"basicButton",click:()=>S(u)}]),operator:!1}],dblClickNotEditColumn:["all"]},{defaultItems:{}});return v.mount(),v.getData(),U("baTable",v),(u,d)=>{var z,F;const p=m("el-alert"),r=m("el-statistic"),_=m("el-card"),f=m("el-col"),x=m("el-row"),i=m("el-table-column"),h=m("el-tag"),T=m("el-table"),c=m("el-descriptions-item"),A=m("el-descriptions"),P=m("el-dialog");return w(),H("div",X,[D(v).table.remark?(w(),y(p,{key:0,class:"ba-table-alert",title:D(v).table.remark,type:"info","show-icon":""},null,8,["title"])):k("",!0),e(x,{gutter:16,style:{"margin-bottom":"15px"}},{default:a(()=>[e(f,{span:4},{default:a(()=>[e(_,{shadow:"hover",class:"stat-card"},{default:a(()=>[e(r,{title:"总记录",value:n.total},null,8,["value"])]),_:1})]),_:1}),e(f,{span:4},{default:a(()=>[e(_,{shadow:"hover",class:"stat-card stat-warning"},{default:a(()=>{var t,b;return[e(r,{title:"寄售中",value:((b=(t=n.status)==null?void 0:t[1])==null?void 0:b.count)||0},null,8,["value"])]}),_:1})]),_:1}),e(f,{span:4},{default:a(()=>[e(_,{shadow:"hover",class:"stat-card stat-success"},{default:a(()=>{var t,b;return[e(r,{title:"已售出",value:((b=(t=n.status)==null?void 0:t[2])==null?void 0:b.count)||0},null,8,["value"])]}),_:1})]),_:1}),e(f,{span:4},{default:a(()=>[e(_,{shadow:"hover",class:"stat-card stat-info"},{default:a(()=>{var t,b;return[e(r,{title:"流拍",value:((b=(t=n.status)==null?void 0:t[3])==null?void 0:b.count)||0},null,8,["value"])]}),_:1})]),_:1}),e(f,{span:4},{default:a(()=>[e(_,{shadow:"hover",class:"stat-card"},{default:a(()=>[e(r,{title:"今日新增",value:n.today_new||0},null,8,["value"])]),_:1})]),_:1}),e(f,{span:4},{default:a(()=>[e(_,{shadow:"hover",class:"stat-card stat-success"},{default:a(()=>[e(r,{title:"今日成交",value:n.today_sold||0},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(x,{gutter:16,style:{"margin-bottom":"15px"}},{default:a(()=>[e(f,{span:8},{default:a(()=>[e(_,{shadow:"hover",class:"stat-card"},{default:a(()=>[e(r,{title:"累计成交额",value:n.total_sold_amount||0,precision:2,prefix:"¥","value-style":"color: #67c23a"},null,8,["value"])]),_:1})]),_:1}),e(f,{span:8},{default:a(()=>[e(_,{shadow:"hover",class:"stat-card"},{default:a(()=>[e(r,{title:"今日成交额",value:n.today_sold_amount||0,precision:2,prefix:"¥","value-style":"color: #409eff"},null,8,["value"])]),_:1})]),_:1}),e(f,{span:8},{default:a(()=>[e(_,{shadow:"hover",class:"stat-card"},{default:a(()=>{var t;return[e(r,{title:"资产包数",value:((t=n.packages)==null?void 0:t.length)||0},null,8,["value"])]}),_:1})]),_:1})]),_:1}),((z=n.package_zones)==null?void 0:z.length)>0?(w(),y(_,{key:1,shadow:"never",style:{"margin-bottom":"15px"}},{header:a(()=>d[1]||(d[1]=[g("span",{style:{"font-weight":"bold"}},"资产包分区统计 (TOP 30)",-1)])),default:a(()=>[e(T,{data:n.package_zones,stripe:"",size:"small","max-height":"300"},{default:a(()=>[e(i,{prop:"name",label:"资产包+分区","min-width":"200","show-overflow-tooltip":""}),e(i,{prop:"count",label:"总数",align:"center",width:"70"}),e(i,{prop:"listing_count",label:"寄售中",align:"center",width:"70"},{default:a(({row:t})=>[e(h,{type:"warning",size:"small"},{default:a(()=>[s(l(t.listing_count||0),1)]),_:2},1024)]),_:1}),e(i,{prop:"sold_count",label:"已售出",align:"center",width:"70"},{default:a(({row:t})=>[e(h,{type:"success",size:"small"},{default:a(()=>[s(l(t.sold_count||0),1)]),_:2},1024)]),_:1}),e(i,{prop:"total_amount",label:"总金额",align:"center",width:"90"},{default:a(({row:t})=>[g("span",null,"¥"+l(t.total_amount||0),1)]),_:1}),e(i,{prop:"sold_amount",label:"成交额",align:"center",width:"90"},{default:a(({row:t})=>[g("span",j,"¥"+l(t.sold_amount||0),1)]),_:1}),e(i,{prop:"success_rate",label:"成交率",align:"center",width:"70"},{default:a(({row:t})=>[g("span",{style:E({color:t.success_rate>50?"#67c23a":t.success_rate>20?"#e6a23c":"#f56c6c"})},l(t.success_rate||0)+"% ",5)]),_:1})]),_:1},8,["data"])]),_:1})):k("",!0),((F=n.packages)==null?void 0:F.length)>0?(w(),y(_,{key:2,shadow:"never",style:{"margin-bottom":"15px"}},{header:a(()=>d[2]||(d[2]=[g("span",{style:{"font-weight":"bold"}},"资产包寄售详细统计 (TOP 30)",-1)])),default:a(()=>[e(T,{data:n.packages,stripe:"",size:"small","max-height":"300"},{default:a(()=>[e(i,{prop:"package_name",label:"资产包名称","min-width":"180",fixed:""}),e(i,{prop:"count",label:"总数",align:"center",width:"70"}),e(i,{prop:"listing_count",label:"寄售中",align:"center",width:"80"},{default:a(({row:t})=>[e(h,{type:"warning",size:"small"},{default:a(()=>[s(l(t.listing_count||0),1)]),_:2},1024)]),_:1}),e(i,{prop:"sold_count",label:"已售出",align:"center",width:"80"},{default:a(({row:t})=>[e(h,{type:"success",size:"small"},{default:a(()=>[s(l(t.sold_count||0),1)]),_:2},1024)]),_:1}),e(i,{prop:"failed_count",label:"流拍",align:"center",width:"70"},{default:a(({row:t})=>[e(h,{type:"info",size:"small"},{default:a(()=>[s(l(t.failed_count||0),1)]),_:2},1024)]),_:1}),e(i,{prop:"cancelled_count",label:"已取消",align:"center",width:"80"},{default:a(({row:t})=>[e(h,{type:"danger",size:"small"},{default:a(()=>[s(l(t.cancelled_count||0),1)]),_:2},1024)]),_:1}),e(i,{prop:"total_amount",label:"总金额",align:"center",width:"100"},{default:a(({row:t})=>[g("span",null,"¥"+l(t.total_amount||0),1)]),_:1}),e(i,{prop:"sold_amount",label:"成交额",align:"center",width:"100"},{default:a(({row:t})=>[g("span",J,"¥"+l(t.sold_amount||0),1)]),_:1}),e(i,{prop:"success_rate",label:"成交率",align:"center",width:"80"},{default:a(({row:t})=>[g("span",{style:E({color:t.success_rate>50?"#67c23a":t.success_rate>20?"#e6a23c":"#f56c6c"})},l(t.success_rate||0)+"% ",5)]),_:1})]),_:1},8,["data"])]),_:1})):k("",!0),e(O,{buttons:["refresh","comSearch","quickSearch","columnDisplay"],"quick-search-placeholder":"快速搜索：ID/资产包名称"}),e($),e(P,{modelValue:o.value.visible,"onUpdate:modelValue":d[0]||(d[0]=t=>o.value.visible=t),title:"寄售详情",width:"800px","close-on-click-modal":!1},{default:a(()=>[o.value.data?(w(),y(A,{key:0,column:2,border:""},{default:a(()=>[e(c,{label:"寄售ID"},{default:a(()=>[s(l(o.value.data.id),1)]),_:1}),e(c,{label:"状态"},{default:a(()=>[e(h,{type:V(o.value.data.status)},{default:a(()=>[s(l(o.value.data.status_text),1)]),_:1},8,["type"])]),_:1}),e(c,{label:"用户名"},{default:a(()=>[s(l(o.value.data.username),1)]),_:1}),e(c,{label:"手机号"},{default:a(()=>[s(l(o.value.data.user_mobile),1)]),_:1}),e(c,{label:"藏品标题",span:2},{default:a(()=>[s(l(o.value.data.item_title),1)]),_:1}),e(c,{label:"场次ID"},{default:a(()=>[s(l(o.value.data.session_id||"无"),1)]),_:1}),e(c,{label:"价格分区ID"},{default:a(()=>[s(l(o.value.data.zone_id||"无"),1)]),_:1}),e(c,{label:"资产包ID"},{default:a(()=>[s(l(o.value.data.package_id||"无"),1)]),_:1}),e(c,{label:"资产包名称"},{default:a(()=>[s(l(o.value.data.package_name_display||"无"),1)]),_:1}),e(c,{label:"寄售价格"},{default:a(()=>[s("¥"+l(parseFloat(o.value.data.price).toFixed(2)),1)]),_:1}),e(c,{label:"原价"},{default:a(()=>[s("¥"+l(parseFloat(o.value.data.original_price).toFixed(2)),1)]),_:1}),e(c,{label:"手续费"},{default:a(()=>[s("¥"+l(parseFloat(o.value.data.service_fee).toFixed(2)),1)]),_:1}),e(c,{label:"使用寄售券"},{default:a(()=>[s(l(o.value.data.coupon_used?"是":"否"),1)]),_:1}),e(c,{label:"成交价格"},{default:a(()=>[s(l(o.value.data.sold_price>0?"¥"+parseFloat(o.value.data.sold_price).toFixed(2):"-"),1)]),_:1}),e(c,{label:"成交时间"},{default:a(()=>[s(l(o.value.data.sold_time_text||"-"),1)]),_:1}),e(c,{label:"创建时间"},{default:a(()=>[s(l(o.value.data.create_time_text),1)]),_:1}),e(c,{label:"更新时间"},{default:a(()=>[s(l(o.value.data.update_time_text),1)]),_:1})]),_:1})):k("",!0)]),_:1},8,["modelValue"])])}}}),le=G(Q,[["__scopeId","data-v-82a04d44"]]);export{le as default};
