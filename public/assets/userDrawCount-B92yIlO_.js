import{B as H,b as v,a as N,I as o,Z as O,C as R,D as b,H as e,P as a,_ as x,a9 as S,O as V,$ as n,X as u,af as T,G as y,U as X,a1 as K}from"./vue-BMJJ5Kg4.js";import{c as k,_ as Z}from"./index-DRv2sWQF.js";const q="/admin/content.DrawCountConfig/";function J(z){return k({url:q+"calculateUserDrawCount",method:"post",data:z})}const Q={class:"ba-app-container"},W={class:"card-header"},Y={style:{"margin-top":"20px"}},ee=H({__name:"userDrawCount",setup(z){const h=v(!1),C=v([]),c=N({current:1,size:10,total:0}),s=N({user_id:"",username:""}),w=v(!1),r=v(null),D=v(!1),I=v([]),g=async()=>{h.value=!0;try{const d={page:c.current,limit:c.size};s.user_id&&(d.id=s.user_id),s.username&&(d.username=s.username);const t=await k({url:"/admin/user.User/index",method:"get",params:d}),m=t.data.list||[];for(const _ of m)try{const f=await J({user_id:_.id});_.direct_invite_count=f.data.direct_count||0,_.draw_count=f.data.draw_count||0}catch{_.direct_invite_count=0,_.draw_count=0}C.value=m,c.total=t.data.total||0}catch(d){K.error(d.message||"查询失败")}finally{h.value=!1}},P=async d=>{r.value=d,w.value=!0,D.value=!0;try{const t=await k({url:"/admin/user.User/index",method:"get",params:{inviter_id:d.id,limit:100}});I.value=t.data.list||[]}catch{K.error("获取直推人员列表失败")}finally{D.value=!1}};return(d,t)=>{const m=o("el-button"),_=o("el-input"),f=o("el-form-item"),U=o("el-col"),$=o("el-row"),E=o("el-form"),i=o("el-table-column"),B=o("el-tag"),j=o("el-table"),M=o("el-pagination"),A=o("el-card"),p=o("el-descriptions-item"),F=o("el-descriptions"),G=o("el-dialog"),L=O("loading");return b(),R("div",Q,[e(A,{shadow:"hover","body-style":{paddingBottom:"0"}},{header:a(()=>[y("div",W,[t[7]||(t[7]=y("span",null,"用户抽奖次数查询",-1)),e(m,{type:"primary",onClick:g},{default:a(()=>t[6]||(t[6]=[n("查询")])),_:1})])]),default:a(()=>[e(E,{model:s,"label-width":"100px",style:{"margin-bottom":"20px"}},{default:a(()=>[e($,{gutter:20},{default:a(()=>[e(U,{xs:24,sm:12,md:8,lg:6},{default:a(()=>[e(f,{label:"用户ID"},{default:a(()=>[e(_,{modelValue:s.user_id,"onUpdate:modelValue":t[0]||(t[0]=l=>s.user_id=l),modelModifiers:{number:!0},type:"number",placeholder:"输入用户ID",onKeyup:S(g,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),e(U,{xs:24,sm:12,md:8,lg:6},{default:a(()=>[e(f,{label:"用户名"},{default:a(()=>[e(_,{modelValue:s.username,"onUpdate:modelValue":t[1]||(t[1]=l=>s.username=l),placeholder:"输入用户名",onKeyup:S(g,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),x((b(),V(j,{data:C.value,size:"default",style:{width:"100%"}},{default:a(()=>[e(i,{prop:"id",label:"用户ID",width:"80"}),e(i,{prop:"username",label:"用户名",width:"150"}),e(i,{prop:"nickname",label:"昵称",width:"150","show-overflow-tooltip":""}),e(i,{prop:"direct_invite_count",label:"直推人数",width:"120",align:"center"}),e(i,{prop:"draw_count",label:"剩余抽奖次数",width:"150",align:"center"},{default:a(({row:l})=>[e(B,{type:l.draw_count>0?"success":"info"},{default:a(()=>[n(u(l.draw_count),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"join_time",label:"注册时间",width:"180",formatter:()=>""}),e(i,{label:"操作",align:"center",width:"150",fixed:"right"},{default:a(({row:l})=>[e(m,{link:"",type:"primary",onClick:te=>P(l)},{default:a(()=>t[8]||(t[8]=[n(" 详情 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[L,h.value]]),x(e(M,{class:"pagination","current-page":c.current,"page-size":c.size,"page-sizes":[10,20,50,100],total:c.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:t[2]||(t[2]=l=>c.size=l),onCurrentPageChange:t[3]||(t[3]=l=>c.current=l),onPagination:g},null,8,["current-page","page-size","total"]),[[T,C.value.length>0]])]),_:1}),e(G,{modelValue:w.value,"onUpdate:modelValue":t[5]||(t[5]=l=>w.value=l),title:"用户抽奖次数详情",width:"50%"},{footer:a(()=>[e(m,{onClick:t[4]||(t[4]=l=>w.value=!1)},{default:a(()=>t[10]||(t[10]=[n("关闭")])),_:1})]),default:a(()=>[r.value?(b(),V(F,{key:0,column:1,border:""},{default:a(()=>[e(p,{label:"用户ID"},{default:a(()=>[n(u(r.value.id),1)]),_:1}),e(p,{label:"用户名"},{default:a(()=>[n(u(r.value.username),1)]),_:1}),e(p,{label:"昵称"},{default:a(()=>[n(u(r.value.nickname),1)]),_:1}),e(p,{label:"直推人数"},{default:a(()=>[n(u(r.value.direct_invite_count),1)]),_:1}),e(p,{label:"剩余抽奖次数"},{default:a(()=>[e(B,{type:r.value.draw_count>0?"success":"info"},{default:a(()=>[n(u(r.value.draw_count),1)]),_:1},8,["type"])]),_:1}),e(p,{label:"邀请码"},{default:a(()=>[n(u(r.value.invite_code),1)]),_:1}),e(p,{label:"邀请人ID"},{default:a(()=>[n(u(r.value.inviter_id),1)]),_:1}),e(p,{label:"注册时间"},{default:a(()=>[n(u(r.value.join_time),1)]),_:1})]),_:1})):X("",!0),y("div",Y,[t[9]||(t[9]=y("h4",null,"直推人员列表",-1)),x((b(),V(j,{data:I.value,size:"small",style:{width:"100%"}},{default:a(()=>[e(i,{prop:"id",label:"用户ID",width:"80"}),e(i,{prop:"username",label:"用户名",width:"120"}),e(i,{prop:"nickname",label:"昵称",width:"120","show-overflow-tooltip":""}),e(i,{prop:"join_time",label:"注册时间",width:"160",formatter:()=>""})]),_:1},8,["data"])),[[L,D.value]])])]),_:1},8,["modelValue"])])}}}),oe=Z(ee,[["__scopeId","data-v-bb3180be"]]);export{oe as default};
