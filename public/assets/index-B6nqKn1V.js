import{b as z}from"./baTable-C5P52-5P.js";import{T as H,a as F}from"./index-CY3WncDq.js";import{a5 as G,c as A,f as h,T as M}from"./index-BHof7fb5.js";import{B as R,a as I,l as X,a1 as v,I as d,Z,C as P,D as i,O as p,U as _,H as l,u as y,P as o,$ as s,X as c,_ as J,at as Q}from"./vue-BMJJ5Kg4.js";import"./index-1f7Hqibh.js";const W={class:"default-main ba-table-box"},Y={key:0,style:{"margin-bottom":"20px"}},re=R({name:"user/paymentAccount",__name:"index",setup(ee){const g=new z(new G("/admin/user.PaymentAccount/"),{column:[{type:"selection",align:"center",operator:!1},{label:"ID",prop:"id",align:"center",operator:"=",operatorPlaceholder:"ID",width:70},{label:"用户名",prop:"username",align:"center",operator:"LIKE",operatorPlaceholder:"模糊查询"},{label:"账户类型",prop:"type",align:"center",operator:"select",operatorOptions:[{label:"银行卡",value:"bank_card"},{label:"支付宝",value:"alipay"},{label:"微信",value:"wechat"},{label:"USDT",value:"usdt"}],render:"tag",custom:{bank_card:"primary",alipay:"success",wechat:"success",usdt:"warning"},replaceValue:{bank_card:"银行卡",alipay:"支付宝",wechat:"微信",usdt:"USDT"},width:100},{label:"账户性质",prop:"account_type",align:"center",operator:"select",operatorOptions:[{label:"个人",value:"personal"},{label:"公司",value:"company"}],render:"tag",custom:{personal:"info",company:"warning"},replaceValue:{personal:"个人",company:"公司"},width:100},{label:"银行名称",prop:"bank_name",align:"center",operator:"LIKE",operatorPlaceholder:"模糊查询",show:!1},{label:"账户名",prop:"account_name",align:"center",operator:"LIKE",operatorPlaceholder:"模糊查询"},{label:"账号/卡号",prop:"account_number_display",align:"center",operator:"LIKE",operatorPlaceholder:"模糊查询"},{label:"审核状态",prop:"audit_status",align:"center",operator:"select",operatorOptions:[{label:"待审核",value:"0"},{label:"已通过",value:"1"},{label:"已拒绝",value:"2"}],render:"tag",custom:{0:"warning",1:"success",2:"danger"},replaceValue:{0:"待审核",1:"已通过",2:"已拒绝"},width:100},{label:"是否默认",prop:"is_default",align:"center",render:"tag",custom:{0:"info",1:"success"},replaceValue:{0:"否",1:"是"},width:100},{label:"创建时间",prop:"create_time",align:"center",render:"datetime",sortable:"custom",operator:"RANGE",width:160},{label:"操作",align:"center",width:250,render:"buttons",buttons:n=>{const e=[];return e.push({render:"tipButton",name:"read",title:"查看详情",type:"primary",icon:"fa fa-eye",class:"table-row-read",click:()=>{E(n)}}),n.audit_status==0&&n.type!="bank_card"&&(e.push({render:"tipButton",name:"approve",title:"审核通过",type:"success",icon:"fa fa-check",class:"table-row-approve",click:()=>{C(n,"approve")}}),e.push({render:"tipButton",name:"reject",title:"审核拒绝",type:"danger",icon:"fa fa-times",class:"table-row-reject",click:()=>{C(n,"reject")}})),e},operator:!1}],dblClickNotEditColumn:[void 0]}),a=I({visible:!1,loading:!1,type:"approve",title:"",form:{id:"",username:"",type:"",type_text:"",account_type:"",account_type_text:"",bank_name:"",account_name:"",account_number_display:"",bank_branch:"",screenshot:"",audit_reason:""}}),r=I({visible:!1,loading:!1,list:[],userInfo:null}),f=I({visible:!1,url:"",title:"打款截图"}),U=X(()=>r.list.some(n=>n.type==="bank_card")),C=(n,e)=>{a.type=e,a.title=e==="approve"?"审核通过":"审核拒绝",a.form={id:n.id,username:n.username||"",type:n.type||"",type_text:n.type_text||"",account_type:n.account_type||"",account_type_text:n.account_type_text||"",bank_name:n.bank_name||"",account_name:n.account_name||"",account_number_display:n.account_number_display||"",bank_branch:n.bank_branch||"",screenshot:n.screenshot||"",audit_reason:""},a.visible=!0},B=async()=>{if(a.type==="reject"&&!a.form.audit_reason.trim()){v.warning("拒绝原因不能为空");return}a.loading=!0;try{const n=a.type==="approve"?"/admin/user.PaymentAccount/approve":"/admin/user.PaymentAccount/reject",e=await A({url:n,method:"post",data:{id:a.form.id,audit_reason:a.form.audit_reason}});e.code==1?(v.success(e.msg),a.visible=!1,g.getData()):v.error(e.msg)}catch(n){v.error(n.message||"操作失败")}finally{a.loading=!1}},E=async n=>{r.loading=!0,r.visible=!0,r.list=[],r.userInfo=null;try{const e=await A({url:"/admin/user.PaymentAccount/getUserAccounts",method:"get",params:{user_id:n.user_id}});e.code==1?(r.list=e.data.list||[],r.list.length>0&&(r.userInfo={user_id:n.user_id,username:n.username||r.list[0].username,nickname:n.nickname||r.list[0].nickname,mobile:n.mobile||r.list[0].mobile})):(v.error(e.msg),r.visible=!1)}catch(e){v.error(e.message||"获取绑卡列表失败"),r.visible=!1}finally{r.loading=!1}},T=(n,e="打款截图")=>{f.url=n,f.title=e,f.visible=!0},S=n=>({bank_card:"primary",alipay:"success",wechat:"success",usdt:"warning"})[n]||"info",$=n=>({0:"warning",1:"success",2:"danger"})[n]||"info";return g.mount(),g.getData(),Q("baTable",g),(n,e)=>{const j=d("el-alert"),b=d("el-input"),u=d("el-form-item"),w=d("el-image"),N=d("el-form"),k=d("el-button"),D=d("el-dialog"),V=d("el-descriptions-item"),K=d("el-descriptions"),m=d("el-table-column"),x=d("el-tag"),L=d("el-table"),O=Z("loading");return i(),P("div",W,[y(g).table.remark?(i(),p(j,{key:0,class:"ba-table-alert",title:y(g).table.remark,type:"info","show-icon":""},null,8,["title"])):_("",!0),l(H,{buttons:["refresh","comSearch","quickSearch","columnDisplay"],"quick-search-placeholder":"快速搜索：ID/用户名/账户名/账号"}),l(F),l(D,{modelValue:a.visible,"onUpdate:modelValue":e[11]||(e[11]=t=>a.visible=t),title:a.title,width:"700px","close-on-click-modal":!1},{footer:o(()=>[l(k,{onClick:e[10]||(e[10]=t=>a.visible=!1)},{default:o(()=>e[16]||(e[16]=[s("取消")])),_:1}),l(k,{type:"primary",onClick:B,loading:a.loading},{default:o(()=>[s(c(a.type==="approve"?"通过":"拒绝"),1)]),_:1},8,["loading"])]),default:o(()=>[l(N,{model:a.form,"label-width":"120px"},{default:o(()=>[l(u,{label:"账户ID"},{default:o(()=>[l(b,{modelValue:a.form.id,"onUpdate:modelValue":e[0]||(e[0]=t=>a.form.id=t),disabled:""},null,8,["modelValue"])]),_:1}),l(u,{label:"用户名"},{default:o(()=>[l(b,{modelValue:a.form.username,"onUpdate:modelValue":e[1]||(e[1]=t=>a.form.username=t),disabled:""},null,8,["modelValue"])]),_:1}),l(u,{label:"账户类型"},{default:o(()=>[l(b,{modelValue:a.form.type_text,"onUpdate:modelValue":e[2]||(e[2]=t=>a.form.type_text=t),disabled:""},null,8,["modelValue"])]),_:1}),l(u,{label:"账户性质"},{default:o(()=>[l(b,{modelValue:a.form.account_type_text,"onUpdate:modelValue":e[3]||(e[3]=t=>a.form.account_type_text=t),disabled:""},null,8,["modelValue"])]),_:1}),a.form.type==="bank_card"?(i(),p(u,{key:0,label:"银行名称"},{default:o(()=>[l(b,{modelValue:a.form.bank_name,"onUpdate:modelValue":e[4]||(e[4]=t=>a.form.bank_name=t),disabled:""},null,8,["modelValue"])]),_:1})):_("",!0),l(u,{label:"账户名"},{default:o(()=>[l(b,{modelValue:a.form.account_name,"onUpdate:modelValue":e[5]||(e[5]=t=>a.form.account_name=t),disabled:""},null,8,["modelValue"])]),_:1}),l(u,{label:"账号/卡号"},{default:o(()=>[l(b,{modelValue:a.form.account_number_display,"onUpdate:modelValue":e[6]||(e[6]=t=>a.form.account_number_display=t),disabled:""},null,8,["modelValue"])]),_:1}),a.form.type==="bank_card"&&a.form.bank_branch?(i(),p(u,{key:1,label:"开户行"},{default:o(()=>[l(b,{modelValue:a.form.bank_branch,"onUpdate:modelValue":e[7]||(e[7]=t=>a.form.bank_branch=t),disabled:""},null,8,["modelValue"])]),_:1})):_("",!0),a.form.account_type==="company"&&a.form.screenshot&&a.form.type!=="wechat"?(i(),p(u,{key:2,label:"打款截图"},{default:o(()=>[l(w,{src:y(h)(a.form.screenshot),style:{width:"400px",height:"auto","max-height":"300px"},"preview-src-list":[y(h)(a.form.screenshot)],fit:"contain"},null,8,["src","preview-src-list"])]),_:1})):_("",!0),a.form.type==="wechat"&&a.form.screenshot?(i(),p(u,{key:3,label:"微信收款码"},{default:o(()=>[l(w,{src:y(h)(a.form.screenshot),style:{width:"400px",height:"auto","max-height":"300px"},"preview-src-list":[y(h)(a.form.screenshot)],fit:"contain"},null,8,["src","preview-src-list"])]),_:1})):_("",!0),a.type==="reject"?(i(),p(u,{key:4,label:"审核备注"},{default:o(()=>[l(b,{modelValue:a.form.audit_reason,"onUpdate:modelValue":e[8]||(e[8]=t=>a.form.audit_reason=t),type:"textarea",rows:4,placeholder:"请输入拒绝原因"},null,8,["modelValue"])]),_:1})):(i(),p(u,{key:5,label:"审核备注"},{default:o(()=>[l(b,{modelValue:a.form.audit_reason,"onUpdate:modelValue":e[9]||(e[9]=t=>a.form.audit_reason=t),type:"textarea",rows:4,placeholder:"请输入审核备注（可选）"},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(D,{modelValue:r.visible,"onUpdate:modelValue":e[13]||(e[13]=t=>r.visible=t),title:"绑卡列表",width:"1000px","close-on-click-modal":!1},{footer:o(()=>[l(k,{onClick:e[12]||(e[12]=t=>r.visible=!1)},{default:o(()=>e[19]||(e[19]=[s("关闭")])),_:1})]),default:o(()=>[r.userInfo?(i(),P("div",Y,[l(K,{column:3,border:""},{default:o(()=>[l(V,{label:"用户ID"},{default:o(()=>[s(c(r.userInfo.user_id),1)]),_:1}),l(V,{label:"用户名"},{default:o(()=>[s(c(r.userInfo.username||"--"),1)]),_:1}),l(V,{label:"昵称"},{default:o(()=>[s(c(r.userInfo.nickname||"--"),1)]),_:1}),l(V,{label:"手机号",span:3},{default:o(()=>[s(c(r.userInfo.mobile||"--"),1)]),_:1})]),_:1})])):_("",!0),J((i(),p(L,{data:r.list,border:"",style:{width:"100%"}},{default:o(()=>[l(m,{prop:"id",label:"账户ID",align:"center",width:"80"}),l(m,{prop:"type_text",label:"账户类型",align:"center",width:"100"},{default:o(({row:t})=>[l(x,{type:S(t.type)},{default:o(()=>[s(c(t.type_text),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"account_type_text",label:"账户性质",align:"center",width:"100"},{default:o(({row:t})=>[l(x,{type:t.account_type==="personal"?"info":"warning"},{default:o(()=>[s(c(t.account_type_text),1)]),_:2},1032,["type"])]),_:1}),U.value?(i(),p(m,{key:0,prop:"bank_name",label:"银行名称",align:"center",width:"150"},{default:o(({row:t})=>[s(c(t.type==="bank_card"&&t.bank_name||"--"),1)]),_:1})):_("",!0),l(m,{prop:"account_name",label:"账户名",align:"center",width:"150"}),l(m,{prop:"account_number_display",label:"账号/卡号",align:"center",width:"200"}),U.value?(i(),p(m,{key:1,prop:"bank_branch",label:"开户行",align:"center",width:"150"},{default:o(({row:t})=>[s(c(t.type==="bank_card"&&t.bank_branch||"--"),1)]),_:1})):_("",!0),l(m,{prop:"audit_status_text",label:"审核状态",align:"center",width:"100"},{default:o(({row:t})=>[l(x,{type:$(t.audit_status)},{default:o(()=>[s(c(t.audit_status_text),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"is_default",label:"是否默认",align:"center",width:"100"},{default:o(({row:t})=>[l(x,{type:t.is_default?"success":"info"},{default:o(()=>[s(c(t.is_default?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"create_time",label:"创建时间",align:"center",width:"160"},{default:o(({row:t})=>[s(c(t.create_time?y(M)(t.create_time):"--"),1)]),_:1}),l(m,{label:"操作",align:"center",width:"150",fixed:"right"},{default:o(({row:t})=>[t.account_type==="company"&&t.screenshot&&t.type!=="wechat"?(i(),p(k,{key:0,type:"primary",size:"small",onClick:q=>T(t.screenshot,"打款截图")},{default:o(()=>e[17]||(e[17]=[s(" 查看截图 ")])),_:2},1032,["onClick"])):_("",!0),t.type==="wechat"&&t.screenshot?(i(),p(k,{key:1,type:"success",size:"small",onClick:q=>T(t.screenshot,"微信收款码")},{default:o(()=>e[18]||(e[18]=[s(" 查看收款码 ")])),_:2},1032,["onClick"])):_("",!0)]),_:1})]),_:1},8,["data"])),[[O,r.loading]])]),_:1},8,["modelValue"]),l(D,{modelValue:f.visible,"onUpdate:modelValue":e[15]||(e[15]=t=>f.visible=t),title:f.title,width:"600px","close-on-click-modal":!1},{footer:o(()=>[l(k,{onClick:e[14]||(e[14]=t=>f.visible=!1)},{default:o(()=>e[20]||(e[20]=[s("关闭")])),_:1})]),default:o(()=>[l(w,{src:y(h)(f.url),style:{width:"100%",height:"auto","max-height":"500px"},"preview-src-list":[y(h)(f.url)],fit:"contain"},null,8,["src","preview-src-list"])]),_:1},8,["modelValue","title"])])}}});export{re as default};
