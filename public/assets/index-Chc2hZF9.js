import{B as ae,b as H,a as q,I as p,Z as le,C as I,D as b,H as e,_ as M,G as w,P as a,$ as s,u as T,aJ as ie,aK as ne,aL as se,O as J,X as n,F as K,U as S,V as L,a1 as f}from"./vue-DnSQgQf0.js";import{a5 as oe,_ as de}from"./index-BR6nH71S.js";const re={class:"default-main ba-table-box"},ue={style:{color:"#f56c6c","font-weight":"bold"}},_e={style:{"font-size":"12px"}},pe={class:"pagination-container",style:{"margin-top":"15px","text-align":"right"}},ce={style:{"font-size":"12px","word-break":"break-all"}},me={style:{"font-size":"12px","word-break":"break-all"}},fe={key:0,style:{"margin-top":"20px"}},ge=ae({name:"collection/userCollection",__name:"index",setup(be){const C=new oe("/admin/collection.UserCollection/"),U=H(!1),$=H([]),g=q({page:1,limit:20,total:0}),o=q({mobile:"",user_id:void 0,item_id:void 0,consignment_status:void 0,mining_status:void 0,quick_search:""}),k=async()=>{var c,i;U.value=!0;try{const m={page:g.page,limit:g.limit};o.mobile&&(m.mobile=o.mobile),o.user_id&&(m.user_id=o.user_id),o.item_id&&(m.item_id=o.item_id),o.consignment_status!==void 0&&(m.consignment_status=o.consignment_status),o.mining_status!==void 0&&(m.mining_status=o.mining_status),o.quick_search&&(m.quick_search=o.quick_search);const h=await C.index(m);h.code===1?($.value=((c=h.data)==null?void 0:c.list)||[],g.total=((i=h.data)==null?void 0:i.total)||0):f.error(h.msg||"查询失败")}catch(m){f.error(m.message||"查询失败")}finally{U.value=!1}},O=()=>{o.mobile="",o.user_id=void 0,o.item_id=void 0,o.consignment_status=void 0,o.mining_status=void 0,o.quick_search="",g.page=1,k()},_=q({visible:!1,loading:!1,data:null}),R=async()=>{if(!o.mobile&&!o.user_id){f.warning("请先输入手机号或用户ID");return}_.visible=!0,_.loading=!0,_.data=null;try{const c={};o.mobile&&(c.mobile=o.mobile),o.user_id&&(c.user_id=o.user_id);const i=await C.postData("userStats",c);i.code===1?_.data=i.data:f.error(i.msg||"获取统计失败")}catch(c){f.error(c.message||"获取统计失败")}finally{_.loading=!1}},d=q({visible:!1,loading:!1,data:null}),X=async c=>{d.visible=!0,d.loading=!0,d.data=null;try{const i=await C.postData("detail",{id:c.id});i.code===1?d.data=i.data:f.error(i.msg||"获取详情失败")}catch(i){f.error(i.message||"获取详情失败")}finally{d.loading=!1}},Z=async c=>{try{const i=await C.postData("toMining",{user_collection_id:c.id});i.code===1?(f.success(i.msg||"操作成功"),k()):f.error(i.msg||"操作失败")}catch(i){f.error(i.message||"操作失败")}};return k(),(c,i)=>{const m=p("el-alert"),h=p("el-input"),v=p("el-form-item"),E=p("el-input-number"),V=p("el-option"),P=p("el-select"),B=p("el-icon"),z=p("el-button"),Q=p("el-form"),W=p("el-card"),r=p("el-table-column"),D=p("el-tag"),Y=p("el-popconfirm"),N=p("el-table"),ee=p("el-pagination"),u=p("el-descriptions-item"),j=p("el-descriptions"),y=p("el-statistic"),x=p("el-col"),te=p("el-row"),A=p("el-dialog"),F=le("loading");return b(),I("div",re,[e(m,{class:"ba-table-alert",title:"用户藏品管理 - 可按手机号、用户ID、藏品名称搜索用户持有的藏品",type:"info","show-icon":""}),e(W,{class:"search-card",shadow:"never",style:{"margin-bottom":"15px"}},{default:a(()=>[e(Q,{model:o,inline:""},{default:a(()=>[e(v,{label:"手机号"},{default:a(()=>[e(h,{modelValue:o.mobile,"onUpdate:modelValue":i[0]||(i[0]=t=>o.mobile=t),placeholder:"请输入手机号",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(v,{label:"用户ID"},{default:a(()=>[e(E,{modelValue:o.user_id,"onUpdate:modelValue":i[1]||(i[1]=t=>o.user_id=t),min:0,placeholder:"用户ID","controls-position":"right",style:{width:"120px"}},null,8,["modelValue"])]),_:1}),e(v,{label:"藏品ID"},{default:a(()=>[e(E,{modelValue:o.item_id,"onUpdate:modelValue":i[2]||(i[2]=t=>o.item_id=t),min:0,placeholder:"藏品ID","controls-position":"right",style:{width:"120px"}},null,8,["modelValue"])]),_:1}),e(v,{label:"寄售状态"},{default:a(()=>[e(P,{modelValue:o.consignment_status,"onUpdate:modelValue":i[3]||(i[3]=t=>o.consignment_status=t),placeholder:"全部",clearable:"",style:{width:"120px"}},{default:a(()=>[e(V,{label:"未寄售",value:0}),e(V,{label:"寄售中",value:1}),e(V,{label:"已售出",value:2}),e(V,{label:"矿机中",value:3})]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"矿机状态"},{default:a(()=>[e(P,{modelValue:o.mining_status,"onUpdate:modelValue":i[4]||(i[4]=t=>o.mining_status=t),placeholder:"全部",clearable:"",style:{width:"120px"}},{default:a(()=>[e(V,{label:"未转矿机",value:0}),e(V,{label:"矿机运行中",value:1})]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"关键词"},{default:a(()=>[e(h,{modelValue:o.quick_search,"onUpdate:modelValue":i[5]||(i[5]=t=>o.quick_search=t),placeholder:"手机号/昵称/藏品名/确权编号",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(v,null,{default:a(()=>[e(z,{type:"primary",onClick:k,loading:U.value},{default:a(()=>[e(B,null,{default:a(()=>[e(T(ie))]),_:1}),i[10]||(i[10]=s(" 搜索 "))]),_:1},8,["loading"]),e(z,{onClick:O},{default:a(()=>[e(B,null,{default:a(()=>[e(T(ne))]),_:1}),i[11]||(i[11]=s(" 重置 "))]),_:1}),e(z,{type:"success",onClick:R,disabled:!o.mobile&&!o.user_id},{default:a(()=>[e(B,null,{default:a(()=>[e(T(se))]),_:1}),i[12]||(i[12]=s(" 用户统计 "))]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1}),M((b(),J(N,{data:$.value,stripe:"",border:"",style:{width:"100%"}},{default:a(()=>[e(r,{prop:"id",label:"记录ID",width:"80",align:"center"}),e(r,{prop:"user_id",label:"用户ID",width:"80",align:"center"}),e(r,{prop:"mobile",label:"手机号",width:"130",align:"center"}),e(r,{prop:"nickname",label:"昵称",width:"120",align:"center"}),e(r,{prop:"item_id",label:"藏品ID",width:"80",align:"center"}),e(r,{prop:"item_title",label:"藏品名称","min-width":"150",align:"center"}),e(r,{prop:"buy_price",label:"购买价格",width:"100",align:"center"},{default:a(({row:t})=>[w("span",ue,"¥"+n(t.buy_price),1)]),_:1}),e(r,{prop:"current_price",label:"当前价格",width:"100",align:"center"},{default:a(({row:t})=>[s(" ¥"+n(t.current_price),1)]),_:1}),e(r,{prop:"appreciation",label:"增值",width:"100",align:"center"},{default:a(({row:t})=>[w("span",{style:K({color:t.appreciation>=0?"#67c23a":"#f56c6c"})},n(t.appreciation>=0?"+":"")+n(t.appreciation),5)]),_:1}),e(r,{prop:"consignment_status_text",label:"寄售状态",width:"100",align:"center"},{default:a(({row:t})=>[e(D,{type:t.consignment_status===0?"info":t.consignment_status===1?"warning":"success",size:"small"},{default:a(()=>[s(n(t.consignment_status_text),1)]),_:2},1032,["type"])]),_:1}),e(r,{prop:"mining_status_text",label:"矿机状态",width:"100",align:"center"},{default:a(({row:t})=>[e(D,{type:t.mining_status===1?"danger":"info",size:"small",effect:"plain"},{default:a(()=>[s(n(t.mining_status_text),1)]),_:2},1032,["type"])]),_:1}),e(r,{prop:"session_title",label:"所属专场",width:"120",align:"center"}),e(r,{prop:"asset_code",label:"确权编号",width:"160",align:"center"},{default:a(({row:t})=>[w("span",_e,n(t.asset_code||"-"),1)]),_:1}),e(r,{prop:"buy_time_text",label:"购买时间",width:"160",align:"center"}),e(r,{label:"操作",width:"100",align:"center",fixed:"right"},{default:a(({row:t})=>[e(z,{type:"primary",link:"",size:"small",onClick:l=>X(t)},{default:a(()=>i[13]||(i[13]=[s("详情")])),_:2},1032,["onClick"]),t.mining_status===0&&t.consignment_status!==2&&t.delivery_status===0?(b(),J(Y,{key:0,title:"确定要将此藏品转为矿机吗？转为矿机后将强制锁仓分红，且不可逆！",onConfirm:l=>Z(t)},{reference:a(()=>[e(z,{type:"danger",link:"",size:"small"},{default:a(()=>i[14]||(i[14]=[s("转矿机")])),_:1})]),_:2},1032,["onConfirm"])):S("",!0)]),_:1})]),_:1},8,["data"])),[[F,U.value]]),w("div",pe,[e(ee,{"current-page":g.page,"onUpdate:currentPage":i[6]||(i[6]=t=>g.page=t),"page-size":g.limit,"onUpdate:pageSize":i[7]||(i[7]=t=>g.limit=t),"page-sizes":[10,20,50,100],total:g.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:k,onCurrentChange:k},null,8,["current-page","page-size","total"])]),e(A,{modelValue:_.visible,"onUpdate:modelValue":i[8]||(i[8]=t=>_.visible=t),title:"用户藏品统计",width:"80%",top:"5vh"},{default:a(()=>[M((b(),I("div",null,[_.data?(b(),I(L,{key:0},[e(j,{column:4,border:"",style:{"margin-bottom":"20px"}},{default:a(()=>[e(u,{label:"用户ID"},{default:a(()=>{var t;return[s(n((t=_.data.user)==null?void 0:t.id),1)]}),_:1}),e(u,{label:"手机号"},{default:a(()=>{var t;return[s(n((t=_.data.user)==null?void 0:t.mobile),1)]}),_:1}),e(u,{label:"昵称"},{default:a(()=>{var t;return[s(n((t=_.data.user)==null?void 0:t.nickname),1)]}),_:1}),e(u,{label:"注册时间"},{default:a(()=>{var t;return[s(n((t=_.data.user)==null?void 0:t.create_time),1)]}),_:1})]),_:1}),e(te,{gutter:20,style:{"margin-bottom":"20px"}},{default:a(()=>[e(x,{span:4},{default:a(()=>{var t;return[e(y,{title:"藏品总数",value:((t=_.data.stats)==null?void 0:t.total_count)||0},null,8,["value"])]}),_:1}),e(x,{span:4},{default:a(()=>{var t;return[e(y,{title:"总价值",value:((t=_.data.stats)==null?void 0:t.total_value)||0,precision:2,prefix:"¥"},null,8,["value"])]}),_:1}),e(x,{span:4},{default:a(()=>{var t;return[e(y,{title:"平均价格",value:((t=_.data.stats)==null?void 0:t.avg_price)||0,precision:2,prefix:"¥"},null,8,["value"])]}),_:1}),e(x,{span:4},{default:a(()=>{var t;return[e(y,{title:"持有中",value:((t=_.data.stats)==null?void 0:t.holding)||0},null,8,["value"])]}),_:1}),e(x,{span:4},{default:a(()=>{var t;return[e(y,{title:"寄售中",value:((t=_.data.stats)==null?void 0:t.consigning)||0},null,8,["value"])]}),_:1}),e(x,{span:4},{default:a(()=>{var t;return[e(y,{title:"已售出",value:((t=_.data.stats)==null?void 0:t.sold)||0},null,8,["value"])]}),_:1}),e(x,{span:4},{default:a(()=>{var t;return[e(y,{title:"矿机中",value:((t=_.data.stats)==null?void 0:t.mining)||0},null,8,["value"])]}),_:1})]),_:1}),e(N,{data:_.data.collections||[],stripe:"",border:"","max-height":"400"},{default:a(()=>[e(r,{prop:"id",label:"记录ID",width:"80",align:"center"}),e(r,{prop:"item_id",label:"藏品ID",width:"80",align:"center"}),e(r,{prop:"title",label:"藏品名称","min-width":"150",align:"center"}),e(r,{prop:"buy_price",label:"购买价格",width:"100",align:"center"},{default:a(({row:t})=>[s("¥"+n(t.buy_price),1)]),_:1}),e(r,{prop:"current_price",label:"当前价格",width:"100",align:"center"},{default:a(({row:t})=>[s("¥"+n(t.current_price),1)]),_:1}),e(r,{prop:"appreciation",label:"增值",width:"100",align:"center"},{default:a(({row:t})=>[w("span",{style:K({color:t.appreciation>=0?"#67c23a":"#f56c6c"})},n(t.appreciation>=0?"+":"")+n(t.appreciation),5)]),_:1}),e(r,{prop:"consignment_status_text",label:"寄售状态",width:"100",align:"center"},{default:a(({row:t})=>[e(D,{type:t.consignment_status===0?"info":t.consignment_status===1?"warning":"success",size:"small"},{default:a(()=>[s(n(t.consignment_status_text),1)]),_:2},1032,["type"])]),_:1}),e(r,{prop:"mining_status_text",label:"矿机状态",width:"100",align:"center"},{default:a(({row:t})=>[e(D,{type:t.mining_status===1?"danger":"info",size:"small",effect:"plain"},{default:a(()=>[s(n(t.mining_status_text),1)]),_:2},1032,["type"])]),_:1}),e(r,{prop:"session_title",label:"所属专场",width:"120",align:"center"}),e(r,{prop:"buy_time_text",label:"购买时间",width:"160",align:"center"})]),_:1},8,["data"])],64)):S("",!0)])),[[F,_.loading]])]),_:1},8,["modelValue"]),e(A,{modelValue:d.visible,"onUpdate:modelValue":i[9]||(i[9]=t=>d.visible=t),title:"藏品详情",width:"70%"},{default:a(()=>{var t;return[M((b(),I("div",null,[d.data?(b(),I(L,{key:0},[e(j,{column:2,border:""},{default:a(()=>[e(u,{label:"记录ID"},{default:a(()=>{var l;return[s(n((l=d.data.row)==null?void 0:l.id),1)]}),_:1}),e(u,{label:"用户ID"},{default:a(()=>{var l;return[s(n((l=d.data.row)==null?void 0:l.user_id),1)]}),_:1}),e(u,{label:"手机号"},{default:a(()=>{var l;return[s(n((l=d.data.row)==null?void 0:l.mobile),1)]}),_:1}),e(u,{label:"昵称"},{default:a(()=>{var l;return[s(n((l=d.data.row)==null?void 0:l.nickname),1)]}),_:1}),e(u,{label:"藏品ID"},{default:a(()=>{var l;return[s(n((l=d.data.row)==null?void 0:l.item_id),1)]}),_:1}),e(u,{label:"藏品名称"},{default:a(()=>{var l;return[s(n((l=d.data.row)==null?void 0:l.title),1)]}),_:1}),e(u,{label:"购买价格"},{default:a(()=>{var l;return[s("¥"+n((l=d.data.row)==null?void 0:l.price),1)]}),_:1}),e(u,{label:"当前价格"},{default:a(()=>{var l;return[s("¥"+n((l=d.data.row)==null?void 0:l.current_price),1)]}),_:1}),e(u,{label:"发行价格"},{default:a(()=>{var l;return[s("¥"+n((l=d.data.row)==null?void 0:l.issue_price),1)]}),_:1}),e(u,{label:"所属专场"},{default:a(()=>{var l;return[s(n((l=d.data.row)==null?void 0:l.session_title),1)]}),_:1}),e(u,{label:"资产包"},{default:a(()=>{var l;return[s(n(((l=d.data.row)==null?void 0:l.package_name)||"-"),1)]}),_:1}),e(u,{label:"订单号"},{default:a(()=>{var l;return[s(n(((l=d.data.row)==null?void 0:l.order_no)||"-"),1)]}),_:1}),e(u,{label:"确权编号",span:2},{default:a(()=>{var l;return[s(n(((l=d.data.row)==null?void 0:l.asset_code)||"-"),1)]}),_:1}),e(u,{label:"存证指纹",span:2},{default:a(()=>{var l;return[w("span",ce,n(((l=d.data.row)==null?void 0:l.fingerprint)||"-"),1)]}),_:1}),e(u,{label:"购买时间"},{default:a(()=>{var l;return[s(n((l=d.data.row)==null?void 0:l.buy_time_text),1)]}),_:1}),e(u,{label:"购买时间"},{default:a(()=>{var l;return[s(n((l=d.data.row)==null?void 0:l.buy_time_text),1)]}),_:1}),e(u,{label:"创建时间"},{default:a(()=>{var l;return[s(n((l=d.data.row)==null?void 0:l.create_time_text),1)]}),_:1}),e(u,{label:"矿机状态"},{default:a(()=>{var l;return[e(D,{type:((l=d.data.row)==null?void 0:l.mining_status)===1?"danger":"info"},{default:a(()=>{var G;return[s(n((G=d.data.row)==null?void 0:G.mining_status_text),1)]}),_:1},8,["type"])]}),_:1}),e(u,{label:"矿机启动时间"},{default:a(()=>{var l;return[s(n(((l=d.data.row)==null?void 0:l.mining_start_time_text)||"-"),1)]}),_:1}),e(u,{label:"上次分红时间"},{default:a(()=>{var l;return[s(n(((l=d.data.row)==null?void 0:l.last_dividend_time_text)||"-"),1)]}),_:1}),e(u,{label:"确权状态"},{default:a(()=>{var l;return[s(n(((l=d.data.row)==null?void 0:l.rights_status)||"-"),1)]}),_:1}),e(u,{label:"合约地址",span:2},{default:a(()=>{var l;return[s(n(((l=d.data.row)==null?void 0:l.contract_no)||"-"),1)]}),_:1}),e(u,{label:"权益哈希",span:2},{default:a(()=>{var l;return[w("span",me,n(((l=d.data.row)==null?void 0:l.rights_hash)||"-"),1)]}),_:1}),e(u,{label:"区块高度"},{default:a(()=>{var l;return[s(n(((l=d.data.row)==null?void 0:l.block_height)||"-"),1)]}),_:1})]),_:1}),(t=d.data.consignments)!=null&&t.length?(b(),I("div",fe,[i[15]||(i[15]=w("h4",null,"寄售记录",-1)),e(N,{data:d.data.consignments,stripe:"",border:""},{default:a(()=>[e(r,{prop:"id",label:"寄售ID",width:"80",align:"center"}),e(r,{prop:"price",label:"寄售价格",width:"100",align:"center"},{default:a(({row:l})=>[s("¥"+n(l.price),1)]),_:1}),e(r,{prop:"status_text",label:"状态",width:"100",align:"center"},{default:a(({row:l})=>[e(D,{type:l.status===2?"success":l.status===1?"warning":"info",size:"small"},{default:a(()=>[s(n(l.status_text),1)]),_:2},1032,["type"])]),_:1}),e(r,{prop:"create_time_text",label:"创建时间",width:"160",align:"center"}),e(r,{prop:"update_time_text",label:"更新时间",width:"160",align:"center"})]),_:1},8,["data"])])):S("",!0)],64)):S("",!0)])),[[F,d.loading]])]}),_:1},8,["modelValue"])])}}}),ve=de(ge,[["__scopeId","data-v-eb8ab4b8"]]);export{ve as default};
