import{B as M,b as N,a as U,I as u,Z as $,C as V,D as f,O as v,U as h,H as t,u as x,P as a,_ as F,$ as r,X as o,G as E,aI as G,a1 as C,at as H}from"./vue-DnSQgQf0.js";import{b as j,d as Q}from"./baTable-CpxZN4RR.js";import{_ as R}from"./popupForm.vue_vue_type_script_setup_true_lang-B3pSH1fB.js";import{T as X,a as J}from"./index-B5mnDXNW.js";import{v as Y,a5 as T}from"./index-BR6nH71S.js";import"./index-Ch43UxRl.js";import"./index-DGD6GkL-.js";const ee={class:"default-main ba-table-box"},te={style:{"font-size":"12px","word-break":"break-all"}},ae={class:"el-statistic"},le={class:"el-statistic__content",style:{"font-size":"14px"}},be=M({name:"collection/item",__name:"index",setup(se){const{t:b}=Y.useI18n(),I=N({}),D=N({}),S=new T("/admin/collection.Session/"),q=new T("/admin/PriceZoneConfig/");(async()=>{var s;const i=await S.index({select:1,limit:999});if(i.code===1&&((s=i.data)!=null&&s.list)){const y=i.data.list;I.value={},y.forEach(_=>{I.value[_.id]=_})}})(),(async()=>{var s;const i=await q.index({select:1,limit:999});if(i.code===1&&((s=i.data)!=null&&s.list)){const y=i.data.list;D.value={},y.forEach(_=>{D.value[_.id]=_})}})();const m=new j(new T("/admin/collection.Item/"),{column:[{type:"selection",align:"center",operator:!1},{label:b("Id"),prop:"id",align:"center",operator:"=",operatorPlaceholder:b("Id"),width:70},{label:"专场",prop:"session_id",align:"center",operator:"=",operatorPlaceholder:"专场ID",width:150,render:i=>{const s=I.value[i.session_id];return s?s.title+"（ID："+i.session_id+"）":"ID："+i.session_id}},{label:"藏品标题",prop:"title",align:"center",operator:"LIKE",operatorPlaceholder:b("Fuzzy query")},{label:"价格分区",prop:"zone_id",align:"center",operator:"=",operatorPlaceholder:"分区ID",width:140,render:i=>{const s=D.value[i.zone_id];return s?s.name+"（ID："+i.zone_id+"）":"ID："+i.zone_id}},{label:"藏品图片",prop:"image",align:"center",render:"image",operator:!1,width:120},{label:"价格",prop:"price",align:"center",operator:"BETWEEN",width:120,render:i=>{const s=Number(i.price);return isNaN(s)?i.price:s.toFixed(2)+"元"}},{label:"资产锚定",prop:"asset_anchor",align:"center",operator:"LIKE",minWidth:150},{label:"存证指纹",prop:"fingerprint",align:"center",operator:"LIKE",minWidth:220,render:i=>{const s=i.fingerprint||"";return s.length>24?s.slice(0,24)+"…":s}},{label:"库存数量",prop:"stock",align:"center",operator:"BETWEEN",width:110},{label:"销量",prop:"sales",align:"center",operator:"BETWEEN",width:90},{label:"状态",prop:"status",align:"center",render:"switch",options:[{label:b("Enable"),value:1},{label:b("Disable"),value:0}],operator:"select",operatorOptions:[{label:b("Enable"),value:1},{label:b("Disable"),value:0}],width:90},{label:"排序",prop:"sort",align:"center",operator:"BETWEEN",width:90},{label:b("Create time"),prop:"create_time",align:"center",render:"datetime",sortable:"custom",operator:"RANGE",width:160},{label:b("Operate"),prop:"operate",align:"center",width:140,render:"buttons",buttons:[],operator:!1}]},{defaultItems:{status:1,sort:0,stock:1,sales:0,price:0,session_id:0,zone_id:0}}),l=U({visible:!1,loading:!1,activeTab:"basic",data:null}),P=async i=>{l.visible=!0,l.loading=!0,l.activeTab="basic",l.data=null;try{const s=await m.api.postData("statistics",{id:i.id});s.code===1?l.data=s.data:C.error(s.msg||"获取统计信息失败")}catch(s){C.error(s.message||"获取统计信息失败")}finally{l.loading=!1}},z=Q(["edit","delete"]);return z.unshift({render:"tipButton",name:"statistics",title:"查看统计",text:"统计",type:"primary",icon:"fa fa-bar-chart",class:"table-row-statistics",click:i=>{P(i)},display:()=>!0}),z.forEach(i=>{i.name!=="statistics"&&(i.display=()=>!0)}),m.table.column[m.table.column.length-1].buttons=z,m.table.column[m.table.column.length-1].width=200,m.mount(),m.getData(),H("baTable",m),(i,s)=>{const y=u("el-alert"),_=u("el-descriptions-item"),W=u("el-descriptions"),g=u("el-tab-pane"),p=u("el-statistic"),c=u("el-col"),k=u("el-row"),d=u("el-table-column"),w=u("el-tag"),B=u("el-table"),A=u("el-icon"),O=u("el-tooltip"),Z=u("el-tabs"),K=u("el-dialog"),L=$("loading");return f(),V("div",ee,[x(m).table.remark?(f(),v(y,{key:0,class:"ba-table-alert",title:x(m).table.remark,type:"info","show-icon":""},null,8,["title"])):h("",!0),t(X,{buttons:["refresh","add","edit","delete","comSearch","quickSearch","columnDisplay"],"quick-search-placeholder":x(b)("Quick search placeholder",{fields:x(b)("collection.item.Title")+"/"+x(b)("Id")})},null,8,["quick-search-placeholder"]),t(J),t(R),t(K,{modelValue:l.visible,"onUpdate:modelValue":s[1]||(s[1]=e=>l.visible=e),title:"藏品统计信息",width:"90%",top:"5vh"},{default:a(()=>[F((f(),V("div",null,[t(Z,{modelValue:l.activeTab,"onUpdate:modelValue":s[0]||(s[0]=e=>l.activeTab=e)},{default:a(()=>[t(g,{label:"基本信息",name:"basic"},{default:a(()=>[l.data?(f(),v(W,{key:0,column:2,border:""},{default:a(()=>[t(_,{label:"藏品ID"},{default:a(()=>{var e;return[r(o((e=l.data.basic_info)==null?void 0:e.id),1)]}),_:1}),t(_,{label:"藏品标题"},{default:a(()=>{var e;return[r(o((e=l.data.basic_info)==null?void 0:e.title),1)]}),_:1}),t(_,{label:"当前价格"},{default:a(()=>{var e;return[r("¥"+o((e=l.data.basic_info)==null?void 0:e.price),1)]}),_:1}),t(_,{label:"发行价格"},{default:a(()=>{var e;return[r("¥"+o((e=l.data.basic_info)==null?void 0:e.issue_price),1)]}),_:1}),t(_,{label:"库存"},{default:a(()=>{var e;return[r(o((e=l.data.basic_info)==null?void 0:e.stock),1)]}),_:1}),t(_,{label:"销量"},{default:a(()=>{var e;return[r(o((e=l.data.basic_info)==null?void 0:e.sales),1)]}),_:1}),t(_,{label:"状态"},{default:a(()=>{var e;return[r(o((e=l.data.basic_info)==null?void 0:e.status_text),1)]}),_:1}),t(_,{label:"创建时间"},{default:a(()=>{var e;return[r(o((e=l.data.basic_info)==null?void 0:e.create_time),1)]}),_:1}),t(_,{label:"确权编号",span:2},{default:a(()=>{var e;return[r(o(((e=l.data.basic_info)==null?void 0:e.asset_code)||"未生成"),1)]}),_:1}),t(_,{label:"存证指纹",span:2},{default:a(()=>{var e;return[E("span",te,o(((e=l.data.basic_info)==null?void 0:e.fingerprint)||"未生成"),1)]}),_:1})]),_:1})):h("",!0)]),_:1}),t(g,{label:"交易统计",name:"trade"},{default:a(()=>[l.data?(f(),v(k,{key:0,gutter:20},{default:a(()=>[t(c,{span:6},{default:a(()=>{var e;return[t(p,{title:"交易次数",value:((e=l.data.trade_statistics)==null?void 0:e.total_trades)||0},null,8,["value"])]}),_:1}),t(c,{span:6},{default:a(()=>{var e;return[t(p,{title:"不同买家数",value:((e=l.data.trade_statistics)==null?void 0:e.unique_buyers)||0},null,8,["value"])]}),_:1}),t(c,{span:6},{default:a(()=>{var e;return[t(p,{title:"交易总额",value:((e=l.data.trade_statistics)==null?void 0:e.total_amount)||0,precision:2,prefix:"¥"},null,8,["value"])]}),_:1}),t(c,{span:6},{default:a(()=>{var e;return[E("div",ae,[s[2]||(s[2]=E("div",{class:"el-statistic__head"},"首次交易",-1)),E("div",le,o(((e=l.data.trade_statistics)==null?void 0:e.first_trade_time)||"-"),1)])]}),_:1})]),_:1})):h("",!0)]),_:1}),t(g,{label:"交易用户明细",name:"trade_users"},{default:a(()=>{var e;return[t(B,{data:((e=l.data)==null?void 0:e.trade_users)||[],stripe:"",border:"","max-height":"500"},{default:a(()=>[t(d,{prop:"user_id",label:"用户ID",width:"80",align:"center"}),t(d,{prop:"username",label:"用户名",width:"120",align:"center"}),t(d,{prop:"nickname",label:"昵称",width:"120",align:"center"}),t(d,{prop:"price",label:"购买价格",width:"100",align:"center"},{default:a(({row:n})=>[r("¥"+o(n.price),1)]),_:1}),t(d,{prop:"buy_time_text",label:"购买时间",width:"160",align:"center"}),t(d,{prop:"delivery_status_text",label:"交付状态",width:"100",align:"center"},{default:a(({row:n})=>[t(w,{type:n.delivery_status===0?"success":"warning",size:"small"},{default:a(()=>[r(o(n.delivery_status_text),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"consignment_status_text",label:"寄售状态",width:"100",align:"center"},{default:a(({row:n})=>[t(w,{type:n.consignment_status===0?"info":n.consignment_status===1?"warning":"success",size:"small"},{default:a(()=>[r(o(n.consignment_status_text),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"is_old_asset_package_text",label:"旧资产包",width:"100",align:"center"},{default:a(({row:n})=>[t(w,{type:n.is_old_asset_package===1?"danger":"",size:"small"},{default:a(()=>[r(o(n.is_old_asset_package_text),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]}),_:1}),t(g,{label:"寄售统计",name:"consignment"},{default:a(()=>[l.data?(f(),v(k,{key:0,gutter:20,style:{"margin-bottom":"20px"}},{default:a(()=>[t(c,{span:4},{default:a(()=>{var e;return[t(p,{title:"寄售总次数",value:((e=l.data.consignment_statistics)==null?void 0:e.total_consignments)||0},null,8,["value"])]}),_:1}),t(c,{span:4},{default:a(()=>{var e;return[t(p,{title:"寄售中",value:((e=l.data.consignment_statistics)==null?void 0:e.consigning)||0},null,8,["value"])]}),_:1}),t(c,{span:4},{default:a(()=>{var e;return[t(p,{title:"已售出",value:((e=l.data.consignment_statistics)==null?void 0:e.sold)||0},null,8,["value"])]}),_:1}),t(c,{span:4},{default:a(()=>{var e;return[t(p,{title:"已下架",value:((e=l.data.consignment_statistics)==null?void 0:e.offshelf)||0},null,8,["value"])]}),_:1}),t(c,{span:4},{default:a(()=>{var e;return[t(p,{title:"已取消",value:((e=l.data.consignment_statistics)==null?void 0:e.cancelled)||0},null,8,["value"])]}),_:1}),t(c,{span:4},{default:a(()=>{var e;return[t(p,{title:"失败次数",value:((e=l.data.consignment_statistics)==null?void 0:e.failed)||0},{suffix:a(()=>[t(O,{content:"失败次数 = 已下架 + 已取消"},{default:a(()=>[t(A,null,{default:a(()=>[t(x(G))]),_:1})]),_:1})]),_:1},8,["value"])]}),_:1})]),_:1})):h("",!0),l.data?(f(),v(k,{key:1,gutter:20},{default:a(()=>[t(c,{span:8},{default:a(()=>{var e;return[t(p,{title:"平均寄售价格",value:((e=l.data.consignment_statistics)==null?void 0:e.avg_consignment_price)||0,precision:2,prefix:"¥"},null,8,["value"])]}),_:1}),t(c,{span:8},{default:a(()=>{var e;return[t(p,{title:"最低寄售价格",value:((e=l.data.consignment_statistics)==null?void 0:e.min_consignment_price)||0,precision:2,prefix:"¥"},null,8,["value"])]}),_:1}),t(c,{span:8},{default:a(()=>{var e;return[t(p,{title:"最高寄售价格",value:((e=l.data.consignment_statistics)==null?void 0:e.max_consignment_price)||0,precision:2,prefix:"¥"},null,8,["value"])]}),_:1})]),_:1})):h("",!0)]),_:1}),t(g,{label:"寄售明细",name:"consignment_list"},{default:a(()=>{var e;return[t(B,{data:((e=l.data)==null?void 0:e.consignment_list)||[],stripe:"",border:"","max-height":"500"},{default:a(()=>[t(d,{prop:"consignment_id",label:"寄售ID",width:"80",align:"center"}),t(d,{prop:"user_id",label:"用户ID",width:"80",align:"center"}),t(d,{prop:"username",label:"用户名",width:"120",align:"center"}),t(d,{prop:"consignment_price",label:"寄售价格",width:"100",align:"center"},{default:a(({row:n})=>[r("¥"+o(n.consignment_price),1)]),_:1}),t(d,{prop:"service_fee",label:"服务费",width:"100",align:"center"},{default:a(({row:n})=>[r("¥"+o(n.service_fee),1)]),_:1}),t(d,{prop:"total_cost",label:"总成本",width:"100",align:"center"},{default:a(({row:n})=>[r("¥"+o(n.total_cost),1)]),_:1}),t(d,{prop:"status_text",label:"状态",width:"100",align:"center"},{default:a(({row:n})=>[t(w,{type:n.status===2?"success":n.status===1?"warning":n.status===3?"info":"danger",size:"small"},{default:a(()=>[r(o(n.status_text),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"is_old_asset_package_text",label:"旧资产包",width:"100",align:"center"},{default:a(({row:n})=>[t(w,{type:n.is_old_asset_package===1?"danger":"",size:"small"},{default:a(()=>[r(o(n.is_old_asset_package_text),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"create_time_text",label:"创建时间",width:"160",align:"center"})]),_:1},8,["data"])]}),_:1}),t(g,{label:"盲盒预约",name:"blind_box"},{default:a(()=>[l.data?(f(),v(k,{key:0,gutter:20},{default:a(()=>[t(c,{span:6},{default:a(()=>{var e;return[t(p,{title:"预约总数",value:((e=l.data.blind_box_statistics)==null?void 0:e.total_reservations)||0},null,8,["value"])]}),_:1}),t(c,{span:6},{default:a(()=>{var e;return[t(p,{title:"中签数",value:((e=l.data.blind_box_statistics)==null?void 0:e.won)||0},null,8,["value"])]}),_:1}),t(c,{span:6},{default:a(()=>{var e;return[t(p,{title:"未中签",value:((e=l.data.blind_box_statistics)==null?void 0:e.not_won)||0},null,8,["value"])]}),_:1}),t(c,{span:6},{default:a(()=>{var e;return[t(p,{title:"待处理",value:((e=l.data.blind_box_statistics)==null?void 0:e.pending)||0},null,8,["value"])]}),_:1})]),_:1})):h("",!0)]),_:1})]),_:1},8,["modelValue"])])),[[L,l.loading]])]),_:1},8,["modelValue"])])}}});export{be as default};
