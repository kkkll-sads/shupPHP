import{v as K,b as Q,T as W,am as ee,an as ae,ao as se,_ as te}from"./index-BR6nH71S.js";import{B as ne,b as C,a as oe,a2 as u,l as I,o as re,I as _,Z as ce,_ as N,C as k,D,H as o,P as l,G as a,X as r,u as d,$ as U,a0 as le,U as $,O as de,a1 as ie}from"./vue-DnSQgQf0.js";const ue={class:"sign-in-page"},_e={class:"stats-body"},ge={class:"stat-item"},fe={class:"stat-title"},pe={class:"stat-value"},me={class:"stat-item"},ve={class:"stat-title"},he={class:"stat-value"},ye={class:"stat-item"},Ie={class:"stat-title"},we={class:"stat-value"},De={class:"stats-footer"},be={class:"action-body"},Ye={class:"action-info"},Me={class:"action-status"},Se={class:"action-tip"},xe={class:"action-tip"},Ce={class:"calendar-header"},ke={class:"calendar-toolbar"},Ve={class:"calendar-current"},Re={class:"calendar-day"},ze={key:0,class:"pagination"},Le={class:"success-dialog"},Te={class:"success-text"},Be={key:0,class:"success-tip"},Ne=ne({__name:"signIn",setup(Ue){const{t:n}=K.useI18n(),V=Q(),c=C(null),b=C([]),E=C(),e=oe({loading:!1,signLoading:!1,calendarDate:u().format("YYYY-MM-DD"),records:[],recordsLoading:!1,page:1,pageSize:10,total:0,successVisible:!1,successInfo:{reward:0,referrerReward:0}}),O=I(()=>new Set(b.value)),R=I(()=>{var s;return(s=c.value)!=null&&s.calendar?{start:c.value.calendar.start,end:c.value.calendar.end}:{start:u().startOf("month").format("YYYY-MM-DD"),end:u().endOf("month").format("YYYY-MM-DD")}}),P=I(()=>u(e.calendarDate).format("YYYY-MM")),j=I(()=>{var s;return(s=c.value)!=null&&s.today_signed?n("user.account.signIn.Signed today"):n("user.account.signIn.Not signed today")}),F=I(()=>{var s;return(s=c.value)!=null&&s.today_signed?n("user.account.signIn.Signed today"):n("user.account.signIn.Sign now")}),A=async()=>{var s;e.loading=!0;try{const t=await ee();c.value=t.data,b.value=((s=t.data.calendar)==null?void 0:s.signed_dates)??[],e.calendarDate=u().format("YYYY-MM-DD")}finally{e.loading=!1}},Y=async()=>{e.recordsLoading=!0;try{const s=await ae(e.page,e.pageSize);e.records=s.data.records||[],e.total=s.data.total||0}finally{e.recordsLoading=!1}},G=async()=>{var s;if(!e.signLoading){e.signLoading=!0;try{const t=await se();c.value=t.data,b.value=((s=t.data.calendar)==null?void 0:s.signed_dates)??[],e.calendarDate=t.data.sign_date??e.calendarDate,e.successInfo.reward=t.data.today_reward??0,e.successInfo.referrerReward=t.data.referrer_reward??0,e.successVisible=!0,t.data.today_reward&&V.dataFill({score:V.score+t.data.today_reward}),ie.success(t.msg||n("user.account.signIn.Success title")),await Y()}finally{e.signLoading=!1}}},z=s=>{M(s)&&(e.calendarDate=u(e.calendarDate).add(s,"month").format("YYYY-MM-DD"))},M=s=>{var w;if(!((w=c.value)!=null&&w.calendar))return!0;const t=u(e.calendarDate).add(s,"month"),g=u(c.value.calendar.start),h=u(c.value.calendar.end),f=t.year()*12+t.month(),m=g.year()*12+g.month(),S=h.year()*12+h.month();return f>=m&&f<=S},H=({date:s})=>{e.calendarDate=u(s).format("YYYY-MM-DD")},X=s=>{e.page=s,Y()};return re(async()=>{await A(),await Y()}),(s,t)=>{const g=_("el-card"),h=_("el-col"),f=_("Icon"),m=_("el-button"),S=_("el-row"),w=_("el-calendar"),x=_("el-table-column"),Z=_("el-table"),q=_("el-pagination"),J=_("el-dialog"),L=ce("loading");return N((D(),k("div",ue,[o(S,{gutter:20},{default:l(()=>[o(h,{xs:24,sm:12},{default:l(()=>[o(g,{shadow:"hover",class:"stats-card"},{header:l(()=>[a("span",null,r(d(n)("user.account.signIn.Stats title")),1)]),default:l(()=>{var i,v,p,y;return[a("div",_e,[a("div",ge,[a("div",fe,r(d(n)("user.account.signIn.Total points")),1),a("div",pe,r(((i=c.value)==null?void 0:i.total_reward)??0),1)]),a("div",me,[a("div",ve,r(d(n)("user.account.signIn.Today points")),1),a("div",he,r(((v=c.value)==null?void 0:v.today_reward)??0),1)]),a("div",ye,[a("div",Ie,r(d(n)("user.account.signIn.Streak days")),1),a("div",we,r(((p=c.value)==null?void 0:p.streak)??0),1)])]),a("div",De,[a("span",null,r(d(n)("user.account.signIn.Sign days summary",{days:((y=c.value)==null?void 0:y.sign_days)??0})),1)])]}),_:1})]),_:1}),o(h,{xs:24,sm:12},{default:l(()=>[o(g,{shadow:"hover",class:"action-card"},{header:l(()=>[a("span",null,r(d(n)("user.account.signIn.Action title")),1)]),default:l(()=>{var i,v,p,y,T,B;return[a("div",be,[a("div",Ye,[a("p",Me,[o(f,{name:(i=c.value)!=null&&i.today_signed?"fa fa-check-circle":"fa fa-clock-o",size:"22",color:(v=c.value)!=null&&v.today_signed?"var(--el-color-success)":"var(--el-color-primary)"},null,8,["name","color"]),a("span",null,r(j.value),1)]),a("p",Se,r(d(n)("user.account.signIn.Daily reward tip",{score:((p=c.value)==null?void 0:p.daily_reward)??0})),1),a("p",xe,r(d(n)("user.account.signIn.Referrer reward tip",{score:((T=(y=c.value)==null?void 0:y.config)==null?void 0:T.referrer_reward)??0})),1)]),o(m,{type:"primary",size:"large",loading:e.signLoading,disabled:!!((B=c.value)!=null&&B.today_signed),onClick:G},{default:l(()=>[U(r(F.value),1)]),_:1},8,["loading","disabled"])])]}),_:1})]),_:1})]),_:1}),o(g,{shadow:"hover",class:"calendar-card"},{header:l(()=>[a("div",Ce,[a("span",null,r(d(n)("user.account.signIn.Calendar title")),1),a("div",ke,[o(m,{round:"",onClick:t[0]||(t[0]=i=>z(-1)),disabled:!M(-1)},{default:l(()=>[o(f,{name:"fa fa-angle-left"})]),_:1},8,["disabled"]),a("span",Ve,r(P.value),1),o(m,{round:"",onClick:t[1]||(t[1]=i=>z(1)),disabled:!M(1)},{default:l(()=>[o(f,{name:"fa fa-angle-right"})]),_:1},8,["disabled"])])])]),default:l(()=>[o(w,{ref_key:"calendarRef",ref:E,modelValue:e.calendarDate,"onUpdate:modelValue":t[2]||(t[2]=i=>e.calendarDate=i),range:[R.value.start,R.value.end],onPanelChange:H},{"date-cell":l(({data:i})=>[a("div",{class:le(["calendar-cell",{"is-selected":O.value.has(i.day),"is-today":i.isToday}])},[a("span",Re,r(i.day.split("-").pop()),1)],2)]),_:1},8,["modelValue","range"])]),_:1}),o(g,{shadow:"hover",class:"records-card"},{header:l(()=>[a("span",null,r(d(n)("user.account.signIn.Record title")),1)]),default:l(()=>[N((D(),de(Z,{data:e.records,"empty-text":d(n)("No data")},{default:l(()=>[o(x,{prop:"date",label:d(n)("user.account.signIn.Record date"),width:"160"},null,8,["label"]),o(x,{prop:"reward_score",label:d(n)("user.account.signIn.Record reward"),width:"160",align:"center"},null,8,["label"]),o(x,{prop:"create_time",label:d(n)("user.account.signIn.Record time"),formatter:(i,v,p)=>d(W)(p),"min-width":"180"},null,8,["label","formatter"])]),_:1},8,["data","empty-text"])),[[L,e.recordsLoading]]),e.total>e.pageSize?(D(),k("div",ze,[o(q,{layout:"prev, pager, next",total:e.total,"page-size":e.pageSize,"current-page":e.page,onCurrentChange:X,small:""},null,8,["total","page-size","current-page"])])):$("",!0)]),_:1}),o(J,{modelValue:e.successVisible,"onUpdate:modelValue":t[4]||(t[4]=i=>e.successVisible=i),title:d(n)("user.account.signIn.Success title"),width:"360px","close-on-click-modal":!1},{footer:l(()=>[o(m,{type:"primary",onClick:t[3]||(t[3]=i=>e.successVisible=!1)},{default:l(()=>[U(r(d(n)("Confirm")),1)]),_:1})]),default:l(()=>[a("div",Le,[o(f,{name:"fa fa-gift",size:"36",color:"var(--el-color-warning)"}),a("p",Te,r(d(n)("user.account.signIn.Success reward",{score:e.successInfo.reward})),1),e.successInfo.referrerReward>0?(D(),k("p",Be,r(d(n)("user.account.signIn.Success referrer",{score:e.successInfo.referrerReward})),1)):$("",!0)])]),_:1},8,["modelValue","title"])])),[[L,e.loading]])}}}),Oe=te(Ne,[["__scopeId","data-v-18343ccf"]]);export{Oe as default};
