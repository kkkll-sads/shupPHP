import{B as N,b as c,a as q,o as F,I as n,C as E,D as H,G as i,H as o,P as s,u as P,aF as T,$ as y,a1 as d}from"./vue-BMJJ5Kg4.js";import{c as h,_ as j}from"./index-DRv2sWQF.js";const A={class:"rights-declaration-page"},G={class:"container"},J={class:"declaration-form"},O={class:"upload-section"},W=N({__name:"index",setup($){const f=c(!1),p=c(),x=c(),g=c([]),a=q({voucher_type:"",amount:0,images:[],remark:""}),k={voucher_type:[{required:!0,message:"请选择凭证类型",trigger:"change"}],amount:[{required:!0,message:"请输入申请金额",trigger:"blur"},{type:"number",min:.01,message:"金额不能小于0.01元",trigger:"blur"},{type:"number",max:1e5,message:"金额不能超过10万元",trigger:"blur"}],images:[{required:!0,message:"请上传至少一张凭证图片",trigger:"change"}]},w={"ba-token":localStorage.getItem("ba-token")||"","ba-user-token":localStorage.getItem("ba-user-token")||""},_=async()=>{try{const t=await h({url:"/api/rightsDeclaration/reviewStatus",method:"get",params:{status:"pending",page:1,limit:1}});t.code===1&&t.data.pending_count>0&&V()}catch(t){console.error("检查审核状态失败:",t)}},V=()=>{window.location.href="/rightsDeclaration/review"},D=(t,e,r)=>{t.code===1?a.images.push(t.data.url):d.error(t.msg||"上传失败")},R=(t,e)=>{const r=a.images.findIndex(l=>l.includes(t.name));r>-1&&a.images.splice(r,1)},U=t=>{const e=t.type.startsWith("image/"),r=t.size/1024/1024<10;return e?r?!0:(d.error("上传图片大小不能超过 10MB!"),!1):(d.error("只能上传图片文件!"),!1)},C=async()=>{p.value&&await p.value.validate(async t=>{var e,r;if(t){f.value=!0;try{const l=await h({url:"/api/rightsDeclaration/submit",method:"post",data:{voucher_type:a.voucher_type,amount:a.amount,images:JSON.stringify(a.images),remark:a.remark}});l.code===1?(d.success("确权申报提交成功，请等待管理员审核"),v(),await _()):d.error(l.msg||"提交失败")}catch(l){console.error("提交申报失败:",l),d.error((l==null?void 0:l.msg)||((r=(e=l==null?void 0:l.response)==null?void 0:e.data)==null?void 0:r.msg)||"提交失败，请稍后重试")}finally{f.value=!1}}})},v=()=>{var t;(t=p.value)==null||t.resetFields(),a.images=[],g.value=[]};return F(()=>{_()}),(t,e)=>{const r=n("el-option"),l=n("el-select"),m=n("el-form-item"),I=n("el-input-number"),L=n("el-icon"),S=n("el-upload"),B=n("el-input"),b=n("el-button"),z=n("el-form"),M=n("el-card");return H(),E("div",A,[i("div",G,[e[10]||(e[10]=i("h1",{class:"page-title"},"确权申报",-1)),i("div",J,[o(M,{class:"form-card"},{header:s(()=>e[4]||(e[4]=[i("div",{class:"card-header"},[i("span",null,"提交确权申报")],-1)])),default:s(()=>[o(z,{ref_key:"formRef",ref:p,model:a,rules:k,"label-width":"120px",size:"large"},{default:s(()=>[o(m,{label:"凭证类型",prop:"voucher_type"},{default:s(()=>[o(l,{modelValue:a.voucher_type,"onUpdate:modelValue":e[0]||(e[0]=u=>a.voucher_type=u),placeholder:"请选择凭证类型"},{default:s(()=>[o(r,{label:"截图",value:"screenshot"}),o(r,{label:"转账记录",value:"transfer_record"}),o(r,{label:"其他凭证",value:"other"})]),_:1},8,["modelValue"])]),_:1}),o(m,{label:"申请金额",prop:"amount"},{default:s(()=>[o(I,{modelValue:a.amount,"onUpdate:modelValue":e[1]||(e[1]=u=>a.amount=u),min:.01,max:1e5,precision:2,"controls-position":"right",placeholder:"请输入申请金额",style:{width:"200px"}},null,8,["modelValue"]),e[5]||(e[5]=i("span",{class:"unit-text"},"元",-1))]),_:1}),o(m,{label:"凭证图片",prop:"images"},{default:s(()=>[i("div",O,[o(S,{ref_key:"uploadRef",ref:x,"file-list":g.value,"onUpdate:fileList":e[2]||(e[2]=u=>g.value=u),action:"/api/common/upload",headers:w,"on-success":D,"on-remove":R,"before-upload":U,multiple:"",limit:10,"list-type":"picture-card",accept:"image/*"},{default:s(()=>[o(L,null,{default:s(()=>[o(P(T))]),_:1}),e[6]||(e[6]=i("div",{class:"upload-text"},"上传图片",-1))]),_:1},8,["file-list"]),e[7]||(e[7]=i("div",{class:"upload-tips"},[i("p",null,"最多上传10张图片，支持jpg、png、gif格式")],-1))])]),_:1}),o(m,{label:"备注",prop:"remark"},{default:s(()=>[o(B,{modelValue:a.remark,"onUpdate:modelValue":e[3]||(e[3]=u=>a.remark=u),type:"textarea",rows:4,placeholder:"请输入备注信息（可选）",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(m,null,{default:s(()=>[o(b,{type:"primary",onClick:C,loading:f.value,size:"large"},{default:s(()=>e[8]||(e[8]=[y(" 提交申报 ")])),_:1},8,["loading"]),o(b,{onClick:v,size:"large"},{default:s(()=>e[9]||(e[9]=[y(" 重置 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])])])}}}),X=j(W,[["__scopeId","data-v-b9d6dbb2"]]);export{X as default};
