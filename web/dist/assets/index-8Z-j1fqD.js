import{B as M,a as h,a1 as k,I as p,C as q,D as c,O as _,U as b,G as m,H as a,u as S,a9 as P,P as t,$ as r,X as i,at as X}from"./vue-BMJJ5Kg4.js";import{b as Y}from"./baTable-C5P52-5P.js";import{_ as J}from"./popupForm.vue_vue_type_script_setup_true_lang-DEl19VJm.js";import{T as Q,a as Z}from"./index-CY3WncDq.js";import{a5 as ee,ab as $,c as E,f as A}from"./index-BHof7fb5.js";import"./validate-Dn7fuoi2.js";import"./index-1f7Hqibh.js";const te={class:"default-main ba-table-box"},ae={style:{"margin-bottom":"13px",display:"flex","align-items":"center",gap:"10px"}},le={style:{"font-size":"20px","font-weight":"bold","margin-top":"5px"}},oe={style:{"font-size":"20px","font-weight":"bold","margin-top":"5px",color:"#e6a23c"}},ne={style:{"font-size":"20px","font-weight":"bold","margin-top":"5px",color:"#67c23a"}},re={style:{"font-size":"20px","font-weight":"bold","margin-top":"5px",color:"#f56c6c"}},be=M({name:"finance/withdrawReview",__name:"index",setup(ie){const j={0:"待审核",1:"审核通过",2:"审核拒绝"},U={0:"warning",1:"success",2:"danger"},V=h({paymentSearch:""}),x=h({total_amount:"0.00",pending_amount:"0.00",approved_amount:"0.00",rejected_amount:"0.00"});(async()=>{try{const o=await E({url:"/admin/finance.WithdrawReview/stats",method:"get"});Object.assign(x,o.data.stats)}catch{}})();const D=()=>{f.table.filter.payment_search=V.paymentSearch,f.onTableHeaderAction("refresh",{})},f=new Y(new ee("/admin/finance.WithdrawReview/"),{column:[{type:"selection",align:"center",operator:!1},{label:"ID",prop:"id",align:"center",operator:"=",width:70},{label:"申请方",prop:"applicant_name",align:"center",operator:"LIKE"},{label:"申请类型",prop:"applicant_type_text",align:"center",operator:"select",operatorOptions:[{label:"用户",value:"user"},{label:"公司",value:"company"},{label:"合作方",value:"partner"}],replaceValue:{user:"用户",company:"公司",partner:"合作方"},width:100},{label:"申请方ID",prop:"applicant_id",align:"center",operator:"=",width:110},{label:"手机号",prop:"applicant_mobile",align:"center",operator:"LIKE",width:130},{label:"收款方式",prop:"type_text",align:"center",operator:"select",operatorOptions:[{label:"微信",value:"微信"},{label:"支付宝",value:"支付宝"},{label:"银行卡",value:"银行卡"},{label:"USDT",value:"USDT"}],replaceValue:{微信:"微信",支付宝:"支付宝",银行卡:"银行卡",USDT:"USDT"},width:100},{label:"收款姓名",prop:"account_name",align:"center",operator:"LIKE",width:100},{label:"收款账号",prop:"account_number",align:"center",operator:"LIKE",width:180},{label:"开户行",prop:"bank_name",align:"center",operator:"LIKE",width:150},{label:"提现金额",prop:"amount",align:"center",operator:"RANGE",width:120,render:(o=>{const e=o.amount;if(e==null||e==="")return"-";const d=parseFloat(e);return isNaN(d)?"-":"¥"+d.toFixed(2)})},{label:"手续费",prop:"fee",align:"center",operator:!1,width:100,render:(o=>{const e=o.fee;if(e==null||e==="")return"-";const d=parseFloat(e);return isNaN(d)?"-":"¥"+d.toFixed(2)})},{label:"实际到账",prop:"actual_amount",align:"center",operator:"RANGE",width:120,render:(o=>{const e=o.actual_amount;if(e==null||e==="")return"-";const d=parseFloat(e);return isNaN(d)?"-":"¥"+d.toFixed(2)})},{label:"状态",prop:"status",align:"center",operator:"select",operatorOptions:[{label:"待审核",value:"0"},{label:"审核通过",value:"1"},{label:"审核拒绝",value:"2"}],replaceValue:j,render:"tag",custom:U,width:110},{label:"审核时间",prop:"audit_time",align:"center",operator:"RANGE",render:"datetime",width:160},{label:"创建时间",prop:"create_time",align:"center",operator:"RANGE",render:"datetime",width:160},{label:"操作",align:"center",width:220,render:"buttons",buttons:(o=>{const e=[];return e.push({render:"tipButton",name:"read",title:"查看详情",text:"",type:"primary",icon:"fa fa-eye",class:"table-row-read",display:()=>$("read"),click:()=>{B(o)}}),o.status==0&&(e.push({render:"tipButton",name:"approve",title:"审核通过",text:"",type:"success",icon:"fa fa-check",class:"table-row-approve",display:()=>$("approve"),click:()=>{F(o,"approve")}}),e.push({render:"tipButton",name:"reject",title:"审核拒绝",text:"",type:"danger",icon:"fa fa-times",class:"table-row-reject",display:()=>$("reject"),click:()=>{F(o,"reject")}})),e}),operator:!1}],dblClickNotEditColumn:[void 0]}),n=h({visible:!1,loading:!1,type:"approve",title:"",form:{id:0,applicant:"",amount:"",audit_remark:""}}),l=h({visible:!1,data:null}),F=(o,e)=>{n.type=e,n.title=e==="approve"?"审核通过":"审核拒绝";const d=o.amount?parseFloat(o.amount).toFixed(2):"0.00";n.form={id:o.id,applicant:`${o.applicant_name} (${o.applicant_type_text||""})`,amount:d,audit_remark:""},n.visible=!0},I=async()=>{if(n.type==="reject"&&!n.form.audit_remark.trim()){k.warning("拒绝原因不能为空");return}n.loading=!0;try{const o=n.type==="approve"?"/admin/finance.WithdrawReview/approve":"/admin/finance.WithdrawReview/reject",e=await E({url:o,method:"post",data:{id:n.form.id,audit_remark:n.form.audit_remark}});k.success(e.msg||"操作成功"),n.visible=!1,f.getData()}catch(o){!o.msg&&o.message&&k.error(o.message||"操作失败")}finally{n.loading=!1}},B=async o=>{try{const e=await E({url:"/admin/finance.WithdrawReview/read",method:"get",params:{id:o.id}});l.data=e.data.row,l.visible=!0}catch(e){!e.msg&&e.message&&k.error(e.message||"获取详情失败")}},K=o=>U[String(o)]||"info",N=o=>{if(o==null||o==="")return"-";const e=parseFloat(o);return isNaN(e)?"-":"¥"+e.toFixed(2)},G=o=>{if(!o)return"-";const e=new Date(o*1e3),d=e.getFullYear(),y=(e.getMonth()+1).toString().padStart(2,"0"),g=e.getDate().toString().padStart(2,"0"),v=e.getHours().toString().padStart(2,"0"),w=e.getMinutes().toString().padStart(2,"0"),T=e.getSeconds().toString().padStart(2,"0");return`${d}-${y}-${g} ${v}:${w}:${T}`};return f.mount(),f.getData(),X("baTable",f),(o,e)=>{const d=p("el-alert"),y=p("el-input"),g=p("el-button"),v=p("el-card"),w=p("el-col"),T=p("el-row"),C=p("el-form-item"),L=p("el-form"),R=p("el-dialog"),s=p("el-descriptions-item"),O=p("el-tag"),z=p("el-descriptions"),W=p("el-divider"),H=p("el-image");return c(),q("div",te,[S(f).table.remark?(c(),_(d,{key:0,class:"ba-table-alert",title:S(f).table.remark,type:"info","show-icon":""},null,8,["title"])):b("",!0),m("div",ae,[e[9]||(e[9]=m("div",{style:{"font-size":"14px",color:"#606266"}},"收款信息：",-1)),a(y,{modelValue:V.paymentSearch,"onUpdate:modelValue":e[0]||(e[0]=u=>V.paymentSearch=u),placeholder:"搜索收款姓名/账号/银行",style:{width:"250px"},clearable:"",onKeyup:P(D,["enter"]),onClear:D},null,8,["modelValue"]),a(g,{type:"primary",onClick:D},{default:t(()=>e[8]||(e[8]=[r("搜索")])),_:1})]),a(T,{gutter:20,style:{"margin-bottom":"20px"}},{default:t(()=>[a(w,{xs:12,sm:6},{default:t(()=>[a(v,{shadow:"never","body-style":"padding: 15px;"},{default:t(()=>[e[10]||(e[10]=m("div",{style:{"font-size":"14px",color:"#909399"}},"总提现金额",-1)),m("div",le,"¥"+i(x.total_amount),1)]),_:1})]),_:1}),a(w,{xs:12,sm:6},{default:t(()=>[a(v,{shadow:"never","body-style":"padding: 15px;"},{default:t(()=>[e[11]||(e[11]=m("div",{style:{"font-size":"14px",color:"#909399"}},"待审核金额",-1)),m("div",oe,"¥"+i(x.pending_amount),1)]),_:1})]),_:1}),a(w,{xs:12,sm:6},{default:t(()=>[a(v,{shadow:"never","body-style":"padding: 15px;"},{default:t(()=>[e[12]||(e[12]=m("div",{style:{"font-size":"14px",color:"#909399"}},"已通过金额",-1)),m("div",ne,"¥"+i(x.approved_amount),1)]),_:1})]),_:1}),a(w,{xs:12,sm:6},{default:t(()=>[a(v,{shadow:"never","body-style":"padding: 15px;"},{default:t(()=>[e[13]||(e[13]=m("div",{style:{"font-size":"14px",color:"#909399"}},"已拒绝金额",-1)),m("div",re,"¥"+i(x.rejected_amount),1)]),_:1})]),_:1})]),_:1}),a(Q,{buttons:["refresh","export","add","edit","delete","comSearch","quickSearch","columnDisplay"],"quick-search-placeholder":"快速搜索：申请方名称/类型/手机号"}),a(Z),a(J),a(R,{modelValue:n.visible,"onUpdate:modelValue":e[5]||(e[5]=u=>n.visible=u),title:n.title,width:"520px","close-on-click-modal":!1},{footer:t(()=>[a(g,{onClick:e[4]||(e[4]=u=>n.visible=!1)},{default:t(()=>e[15]||(e[15]=[r("取消")])),_:1}),a(g,{type:"primary",onClick:I,loading:n.loading},{default:t(()=>[r(i(n.type==="approve"?"通过":"拒绝"),1)]),_:1},8,["loading"])]),default:t(()=>[a(L,{model:n.form,"label-width":"120px"},{default:t(()=>[a(C,{label:"申请方"},{default:t(()=>[a(y,{modelValue:n.form.applicant,"onUpdate:modelValue":e[1]||(e[1]=u=>n.form.applicant=u),disabled:""},null,8,["modelValue"])]),_:1}),a(C,{label:"提现金额"},{default:t(()=>[a(y,{modelValue:n.form.amount,"onUpdate:modelValue":e[2]||(e[2]=u=>n.form.amount=u),disabled:""},{append:t(()=>e[14]||(e[14]=[r("元")])),_:1},8,["modelValue"])]),_:1}),a(C,{label:"审核备注"},{default:t(()=>[a(y,{modelValue:n.form.audit_remark,"onUpdate:modelValue":e[3]||(e[3]=u=>n.form.audit_remark=u),type:"textarea",rows:4,placeholder:n.type==="approve"?"可以填写审核备注（选填）":"请输入拒绝原因"},null,8,["modelValue","placeholder"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(R,{modelValue:l.visible,"onUpdate:modelValue":e[7]||(e[7]=u=>l.visible=u),title:"提现审核详情",width:"720px","close-on-click-modal":!1},{footer:t(()=>[a(g,{onClick:e[6]||(e[6]=u=>l.visible=!1)},{default:t(()=>e[17]||(e[17]=[r("关闭")])),_:1})]),default:t(()=>[l.data?(c(),_(z,{key:0,column:2,border:""},{default:t(()=>[a(s,{label:"申请方"},{default:t(()=>[r(i(l.data.applicant_name),1)]),_:1}),a(s,{label:"申请类型"},{default:t(()=>[r(i(l.data.applicant_type_text),1)]),_:1}),a(s,{label:"申请方ID"},{default:t(()=>[r(i(l.data.applicant_id||"-"),1)]),_:1}),a(s,{label:"手机号"},{default:t(()=>[r(i(l.data.applicant_mobile||"-"),1)]),_:1}),a(s,{label:"收款方式"},{default:t(()=>[r(i(l.data.type_text||"-"),1)]),_:1}),a(s,{label:"提现金额"},{default:t(()=>[r(i(N(l.data.amount)),1)]),_:1}),a(s,{label:"手续费"},{default:t(()=>[r(i(N(l.data.fee)),1)]),_:1}),a(s,{label:"实际到账"},{default:t(()=>[r(i(N(l.data.actual_amount)),1)]),_:1}),a(s,{label:"状态"},{default:t(()=>[a(O,{type:K(l.data.status)},{default:t(()=>[r(i(l.data.status_text),1)]),_:1},8,["type"])]),_:1}),a(s,{label:"申请时间"},{default:t(()=>[r(i(G(l.data.create_time)),1)]),_:1}),a(s,{label:"审核时间"},{default:t(()=>[r(i(l.data.audit_time_text||"-"),1)]),_:1}),a(s,{label:"审核人"},{default:t(()=>[r(i(l.data.audit_admin_name||"-"),1)]),_:1}),a(s,{label:"申请说明",span:2},{default:t(()=>[r(i(l.data.apply_reason||"-"),1)]),_:1}),a(s,{label:"审核备注",span:2},{default:t(()=>[r(i(l.data.audit_remark||"-"),1)]),_:1})]),_:1})):b("",!0),l.data&&l.data.payment_info?(c(),_(W,{key:1,"content-position":"left"},{default:t(()=>e[16]||(e[16]=[m("span",{style:{"font-size":"16px","font-weight":"bold"}},"收款信息",-1)])),_:1})):b("",!0),l.data&&l.data.payment_info?(c(),_(z,{key:2,column:2,border:""},{default:t(()=>[a(s,{label:"收款方式"},{default:t(()=>[r(i(l.data.payment_info.type_text),1)]),_:1}),a(s,{label:"账户类型"},{default:t(()=>[r(i(l.data.payment_info.account_type_text),1)]),_:1}),a(s,{label:"账户姓名"},{default:t(()=>[r(i(l.data.payment_info.account_name||"-"),1)]),_:1}),l.data.payment_info.account_number?(c(),_(s,{key:0,label:"账号/卡号"},{default:t(()=>[r(i(l.data.payment_info.account_number),1)]),_:1})):b("",!0),l.data.payment_info.bank_name?(c(),_(s,{key:1,label:"开户银行"},{default:t(()=>[r(i(l.data.payment_info.bank_name),1)]),_:1})):b("",!0),l.data.payment_info.bank_branch?(c(),_(s,{key:2,label:"开户支行"},{default:t(()=>[r(i(l.data.payment_info.bank_branch),1)]),_:1})):b("",!0),l.data.payment_info.type==="wechat"&&l.data.payment_info.screenshot?(c(),_(s,{key:3,label:"微信收款码",span:2},{default:t(()=>[a(H,{src:S(A)(l.data.payment_info.screenshot),style:{width:"200px",height:"auto","max-height":"300px",cursor:"pointer"},"preview-src-list":[S(A)(l.data.payment_info.screenshot)],fit:"contain","preview-teleported":""},null,8,["src","preview-src-list"])]),_:1})):b("",!0)]),_:1})):b("",!0)]),_:1},8,["modelValue"])])}}});export{be as default};
