import{v as C,a5 as S,c as O,_ as R}from"./index-DNBbsmjl.js";import{b as V,d as A}from"./baTable-Cho2KrQQ.js";import{T as K,a as L}from"./index-Cl6ixW7i.js";import{_ as P}from"./popupForm.vue_vue_type_script_setup_true_lang-DkgGslHx.js";import{B as q,a as H,o as W,I as d,C as $,D as b,O as w,U as v,H as e,u as y,P as t,$ as g,X as _,G as f,F as I,ai as G,at as M}from"./vue-_nkvHh4F.js";import"./index-BNmCRBQg.js";const j={class:"default-main ba-table-box"},F=q({name:"collection/tradeReservation",__name:"index",setup(Q){const{t:N}=C.useI18n(),l=H({total:0,status:{},today_new:0,today_win:0,current_freeze_amount:0,total_freeze_amount:0,package_zones:[],packages:[],session_options:[]}),k=async()=>{var m;try{const s=await O({url:"/admin/collection.TradeReservation/stats",method:"get"});if(s.code===1&&((m=s.data)!=null&&m.stats)){const r=s.data.stats;l.total=r.total||0,l.status=r.status||{},l.today_new=r.today_new||0,l.today_win=r.today_win||0,l.current_freeze_amount=r.current_freeze_amount||0,l.total_freeze_amount=r.total_freeze_amount||0,l.package_zones=r.package_zones||[],l.packages=r.packages||[],l.session_options=r.session_options||[]}}catch(s){console.error("获取统计数据失败:",s)}};W(()=>{k()});const p=new V(new S("/admin/collection.TradeReservation/"),{column:[{type:"selection",align:"center",operator:!1},{label:"ID",prop:"id",align:"center",operator:"=",operatorPlaceholder:"ID",width:70},{label:"用户ID",prop:"user_id",align:"center",operator:"=",width:80},{label:"用户名",prop:"user.username",align:"center",operator:"LIKE",render:"tags"},{label:"手机号",prop:"user.mobile",align:"center",operator:"LIKE"},{label:"专场",prop:"session.title",align:"center",operator:"LIKE"},{label:"价格分区",prop:"zone.name",align:"center",operator:"LIKE"},{label:"冻结金额",prop:"freeze_amount",align:"center",operator:"BETWEEN"},{label:"消耗算力",prop:"power_used",align:"center",operator:"BETWEEN"},{label:"权重",prop:"weight",align:"center",operator:"BETWEEN"},{label:"状态",prop:"status",align:"center",operator:"=",comSearchRender:"select",comSearchOptions:[{label:"全部",value:""},{label:"待处理",value:0},{label:"已中签",value:1},{label:"未中签",value:2},{label:"已取消",value:3}],render:"tag",custom:{0:"info",1:"success",2:"danger",3:"warning"},replaceValue:{0:"待处理",1:"已中签",2:"未中签",3:"已取消"}},{label:"创建时间",prop:"create_time",align:"center",render:"datetime",sortable:"custom",operator:"RANGE",width:160},{label:"操作",prop:"operate",align:"center",width:100,render:"buttons",buttons:["delete"]}],dblClickNotEditColumn:["all"]},{defaultItems:{status:0}}),D={render:"tipButton",name:"cancel",text:"取消预约",type:"danger",icon:"fa fa-ban",title:"取消预约并退款",display:m=>m.status===0,class:"table-row-cancel",click:m=>{G.confirm("确定要取消该预约吗？冻结资金将自动退回。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{p.api.postData("cancel",{ids:[m.id]}).then(s=>{p.onTableHeaderAction("refresh",{}),k()})}).catch(()=>{})}},x=A(["delete"]);return x.push(D),p.table.column[p.table.column.length-1].buttons=x,p.mount(),p.getData(),M("baTable",p),(m,s)=>{var T,B;const r=d("el-alert"),i=d("el-statistic"),o=d("el-card"),u=d("el-col"),z=d("el-row"),n=d("el-table-column"),h=d("el-tag"),E=d("el-table");return b(),$("div",j,[y(p).table.remark?(b(),w(r,{key:0,class:"ba-table-alert",title:y(p).table.remark,type:"info","show-icon":""},null,8,["title"])):v("",!0),e(z,{gutter:16,style:{"margin-bottom":"15px"}},{default:t(()=>[e(u,{span:4},{default:t(()=>[e(o,{shadow:"hover",class:"stat-card"},{default:t(()=>[e(i,{title:"总预约",value:l.total},null,8,["value"])]),_:1})]),_:1}),e(u,{span:4},{default:t(()=>[e(o,{shadow:"hover",class:"stat-card stat-info"},{default:t(()=>{var a,c;return[e(i,{title:"待处理",value:((c=(a=l.status)==null?void 0:a[0])==null?void 0:c.count)||0},null,8,["value"])]}),_:1})]),_:1}),e(u,{span:4},{default:t(()=>[e(o,{shadow:"hover",class:"stat-card stat-success"},{default:t(()=>{var a,c;return[e(i,{title:"已中签",value:((c=(a=l.status)==null?void 0:a[1])==null?void 0:c.count)||0},null,8,["value"])]}),_:1})]),_:1}),e(u,{span:4},{default:t(()=>[e(o,{shadow:"hover",class:"stat-card stat-danger"},{default:t(()=>{var a,c;return[e(i,{title:"未中签",value:((c=(a=l.status)==null?void 0:a[2])==null?void 0:c.count)||0},null,8,["value"])]}),_:1})]),_:1}),e(u,{span:4},{default:t(()=>[e(o,{shadow:"hover",class:"stat-card"},{default:t(()=>[e(i,{title:"今日新增",value:l.today_new||0},null,8,["value"])]),_:1})]),_:1}),e(u,{span:4},{default:t(()=>[e(o,{shadow:"hover",class:"stat-card stat-success"},{default:t(()=>[e(i,{title:"今日中签",value:l.today_win||0},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(z,{gutter:16,style:{"margin-bottom":"15px"}},{default:t(()=>[e(u,{span:6},{default:t(()=>[e(o,{shadow:"hover",class:"stat-card stat-warning"},{default:t(()=>[e(i,{title:"当前冻结金额",value:l.current_freeze_amount||0,precision:2,prefix:"¥","value-style":"color: #e6a23c"},null,8,["value"])]),_:1})]),_:1}),e(u,{span:6},{default:t(()=>[e(o,{shadow:"hover",class:"stat-card"},{default:t(()=>[e(i,{title:"历史总冻结",value:l.total_freeze_amount||0,precision:2,prefix:"¥","value-style":"color: #909399"},null,8,["value"])]),_:1})]),_:1}),e(u,{span:6},{default:t(()=>[e(o,{shadow:"hover",class:"stat-card"},{default:t(()=>{var a,c;return[e(i,{title:"已取消退款",value:((c=(a=l.status)==null?void 0:a[3])==null?void 0:c.total_amount)||0,precision:2,prefix:"¥","value-style":"color: #909399"},null,8,["value"])]}),_:1})]),_:1}),e(u,{span:6},{default:t(()=>[e(o,{shadow:"hover",class:"stat-card"},{default:t(()=>{var a;return[e(i,{title:"专场数",value:((a=l.sessions)==null?void 0:a.length)||0},null,8,["value"])]}),_:1})]),_:1})]),_:1}),((T=l.package_zones)==null?void 0:T.length)>0?(b(),w(o,{key:1,shadow:"never",style:{"margin-bottom":"15px"}},{header:t(()=>s[0]||(s[0]=[f("span",{style:{"font-weight":"bold"}},"资产包分区统计 (TOP 30)",-1)])),default:t(()=>[e(E,{data:l.package_zones,stripe:"",size:"small","max-height":"300"},{default:t(()=>[e(n,{prop:"name",label:"资产包+分区","min-width":"200","show-overflow-tooltip":""}),e(n,{prop:"count",label:"总预约",align:"center",width:"70"}),e(n,{prop:"pending_count",label:"待处理",align:"center",width:"70"},{default:t(({row:a})=>[e(h,{type:"info",size:"small"},{default:t(()=>[g(_(a.pending_count||0),1)]),_:2},1024)]),_:1}),e(n,{prop:"win_count",label:"已中签",align:"center",width:"70"},{default:t(({row:a})=>[e(h,{type:"success",size:"small"},{default:t(()=>[g(_(a.win_count||0),1)]),_:2},1024)]),_:1}),e(n,{prop:"total_amount",label:"冻结总额",align:"center",width:"90"},{default:t(({row:a})=>[f("span",null,"¥"+_(a.total_amount||0),1)]),_:1}),e(n,{prop:"win_rate",label:"中签率",align:"center",width:"70"},{default:t(({row:a})=>[f("span",{style:I({color:a.win_rate>50?"#67c23a":a.win_rate>20?"#e6a23c":"#f56c6c"})},_(a.win_rate||0)+"% ",5)]),_:1})]),_:1},8,["data"])]),_:1})):v("",!0),((B=l.packages)==null?void 0:B.length)>0?(b(),w(o,{key:2,shadow:"never",style:{"margin-bottom":"15px"}},{header:t(()=>s[1]||(s[1]=[f("span",{style:{"font-weight":"bold"}},"资产包预约统计 (TOP 20)",-1)])),default:t(()=>[e(E,{data:l.packages,stripe:"",size:"small","max-height":"200"},{default:t(()=>[e(n,{prop:"package_name",label:"资产包","min-width":"150","show-overflow-tooltip":""}),e(n,{prop:"count",label:"总预约",align:"center",width:"70"}),e(n,{prop:"pending_count",label:"待处理",align:"center",width:"70"},{default:t(({row:a})=>[e(h,{type:"info",size:"small"},{default:t(()=>[g(_(a.pending_count||0),1)]),_:2},1024)]),_:1}),e(n,{prop:"win_count",label:"已中签",align:"center",width:"70"},{default:t(({row:a})=>[e(h,{type:"success",size:"small"},{default:t(()=>[g(_(a.win_count||0),1)]),_:2},1024)]),_:1}),e(n,{prop:"total_amount",label:"冻结总额",align:"center",width:"90"},{default:t(({row:a})=>[f("span",null,"¥"+_(a.total_amount||0),1)]),_:1}),e(n,{prop:"win_rate",label:"中签率",align:"center",width:"70"},{default:t(({row:a})=>[f("span",{style:I({color:a.win_rate>50?"#67c23a":a.win_rate>20?"#e6a23c":"#f56c6c"})},_(a.win_rate||0)+"% ",5)]),_:1})]),_:1},8,["data"])]),_:1})):v("",!0),e(K,{buttons:["refresh","comSearch","quickSearch","columnDisplay"],"quick-search-placeholder":y(N)("Quick search placeholder",{fields:"用户名/手机号"})},null,8,["quick-search-placeholder"]),e(L),e(P)])}}}),te=R(F,[["__scopeId","data-v-97fa102e"]]);export{te as default};
