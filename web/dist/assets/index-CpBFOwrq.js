import{B as j,a as C,o as Q,b as q,I as m,Z as R,C as O,D as v,O as w,U as y,H as e,u as z,P as a,G as x,X as c,_ as X,$ as u,aI as J,a1 as W,at as Y}from"./vue-BMJJ5Kg4.js";import{b as ee,d as te}from"./baTable-57jWdOQZ.js";import{_ as ae}from"./popupForm.vue_vue_type_script_setup_true_lang-uLxbSiaO.js";import{T as le,a as se}from"./index-DONpsK3B.js";import{v as ne,a5 as S,c as ie,_ as oe}from"./index-DRv2sWQF.js";import"./index-Dy1MJO1N.js";import"./index-CqVz8jMs.js";const re={class:"default-main ba-table-box"},de={style:{color:"#67c23a","font-weight":"bold"}},ce={style:{color:"#67c23a","font-weight":"bold"}},_e={style:{"font-size":"12px","word-break":"break-all"}},ue={class:"el-statistic"},pe={class:"el-statistic__content",style:{"font-size":"14px"}},me=j({name:"collection/item",__name:"index",setup(fe){const{t:f}=ne.useI18n(),_=C({total_items:0,total_stock:0,total_sales:0,total_value:0,today_new:0,today_sales:0,active_items:0,inactive_items:0,package_zones:[],packages:[]}),A=async()=>{var n;try{const s=await ie({url:"/admin/collection.Item/globalStats",method:"get"});if(s.code===1&&((n=s.data)!=null&&n.stats)){const p=s.data.stats;_.total_items=p.total_items||0,_.total_stock=p.total_stock||0,_.total_sales=p.total_sales||0,_.total_value=p.total_value||0,_.today_new=p.today_new||0,_.today_sales=p.today_sales||0,_.active_items=p.active_items||0,_.inactive_items=p.inactive_items||0,_.package_zones=p.package_zones||[],_.packages=p.packages||[]}}catch(s){console.error("获取全局统计数据失败:",s)}};Q(()=>{A()});const T=q({}),B=q({}),M=new S("/admin/collection.Session/"),Z=new S("/admin/PriceZoneConfig/");(async()=>{var s;const n=await M.index({select:1,limit:999});if(n.code===1&&((s=n.data)!=null&&s.list)){const p=n.data.list;T.value={},p.forEach(i=>{T.value[i.id]=i})}})(),(async()=>{var s;const n=await Z.index({select:1,limit:999});if(n.code===1&&((s=n.data)!=null&&s.list)){const p=n.data.list;B.value={},p.forEach(i=>{B.value[i.id]=i})}})();const b=new ee(new S("/admin/collection.Item/"),{column:[{type:"selection",align:"center",operator:!1},{label:f("Id"),prop:"id",align:"center",operator:"=",operatorPlaceholder:f("Id"),width:70},{label:"专场",prop:"session_id",align:"center",operator:"=",operatorPlaceholder:"专场ID",width:150,render:n=>{const s=T.value[n.session_id];return s?s.title+"（ID："+n.session_id+"）":"ID："+n.session_id}},{label:"藏品标题",prop:"title",align:"center",operator:"LIKE",operatorPlaceholder:f("Fuzzy query")},{label:"价格分区",prop:"zone_id",align:"center",operator:"=",operatorPlaceholder:"分区ID",width:140,render:n=>{const s=B.value[n.zone_id];return s?s.name+"（ID："+n.zone_id+"）":"ID："+n.zone_id}},{label:"藏品图片",prop:"image",align:"center",render:"image",operator:!1,width:120},{label:"价格",prop:"price",align:"center",operator:"BETWEEN",width:120,render:n=>{const s=Number(n.price);return isNaN(s)?n.price:s.toFixed(2)+"元"}},{label:"资产锚定",prop:"asset_anchor",align:"center",operator:"LIKE",minWidth:150},{label:"存证指纹",prop:"fingerprint",align:"center",operator:"LIKE",minWidth:220,render:n=>{const s=n.fingerprint||"";return s.length>24?s.slice(0,24)+"…":s}},{label:"库存数量",prop:"stock",align:"center",operator:"BETWEEN",width:110},{label:"销量",prop:"sales",align:"center",operator:"BETWEEN",width:90},{label:"状态",prop:"status",align:"center",render:"switch",options:[{label:f("Enable"),value:1},{label:f("Disable"),value:0}],operator:"select",operatorOptions:[{label:f("Enable"),value:1},{label:f("Disable"),value:0}],width:90},{label:"排序",prop:"sort",align:"center",operator:"BETWEEN",width:90},{label:f("Create time"),prop:"create_time",align:"center",render:"datetime",sortable:"custom",operator:"RANGE",width:160},{label:f("Operate"),prop:"operate",align:"center",width:140,render:"buttons",buttons:[],operator:!1}]},{defaultItems:{status:1,sort:0,stock:1,sales:0,price:0,session_id:0,zone_id:0}}),l=C({visible:!1,loading:!1,activeTab:"basic",data:null}),G=async n=>{l.visible=!0,l.loading=!0,l.activeTab="basic",l.data=null;try{const s=await b.api.postData("statistics",{id:n.id});s.code===1?l.data=s.data:W.error(s.msg||"获取统计信息失败")}catch(s){W.error(s.message||"获取统计信息失败")}finally{l.loading=!1}},N=te(["edit","delete"]);return N.unshift({render:"tipButton",name:"statistics",title:"查看统计",text:"统计",type:"primary",icon:"fa fa-bar-chart",class:"table-row-statistics",click:n=>{G(n)},display:()=>!0}),N.forEach(n=>{n.name!=="statistics"&&(n.display=()=>!0)}),b.table.column[b.table.column.length-1].buttons=N,b.table.column[b.table.column.length-1].width=200,b.mount(),b.getData(),Y("baTable",b),(n,s)=>{var V,P;const p=m("el-alert"),i=m("el-statistic"),h=m("el-card"),d=m("el-col"),E=m("el-row"),o=m("el-table-column"),D=m("el-table"),g=m("el-descriptions-item"),K=m("el-descriptions"),k=m("el-tab-pane"),I=m("el-tag"),L=m("el-icon"),U=m("el-tooltip"),$=m("el-tabs"),F=m("el-dialog"),H=R("loading");return v(),O("div",re,[z(b).table.remark?(v(),w(p,{key:0,class:"ba-table-alert",title:z(b).table.remark,type:"info","show-icon":""},null,8,["title"])):y("",!0),e(E,{gutter:16,style:{"margin-bottom":"15px"}},{default:a(()=>[e(d,{span:4},{default:a(()=>[e(h,{shadow:"hover",class:"stat-card"},{default:a(()=>[e(i,{title:"藏品总数",value:_.total_items},null,8,["value"])]),_:1})]),_:1}),e(d,{span:4},{default:a(()=>[e(h,{shadow:"hover",class:"stat-card stat-success"},{default:a(()=>[e(i,{title:"上架中",value:_.active_items},null,8,["value"])]),_:1})]),_:1}),e(d,{span:4},{default:a(()=>[e(h,{shadow:"hover",class:"stat-card"},{default:a(()=>[e(i,{title:"总库存",value:_.total_stock},null,8,["value"])]),_:1})]),_:1}),e(d,{span:4},{default:a(()=>[e(h,{shadow:"hover",class:"stat-card stat-warning"},{default:a(()=>[e(i,{title:"总销量",value:_.total_sales},null,8,["value"])]),_:1})]),_:1}),e(d,{span:4},{default:a(()=>[e(h,{shadow:"hover",class:"stat-card"},{default:a(()=>[e(i,{title:"今日新增",value:_.today_new},null,8,["value"])]),_:1})]),_:1}),e(d,{span:4},{default:a(()=>[e(h,{shadow:"hover",class:"stat-card stat-success"},{default:a(()=>[e(i,{title:"今日销量",value:_.today_sales},null,8,["value"])]),_:1})]),_:1})]),_:1}),((V=_.package_zones)==null?void 0:V.length)>0?(v(),w(h,{key:1,shadow:"never",style:{"margin-bottom":"15px"}},{header:a(()=>s[2]||(s[2]=[x("span",{style:{"font-weight":"bold"}},"资产包分区统计 (TOP 30)",-1)])),default:a(()=>[e(D,{data:_.package_zones,stripe:"",size:"small","max-height":"300"},{default:a(()=>[e(o,{prop:"name",label:"资产包+分区","min-width":"200","show-overflow-tooltip":""}),e(o,{prop:"count",label:"数量",align:"center",width:"80"}),e(o,{prop:"stock",label:"库存",align:"center",width:"80"}),e(o,{prop:"sales",label:"销量",align:"center",width:"80"},{default:a(({row:t})=>[x("span",de,c(t.sales||0),1)]),_:1})]),_:1},8,["data"])]),_:1})):y("",!0),((P=_.packages)==null?void 0:P.length)>0?(v(),w(h,{key:2,shadow:"never",style:{"margin-bottom":"15px"}},{header:a(()=>s[3]||(s[3]=[x("span",{style:{"font-weight":"bold"}},"资产包统计 (TOP 20)",-1)])),default:a(()=>[e(D,{data:_.packages,stripe:"",size:"small","max-height":"200"},{default:a(()=>[e(o,{prop:"package_name",label:"资产包","min-width":"150","show-overflow-tooltip":""}),e(o,{prop:"count",label:"数量",align:"center",width:"80"}),e(o,{prop:"stock",label:"库存",align:"center",width:"80"}),e(o,{prop:"sales",label:"销量",align:"center",width:"80"},{default:a(({row:t})=>[x("span",ce,c(t.sales||0),1)]),_:1})]),_:1},8,["data"])]),_:1})):y("",!0),e(le,{buttons:["refresh","add","edit","delete","comSearch","quickSearch","columnDisplay"],"quick-search-placeholder":z(f)("Quick search placeholder",{fields:z(f)("collection.item.Title")+"/"+z(f)("Id")})},null,8,["quick-search-placeholder"]),e(se),e(ae),e(F,{modelValue:l.visible,"onUpdate:modelValue":s[1]||(s[1]=t=>l.visible=t),title:"藏品统计信息",width:"90%",top:"5vh"},{default:a(()=>[X((v(),O("div",null,[e($,{modelValue:l.activeTab,"onUpdate:modelValue":s[0]||(s[0]=t=>l.activeTab=t)},{default:a(()=>[e(k,{label:"基本信息",name:"basic"},{default:a(()=>[l.data?(v(),w(K,{key:0,column:2,border:""},{default:a(()=>[e(g,{label:"藏品ID"},{default:a(()=>{var t;return[u(c((t=l.data.basic_info)==null?void 0:t.id),1)]}),_:1}),e(g,{label:"藏品标题"},{default:a(()=>{var t;return[u(c((t=l.data.basic_info)==null?void 0:t.title),1)]}),_:1}),e(g,{label:"当前价格"},{default:a(()=>{var t;return[u("¥"+c((t=l.data.basic_info)==null?void 0:t.price),1)]}),_:1}),e(g,{label:"发行价格"},{default:a(()=>{var t;return[u("¥"+c((t=l.data.basic_info)==null?void 0:t.issue_price),1)]}),_:1}),e(g,{label:"库存"},{default:a(()=>{var t;return[u(c((t=l.data.basic_info)==null?void 0:t.stock),1)]}),_:1}),e(g,{label:"销量"},{default:a(()=>{var t;return[u(c((t=l.data.basic_info)==null?void 0:t.sales),1)]}),_:1}),e(g,{label:"状态"},{default:a(()=>{var t;return[u(c((t=l.data.basic_info)==null?void 0:t.status_text),1)]}),_:1}),e(g,{label:"创建时间"},{default:a(()=>{var t;return[u(c((t=l.data.basic_info)==null?void 0:t.create_time),1)]}),_:1}),e(g,{label:"确权编号",span:2},{default:a(()=>{var t;return[u(c(((t=l.data.basic_info)==null?void 0:t.asset_code)||"未生成"),1)]}),_:1}),e(g,{label:"存证指纹",span:2},{default:a(()=>{var t;return[x("span",_e,c(((t=l.data.basic_info)==null?void 0:t.fingerprint)||"未生成"),1)]}),_:1})]),_:1})):y("",!0)]),_:1}),e(k,{label:"交易统计",name:"trade"},{default:a(()=>[l.data?(v(),w(E,{key:0,gutter:20},{default:a(()=>[e(d,{span:6},{default:a(()=>{var t;return[e(i,{title:"交易次数",value:((t=l.data.trade_statistics)==null?void 0:t.total_trades)||0},null,8,["value"])]}),_:1}),e(d,{span:6},{default:a(()=>{var t;return[e(i,{title:"不同买家数",value:((t=l.data.trade_statistics)==null?void 0:t.unique_buyers)||0},null,8,["value"])]}),_:1}),e(d,{span:6},{default:a(()=>{var t;return[e(i,{title:"交易总额",value:((t=l.data.trade_statistics)==null?void 0:t.total_amount)||0,precision:2,prefix:"¥"},null,8,["value"])]}),_:1}),e(d,{span:6},{default:a(()=>{var t;return[x("div",ue,[s[4]||(s[4]=x("div",{class:"el-statistic__head"},"首次交易",-1)),x("div",pe,c(((t=l.data.trade_statistics)==null?void 0:t.first_trade_time)||"-"),1)])]}),_:1})]),_:1})):y("",!0)]),_:1}),e(k,{label:"交易用户明细",name:"trade_users"},{default:a(()=>{var t;return[e(D,{data:((t=l.data)==null?void 0:t.trade_users)||[],stripe:"",border:"","max-height":"500"},{default:a(()=>[e(o,{prop:"user_id",label:"用户ID",width:"80",align:"center"}),e(o,{prop:"username",label:"用户名",width:"120",align:"center"}),e(o,{prop:"nickname",label:"昵称",width:"120",align:"center"}),e(o,{prop:"price",label:"购买价格",width:"100",align:"center"},{default:a(({row:r})=>[u("¥"+c(r.price),1)]),_:1}),e(o,{prop:"buy_time_text",label:"购买时间",width:"160",align:"center"}),e(o,{prop:"delivery_status_text",label:"交付状态",width:"100",align:"center"},{default:a(({row:r})=>[e(I,{type:r.delivery_status===0?"success":"warning",size:"small"},{default:a(()=>[u(c(r.delivery_status_text),1)]),_:2},1032,["type"])]),_:1}),e(o,{prop:"consignment_status_text",label:"寄售状态",width:"100",align:"center"},{default:a(({row:r})=>[e(I,{type:r.consignment_status===0?"info":r.consignment_status===1?"warning":"success",size:"small"},{default:a(()=>[u(c(r.consignment_status_text),1)]),_:2},1032,["type"])]),_:1}),e(o,{prop:"is_old_asset_package_text",label:"旧资产包",width:"100",align:"center"},{default:a(({row:r})=>[e(I,{type:r.is_old_asset_package===1?"danger":"",size:"small"},{default:a(()=>[u(c(r.is_old_asset_package_text),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]}),_:1}),e(k,{label:"寄售统计",name:"consignment"},{default:a(()=>[l.data?(v(),w(E,{key:0,gutter:20,style:{"margin-bottom":"20px"}},{default:a(()=>[e(d,{span:4},{default:a(()=>{var t;return[e(i,{title:"寄售总次数",value:((t=l.data.consignment_statistics)==null?void 0:t.total_consignments)||0},null,8,["value"])]}),_:1}),e(d,{span:4},{default:a(()=>{var t;return[e(i,{title:"寄售中",value:((t=l.data.consignment_statistics)==null?void 0:t.consigning)||0},null,8,["value"])]}),_:1}),e(d,{span:4},{default:a(()=>{var t;return[e(i,{title:"已售出",value:((t=l.data.consignment_statistics)==null?void 0:t.sold)||0},null,8,["value"])]}),_:1}),e(d,{span:4},{default:a(()=>{var t;return[e(i,{title:"已下架",value:((t=l.data.consignment_statistics)==null?void 0:t.offshelf)||0},null,8,["value"])]}),_:1}),e(d,{span:4},{default:a(()=>{var t;return[e(i,{title:"已取消",value:((t=l.data.consignment_statistics)==null?void 0:t.cancelled)||0},null,8,["value"])]}),_:1}),e(d,{span:4},{default:a(()=>{var t;return[e(i,{title:"失败次数",value:((t=l.data.consignment_statistics)==null?void 0:t.failed)||0},{suffix:a(()=>[e(U,{content:"失败次数 = 已下架 + 已取消"},{default:a(()=>[e(L,null,{default:a(()=>[e(z(J))]),_:1})]),_:1})]),_:1},8,["value"])]}),_:1})]),_:1})):y("",!0),l.data?(v(),w(E,{key:1,gutter:20},{default:a(()=>[e(d,{span:8},{default:a(()=>{var t;return[e(i,{title:"平均寄售价格",value:((t=l.data.consignment_statistics)==null?void 0:t.avg_consignment_price)||0,precision:2,prefix:"¥"},null,8,["value"])]}),_:1}),e(d,{span:8},{default:a(()=>{var t;return[e(i,{title:"最低寄售价格",value:((t=l.data.consignment_statistics)==null?void 0:t.min_consignment_price)||0,precision:2,prefix:"¥"},null,8,["value"])]}),_:1}),e(d,{span:8},{default:a(()=>{var t;return[e(i,{title:"最高寄售价格",value:((t=l.data.consignment_statistics)==null?void 0:t.max_consignment_price)||0,precision:2,prefix:"¥"},null,8,["value"])]}),_:1})]),_:1})):y("",!0)]),_:1}),e(k,{label:"寄售明细",name:"consignment_list"},{default:a(()=>{var t;return[e(D,{data:((t=l.data)==null?void 0:t.consignment_list)||[],stripe:"",border:"","max-height":"500"},{default:a(()=>[e(o,{prop:"consignment_id",label:"寄售ID",width:"80",align:"center"}),e(o,{prop:"user_id",label:"用户ID",width:"80",align:"center"}),e(o,{prop:"username",label:"用户名",width:"120",align:"center"}),e(o,{prop:"consignment_price",label:"寄售价格",width:"100",align:"center"},{default:a(({row:r})=>[u("¥"+c(r.consignment_price),1)]),_:1}),e(o,{prop:"service_fee",label:"服务费",width:"100",align:"center"},{default:a(({row:r})=>[u("¥"+c(r.service_fee),1)]),_:1}),e(o,{prop:"total_cost",label:"总成本",width:"100",align:"center"},{default:a(({row:r})=>[u("¥"+c(r.total_cost),1)]),_:1}),e(o,{prop:"status_text",label:"状态",width:"100",align:"center"},{default:a(({row:r})=>[e(I,{type:r.status===2?"success":r.status===1?"warning":r.status===3?"info":"danger",size:"small"},{default:a(()=>[u(c(r.status_text),1)]),_:2},1032,["type"])]),_:1}),e(o,{prop:"is_old_asset_package_text",label:"旧资产包",width:"100",align:"center"},{default:a(({row:r})=>[e(I,{type:r.is_old_asset_package===1?"danger":"",size:"small"},{default:a(()=>[u(c(r.is_old_asset_package_text),1)]),_:2},1032,["type"])]),_:1}),e(o,{prop:"create_time_text",label:"创建时间",width:"160",align:"center"})]),_:1},8,["data"])]}),_:1}),e(k,{label:"盲盒预约",name:"blind_box"},{default:a(()=>[l.data?(v(),w(E,{key:0,gutter:20},{default:a(()=>[e(d,{span:6},{default:a(()=>{var t;return[e(i,{title:"预约总数",value:((t=l.data.blind_box_statistics)==null?void 0:t.total_reservations)||0},null,8,["value"])]}),_:1}),e(d,{span:6},{default:a(()=>{var t;return[e(i,{title:"中签数",value:((t=l.data.blind_box_statistics)==null?void 0:t.won)||0},null,8,["value"])]}),_:1}),e(d,{span:6},{default:a(()=>{var t;return[e(i,{title:"未中签",value:((t=l.data.blind_box_statistics)==null?void 0:t.not_won)||0},null,8,["value"])]}),_:1}),e(d,{span:6},{default:a(()=>{var t;return[e(i,{title:"待处理",value:((t=l.data.blind_box_statistics)==null?void 0:t.pending)||0},null,8,["value"])]}),_:1})]),_:1})):y("",!0)]),_:1})]),_:1},8,["modelValue"])])),[[H,l.loading]])]),_:1},8,["modelValue"])])}}}),Ee=oe(me,[["__scopeId","data-v-2f640428"]]);export{Ee as default};
