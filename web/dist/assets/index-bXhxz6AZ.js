import{B as $,b as w,I as g,Z as V,C as W,D as d,O as u,U as A,H as r,u as C,P as p,G as m,_ as h,a9 as K,a1 as a,ai as y,at as M}from"./vue-BMJJ5Kg4.js";import{b as N,d as O}from"./baTable-C5P52-5P.js";import P from"./popupForm-_9a4NLG2.js";import{T as F,a as L}from"./index-CY3WncDq.js";import{x as R,a5 as j,as as b,c as _,_ as q}from"./index-BHof7fb5.js";import"./validate-Dn7fuoi2.js";import"./index-1f7Hqibh.js";const z={class:"default-main ba-table-box"},G={class:"single-code-input"},H=$({name:"user/inviteCodeWhitelist",__name:"index",setup(U){R();const k=w(),f=w(""),x=w(!1),v=()=>{const e=f.value.trim();if(!e){a.warning("请输入邀请码");return}if(!/^[a-zA-Z0-9]+$/.test(e)){a.warning("邀请码格式不正确，仅允许字母和数字");return}x.value=!0,_({url:"/admin/user.InviteCodeWhitelist/add",method:"post",data:{code:e,status:1,remark:"手动添加"}}).then(t=>{t.code===1?(a.success("添加成功"),f.value="",i.getData()):a.error(t.msg||"添加失败")}).catch(t=>{var n,l;a.error(((l=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:l.msg)||"添加失败")}).finally(()=>{x.value=!1})},I=e=>{var s;if(!e||!e.raw)return;const t=["txt","xlsx","xls","csv"],n=(s=e.name.split(".").pop())==null?void 0:s.toLowerCase();if(!n||!t.includes(n)){a.error("不支持的文件格式，仅支持："+t.join(", "));return}if(e.size>10*1024*1024){a.error("文件大小不能超过 10MB");return}const l=new FormData;l.append("file",e.raw),a.info("正在导入，请稍候..."),_({url:"/admin/user.InviteCodeWhitelist/import",method:"post",data:l}).then(o=>{D(o)}).catch(o=>{T(o)})},D=e=>{if(e.code===1){if(a.success(e.msg||"导入成功"),e.data){const{success_count:t,skip_count:n,error_count:l,errors:s}=e.data;let o=`成功导入 ${t} 条`;if(n>0&&(o+=`，跳过 ${n} 条重复记录`),l>0&&(o+=`，错误 ${l} 条`,s&&s.length>0)){const c=s.slice(0,3).join("；");a.warning("部分错误："+c+(s.length>3?"...":""))}a.info(o)}i.getData()}else a.error(e.msg||"导入失败")},T=e=>{var n,l,s,o,c;let t="导入失败";(l=(n=e==null?void 0:e.response)==null?void 0:n.data)!=null&&l.msg?t+="："+e.response.data.msg:(o=(s=e==null?void 0:e.response)==null?void 0:s.data)!=null&&o.message?t+="："+e.response.data.message:e!=null&&e.message?t+="："+e.message:(c=e==null?void 0:e.response)!=null&&c.statusText?t+="："+e.response.statusText:typeof e=="string"?t+="："+e:t+="：未知错误",a.error(t)},B=()=>{const e=i.getSelectionIds();if(e.length===0){a.warning("请选择要启用的记录");return}y.confirm(`确定要启用选中的 ${e.length} 条记录吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{_({url:"/admin/user.InviteCodeWhitelist/batchStatus",method:"post",data:{ids:e,status:1}}).then(t=>{t.code===1?(a.success("操作成功"),i.getData()):a.error(t.msg||"操作失败")})})},E=()=>{const e=i.getSelectionIds();if(e.length===0){a.warning("请选择要禁用的记录");return}y.confirm(`确定要禁用选中的 ${e.length} 条记录吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{_({url:"/admin/user.InviteCodeWhitelist/batchStatus",method:"post",data:{ids:e,status:0}}).then(t=>{t.code===1?(a.success("操作成功"),i.getData()):a.error(t.msg||"操作失败")})})},i=new N(new j("/admin/user.InviteCodeWhitelist/"),{column:[{type:"selection",align:"center",operator:!1},{label:"ID",prop:"id",align:"center",operator:"=",width:80},{label:"邀请码",prop:"code",align:"center",operator:"LIKE",operatorPlaceholder:"邀请码",width:130},{label:"状态",prop:"status",align:"center",operator:"select",operatorOptions:[{label:"启用",value:"1"},{label:"禁用",value:"0"}],render:"tag",custom:{1:"success",0:"danger"},replaceValue:{1:"启用",0:"禁用"},width:100},{label:"备注",prop:"remark",align:"left",operator:"LIKE",operatorPlaceholder:"备注",showOverflowTooltip:!0},{label:"创建时间",prop:"create_time",align:"center",render:"datetime",sortable:"custom",operator:"RANGE",width:170},{label:"操作",align:"center",width:"100",render:"buttons",buttons:O(["edit","delete"]),operator:!1}]});return i.mount(),i.getData(),M("baTable",i),(e,t)=>{const n=g("el-alert"),l=g("el-input"),s=g("el-button"),o=g("el-upload"),c=V("blur");return d(),W("div",z,[C(i).table.remark?(d(),u(n,{key:0,class:"ba-table-alert",title:C(i).table.remark,type:"info","show-icon":""},null,8,["title"])):A("",!0),r(F,{buttons:["refresh","add","edit","delete","comSearch","quickSearch","columnDisplay"],"quick-search-placeholder":"邀请码 / 备注"},{default:p(()=>[m("div",G,[r(l,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=S=>f.value=S),placeholder:"输入邀请码",style:{width:"140px"},maxlength:"20",onKeyup:K(v,["enter"])},null,8,["modelValue"]),h((d(),u(s,{type:"success",onClick:v,loading:x.value},{default:p(()=>[r(b,{name:"fa fa-plus"}),t[1]||(t[1]=m("span",{class:"table-header-operate-text"},"添加",-1))]),_:1},8,["loading"])),[[c]])]),r(o,{ref_key:"uploadRef",ref:k,"auto-upload":!1,"show-file-list":!1,accept:".txt,.xlsx,.xls,.csv","on-change":I,class:"mlr-12"},{trigger:p(()=>[h((d(),u(s,{class:"table-header-operate",type:"primary"},{default:p(()=>[r(b,{name:"fa fa-upload"}),t[2]||(t[2]=m("span",{class:"table-header-operate-text"},"批量导入",-1))]),_:1})),[[c]])]),_:1},512),h((d(),u(s,{class:"table-header-operate mlr-12",type:"success",onClick:B},{default:p(()=>[r(b,{name:"fa fa-check"}),t[3]||(t[3]=m("span",{class:"table-header-operate-text"},"批量启用",-1))]),_:1})),[[c]]),h((d(),u(s,{class:"table-header-operate",type:"warning",onClick:E},{default:p(()=>[r(b,{name:"fa fa-ban"}),t[4]||(t[4]=m("span",{class:"table-header-operate-text"},"批量禁用",-1))]),_:1})),[[c]])]),_:1}),r(L),r(P)])}}}),ae=q(H,[["__scopeId","data-v-4956e281"]]);export{ae as default};
