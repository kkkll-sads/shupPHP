import{b as P}from"./baTable-Cho2KrQQ.js";import{T as G,a as K}from"./index-Cl6ixW7i.js";import{a5 as z,c as $,_ as O}from"./index-DNBbsmjl.js";import{B as W,b as T,I as p,C as k,D as _,O as y,U as w,H as t,u as M,P as l,$ as s,V as U,X as d,G as B,W as X,a1 as b,at as Y}from"./vue-_nkvHh4F.js";import"./index-BNmCRBQg.js";const J={class:"default-main ba-table-box"},Q={class:"amount-text"},Z={key:2,class:"images-container"},ee=W({name:"finance/rightsDeclarationReview",__name:"index",setup(ae){const a=T({visible:!1,title:"",type:"",loading:!1,form:{id:0,user_info:"",amount:"",voucher_type_text:"",rewards:["balance"],audit_remark:""}}),o=T({visible:!1,data:null}),V={screenshot:"截图",transfer_record:"转账记录",other:"其他凭证"},R={pending:"待审核",approved:"已通过",rejected:"已拒绝",cancelled:"已撤销"},x=r=>{const e=Number(r);return Number.isNaN(e)?"0.00":e.toFixed(2)+" 元"},h=r=>{if(!r)return"-";const e=Number(r);if(Number.isNaN(e)||e<=0)return"-";const n=new Date(e*1e3);return`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")} ${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}`},j=r=>({pending:"warning",approved:"success",rejected:"danger",cancelled:"info"})[r]||"info",D=(r,e)=>{a.value={visible:!0,title:e==="approve"?"审核通过":"审核拒绝",type:e,loading:!1,form:{id:r.id,user_info:`${r.user_nickname} (${r.user_mobile})`,amount:r.amount,voucher_type_text:V[r.voucher_type]||"未知",rewards:e==="approve"?["balance"]:[],audit_remark:""}}},C=async()=>{var r,e;if(a.value.type==="reject"&&!a.value.form.audit_remark.trim()){b.error("请填写拒绝原因");return}if(a.value.type==="approve"&&(!a.value.form.rewards||a.value.form.rewards.length===0)){b.error("请至少选择一种奖励");return}a.value.loading=!0;try{const n=a.value.type==="approve"?"approve":"reject",c={id:a.value.form.id,audit_remark:a.value.form.audit_remark};n==="approve"&&(c.rewards=a.value.form.rewards);const m=await $({url:`/admin/finance.RightsDeclarationReview/${n}`,method:"post",data:c});m.code===1?(b.success(m.msg||"操作成功"),a.value.visible=!1,g.getData()):b.error(m.msg||"操作失败")}catch(n){console.error("审核失败:",n),b.error((n==null?void 0:n.msg)||((e=(r=n==null?void 0:n.response)==null?void 0:r.data)==null?void 0:e.msg)||"操作失败，请稍后重试")}finally{a.value.loading=!1}},A=async r=>{var e,n,c,m;try{const u=await $({url:"/admin/finance.RightsDeclarationReview/detail",method:"get",params:{id:r.id}});if(u.code===1){const v=u.data.row;v.user_nickname=((e=v.user)==null?void 0:e.nickname)||"",v.user_mobile=((n=v.user)==null?void 0:n.mobile)||"",o.value.data=v,o.value.visible=!0}else b.error(u.msg||"获取详情失败")}catch(u){console.error("获取详情失败:",u),b.error((u==null?void 0:u.msg)||((m=(c=u==null?void 0:u.response)==null?void 0:c.data)==null?void 0:m.msg)||"获取详情失败")}},g=new P(new z("/admin/finance.RightsDeclarationReview/"),{column:[{type:"selection",align:"center",operator:!1},{label:"ID",prop:"id",align:"center",operator:"=",width:80},{label:"用户昵称",prop:"user_nickname",align:"center",operator:"LIKE",operatorPlaceholder:"用户昵称",render:"tag"},{label:"手机号",prop:"user_mobile",align:"center",operator:"LIKE",operatorPlaceholder:"手机号",render:"tag"},{label:"申请金额",prop:"amount",align:"center",operator:"=",width:120,formatter:r=>x(r.amount)},{label:"凭证类型",prop:"voucher_type",align:"center",operator:"=",render:"tag",custom:{screenshot:"primary",transfer_record:"success",other:"warning"},replaceValue:V},{label:"状态",prop:"status",align:"center",operator:"=",render:"tag",custom:{pending:"warning",approved:"success",rejected:"danger",cancelled:"info"},replaceValue:R},{label:"申请时间",prop:"create_time",align:"center",render:"datetime",operator:"RANGE",width:170},{label:"审核时间",prop:"review_time",align:"center",render:"datetime",width:170,formatter:r=>r.review_time?h(r.review_time):"-"},{label:"操作",align:"center",width:200,render:"buttons",buttons:(r=>{const e=[];return e.push({name:"detail",text:"详情",type:"primary",icon:"fa fa-info-circle",render:"basicButton",click:()=>A(r)}),r.status==="pending"&&(e.push({name:"approve",text:"通过",type:"success",icon:"fa fa-check",render:"basicButton",click:()=>D(r,"approve")}),e.push({name:"reject",text:"拒绝",type:"danger",icon:"fa fa-times",render:"basicButton",click:()=>D(r,"reject")})),e}),operator:!1}]});return g.mount(),g.getData(),Y("baTable",g),(r,e)=>{const n=p("el-alert"),c=p("el-input"),m=p("el-form-item"),u=p("el-checkbox"),v=p("el-checkbox-group"),E=p("el-form"),S=p("el-button"),N=p("el-dialog"),f=p("el-descriptions-item"),I=p("el-tag"),q=p("el-descriptions"),F=p("el-divider"),H=p("el-image");return _(),k("div",J,[M(g).table.remark?(_(),y(n,{key:0,class:"ba-table-alert",title:M(g).table.remark,type:"info","show-icon":""},null,8,["title"])):w("",!0),t(G,{buttons:["refresh","comSearch","quickSearch","columnDisplay"],"quick-search-placeholder":"快速搜索：手机号/金额"}),t(K),t(N,{modelValue:a.value.visible,"onUpdate:modelValue":e[7]||(e[7]=i=>a.value.visible=i),title:a.value.title,width:"520px","close-on-click-modal":!1},{footer:l(()=>[t(S,{onClick:e[6]||(e[6]=i=>a.value.visible=!1)},{default:l(()=>e[10]||(e[10]=[s("取消")])),_:1}),t(S,{type:"primary",onClick:C,loading:a.value.loading},{default:l(()=>[s(d(a.value.type==="approve"?"通过":"拒绝"),1)]),_:1},8,["loading"])]),default:l(()=>[t(E,{model:a.value.form,"label-width":"120px"},{default:l(()=>[t(m,{label:"用户"},{default:l(()=>[t(c,{modelValue:a.value.form.user_info,"onUpdate:modelValue":e[0]||(e[0]=i=>a.value.form.user_info=i),disabled:""},null,8,["modelValue"])]),_:1}),t(m,{label:"申请金额"},{default:l(()=>[t(c,{modelValue:a.value.form.amount,"onUpdate:modelValue":e[1]||(e[1]=i=>a.value.form.amount=i),disabled:""},{append:l(()=>e[9]||(e[9]=[s("元")])),_:1},8,["modelValue"])]),_:1}),t(m,{label:"凭证类型"},{default:l(()=>[t(c,{modelValue:a.value.form.voucher_type_text,"onUpdate:modelValue":e[2]||(e[2]=i=>a.value.form.voucher_type_text=i),disabled:""},null,8,["modelValue"])]),_:1}),a.value.type==="approve"?(_(),k(U,{key:0},[t(m,{label:"发放奖励"},{default:l(()=>[t(v,{modelValue:a.value.form.rewards,"onUpdate:modelValue":e[3]||(e[3]=i=>a.value.form.rewards=i)},{default:l(()=>[t(u,{label:"balance"},{default:l(()=>[s("待激活确权金 ("+d(a.value.form.amount)+"元)",1)]),_:1}),t(u,{label:"green_power"},{default:l(()=>[s("绿色能量 ("+d(Math.floor(a.value.form.amount*10))+")",1)]),_:1}),t(u,{label:"consignment_coupon"},{default:l(()=>[s("寄售卷 ("+d(Math.floor(a.value.form.amount/10))+")",1)]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"审核备注"},{default:l(()=>[t(c,{modelValue:a.value.form.audit_remark,"onUpdate:modelValue":e[4]||(e[4]=i=>a.value.form.audit_remark=i),type:"textarea",rows:3,placeholder:"可以填写审核备注（选填）"},null,8,["modelValue"])]),_:1})],64)):(_(),y(m,{key:1,label:"审核备注",required:""},{default:l(()=>[t(c,{modelValue:a.value.form.audit_remark,"onUpdate:modelValue":e[5]||(e[5]=i=>a.value.form.audit_remark=i),type:"textarea",rows:4,placeholder:"请输入拒绝原因"},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(N,{modelValue:o.value.visible,"onUpdate:modelValue":e[8]||(e[8]=i=>o.value.visible=i),title:"确权申报详情",width:"800px","close-on-click-modal":!1},{default:l(()=>[o.value.data?(_(),y(q,{key:0,column:2,border:""},{default:l(()=>[t(f,{label:"用户昵称"},{default:l(()=>[s(d(o.value.data.user_nickname),1)]),_:1}),t(f,{label:"手机号"},{default:l(()=>[s(d(o.value.data.user_mobile),1)]),_:1}),t(f,{label:"手机号"},{default:l(()=>[s(d(o.value.data.user_mobile||"-"),1)]),_:1}),t(f,{label:"申请金额"},{default:l(()=>[B("span",Q,d(x(o.value.data.amount)),1)]),_:1}),t(f,{label:"凭证类型"},{default:l(()=>[s(d(o.value.data.voucher_type_text),1)]),_:1}),t(f,{label:"状态"},{default:l(()=>[t(I,{type:j(o.value.data.status)},{default:l(()=>[s(d(o.value.data.status_text),1)]),_:1},8,["type"])]),_:1}),t(f,{label:"申请时间"},{default:l(()=>[s(d(h(o.value.data.create_time)),1)]),_:1}),t(f,{label:"审核时间"},{default:l(()=>[s(d(o.value.data.review_time?h(o.value.data.review_time):"-"),1)]),_:1}),t(f,{label:"审核人"},{default:l(()=>[s(d(o.value.data.review_admin_name||"-"),1)]),_:1}),t(f,{label:"用户备注",span:2},{default:l(()=>[s(d(o.value.data.remark||"-"),1)]),_:1}),t(f,{label:"审核备注",span:2},{default:l(()=>[s(d(o.value.data.review_remark||"-"),1)]),_:1})]),_:1})):w("",!0),o.value.data&&o.value.data.images_array&&o.value.data.images_array.length>0?(_(),y(F,{key:1,"content-position":"left"},{default:l(()=>e[11]||(e[11]=[B("span",{style:{"font-size":"16px","font-weight":"bold"}},"凭证图片",-1)])),_:1})):w("",!0),o.value.data&&o.value.data.images_array&&o.value.data.images_array.length>0?(_(),k("div",Z,[(_(!0),k(U,null,X(o.value.data.images_array,(i,L)=>(_(),y(H,{key:L,src:i,"preview-src-list":o.value.data.images_array,"preview-teleported":!0,class:"proof-image",fit:"cover"},null,8,["src","preview-src-list"]))),128))])):w("",!0)]),_:1},8,["modelValue"])])}}}),ie=O(ee,[["__scopeId","data-v-0f878506"]]);export{ie as default};
