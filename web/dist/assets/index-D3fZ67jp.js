import{B as ae,a as R,o as le,a1 as I,l as A,I as i,C as K,D as u,O as m,U as b,H as t,u as y,P as a,$ as s,X as d,G as v,F as oe,aR as re,V as ne,aS as se,aT as de,at as ie}from"./vue-BMJJ5Kg4.js";import{b as pe}from"./baTable-C5P52-5P.js";import{T as ue,a as _e}from"./index-CY3WncDq.js";import{a5 as me,ab as T,c as P,f as j}from"./index-BHof7fb5.js";import"./index-1f7Hqibh.js";const ce={class:"default-main ba-table-box"},fe={style:{color:"#409eff","font-weight":"bold"}},be={style:{color:"#409eff"}},ye={style:{color:"#67c23a","font-weight":"bold"}},ve={style:{color:"#67c23a","font-weight":"bold"}},ge={style:{color:"#67c23a"}},he={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},Ie=ae({name:"finance/rechargeOrder",__name:"index",setup(ke){const p=R({total:0,total_approved_amount:0,today_new:0,today_approved:0,today_approved_amount:0,status:{},banks:[],bank_options:[]}),z=async()=>{var n;try{const e=await P({url:"/admin/finance.RechargeOrder/stats",method:"get"});if(e.code===1&&((n=e.data)!=null&&n.stats)){const c=e.data.stats;p.total=c.total||0,p.total_approved_amount=c.total_approved_amount||0,p.today_new=c.today_new||0,p.today_approved=c.today_approved||0,p.today_approved_amount=c.today_approved_amount||0,p.status=c.status||{},p.banks=c.banks||[],p.bank_options=c.bank_options||[]}}catch(e){console.error("获取统计数据失败:",e)}};le(()=>{z()});const G=n=>{let e=_.table.filter.search||[];e=e.filter(c=>c.field!=="payment_channel"),e.push({field:"payment_channel",val:n,operator:"LIKE"}),_.table.filter.search=e,_.getData()},_=new pe(new me("/admin/finance.RechargeOrder/"),{column:[{type:"selection",align:"center",operator:!1},{label:"ID",prop:"id",align:"center",operator:"=",operatorPlaceholder:"ID",width:70,display:!1},{label:"订单号",prop:"order_no",align:"center",operator:"LIKE",operatorPlaceholder:"模糊查询"},{label:"用户ID",prop:"user_id",align:"center",operator:"=",operatorPlaceholder:"用户ID",width:100,display:!1},{label:"付款截图",prop:"payment_screenshot",align:"center",operator:!1,width:100,render:"image"},{label:"充值金额",prop:"amount",align:"center",operator:"RANGE",width:120,render:(n=>"¥"+parseFloat(n.amount).toFixed(2))},{label:"支付方式",prop:"payment_type_text",align:"center",operator:"select",operatorOptions:[{label:"银行卡",value:"bank_card"},{label:"支付宝",value:"alipay"},{label:"微信",value:"wechat"},{label:"USDT",value:"usdt"},{label:"线上支付",value:"online"}],width:100},{label:"用户手机号",prop:"user.mobile",align:"center",operator:"LIKE",operatorPlaceholder:"手机号",width:130},{label:"支付通道",prop:"payment_channel",align:"center",operator:"LIKE",operatorPlaceholder:"通道名称",width:150},{label:"用户备注",prop:"user_remark",align:"center",operator:"LIKE",operatorPlaceholder:"备注内容",width:150,showOverflowTooltip:!0},{label:"订单状态",prop:"status_text",align:"center",operator:"select",operatorOptions:[{label:"待审核",value:"0"},{label:"已通过",value:"1"},{label:"已拒绝",value:"2"}],render:"tag",custom:{待审核:"warning",已通过:"success",已拒绝:"danger",待支付:"primary",线上支付已到账:"success"},width:100},{label:"创建时间",prop:"create_time",align:"center",render:"datetime",sortable:"custom",operator:"RANGE",width:160},{label:"操作",align:"center",width:"200",render:"buttons",buttons:(n=>{const e=[];return e.push({render:"tipButton",name:"read",title:"查看详情",text:"",type:"primary",icon:"fa fa-eye",class:"table-row-read",display:()=>T("read"),click:()=>{S(n)}}),n.status==0&&!(n.payment_type==="online"&&n.audit_remark==="线上支付自动到账")&&e.push({render:"tipButton",name:"approve",title:"审核通过",text:"",type:"success",icon:"fa fa-check",class:"table-row-approve",display:()=>T("approve"),click:()=>{U(n,"approve")}}),n.status==0&&n.payment_type!=="online"&&e.push({render:"tipButton",name:"reject",title:"审核拒绝",text:"",type:"warning",icon:"fa fa-times",class:"table-row-reject",display:()=>T("reject"),click:()=>{U(n,"reject")}}),e}),operator:!1}],dblClickNotEditColumn:[void 0]}),o=R({visible:!1,loading:!1,type:"approve",title:"",form:{id:0,order_no:"",user_id:"",amount:"",payment_type_text:"",payment_screenshot:"",user_remark:"",audit_remark:""}}),r=R({visible:!1,data:null}),U=(n,e)=>{o.type=e,o.title=e==="approve"?"审核通过":"审核拒绝",o.form={id:n.id,order_no:n.order_no,user_id:n.user_id,amount:n.amount,payment_type_text:n.payment_type_text||"",payment_screenshot:n.payment_screenshot||"",user_remark:n.user_remark||"",audit_remark:""},o.visible=!0},q=async()=>{if(o.type==="reject"&&!o.form.audit_remark.trim()){I.warning("拒绝原因不能为空");return}o.loading=!0;try{const n=o.type==="approve"?"/admin/finance.RechargeOrder/approve":"/admin/finance.RechargeOrder/reject",e=await P({url:n,method:"post",data:{id:o.form.id,audit_remark:o.form.audit_remark}});e.code==1?(I.success(e.msg),o.visible=!1,_.getData()):I.error(e.msg)}catch(n){I.error(n.message||"操作失败")}finally{o.loading=!1}},S=async n=>{try{const e=await P({url:"/admin/finance.RechargeOrder/read",method:"get",params:{id:n.id}});e.code==1?(r.data=e.data.row,r.visible=!0):I.error(e.msg)}catch(e){I.error(e.message||"获取详情失败")}},H=()=>{r.data&&(r.visible=!1,U(r.data,"approve"))},M=()=>{r.data&&(r.visible=!1,U(r.data,"reject"))},V=A(()=>!r.data||!r.visible?-1:_.table.data.findIndex(n=>n.id===r.data.id)),X=A(()=>V.value<=0),J=A(()=>V.value===-1||V.value>=_.table.data.length-1),L=n=>{if(V.value===-1)return;const e=n==="prev"?V.value-1:V.value+1;e>=0&&e<_.table.data.length&&S(_.table.data[e])};return _.mount(),_.getData(),ie("baTable",_),(n,e)=>{var F;const c=i("el-alert"),D=i("el-statistic"),k=i("el-card"),C=i("el-col"),Q=i("el-row"),W=i("el-link"),g=i("el-table-column"),O=i("el-tag"),Y=i("el-table"),w=i("el-input"),h=i("el-form-item"),N=i("el-image"),Z=i("el-form"),x=i("el-button"),$=i("el-dialog"),f=i("el-descriptions-item"),ee=i("el-descriptions"),B=i("el-icon"),te=i("el-button-group");return u(),K("div",ce,[y(_).table.remark?(u(),m(c,{key:0,class:"ba-table-alert",title:y(_).table.remark,type:"info","show-icon":""},null,8,["title"])):b("",!0),t(Q,{gutter:16,style:{"margin-bottom":"15px"}},{default:a(()=>[t(C,{span:4},{default:a(()=>[t(k,{shadow:"hover",class:"stat-card"},{default:a(()=>[t(D,{title:"订单总数",value:p.total||0},null,8,["value"])]),_:1})]),_:1}),t(C,{span:4},{default:a(()=>[t(k,{shadow:"hover",class:"stat-card"},{default:a(()=>{var l,E;return[t(D,{title:"待审核",value:((E=(l=p.status)==null?void 0:l[0])==null?void 0:E.count)||0,"value-style":"color: #e6a23c"},null,8,["value"])]}),_:1})]),_:1}),t(C,{span:4},{default:a(()=>[t(k,{shadow:"hover",class:"stat-card"},{default:a(()=>[t(D,{title:"已通过金额",value:p.total_approved_amount||0,precision:2,prefix:"¥","value-style":"color: #67c23a"},null,8,["value"])]),_:1})]),_:1}),t(C,{span:4},{default:a(()=>[t(k,{shadow:"hover",class:"stat-card"},{default:a(()=>[t(D,{title:"今日新增",value:p.today_new||0},null,8,["value"])]),_:1})]),_:1}),t(C,{span:4},{default:a(()=>[t(k,{shadow:"hover",class:"stat-card"},{default:a(()=>[t(D,{title:"今日审核",value:p.today_approved||0,"value-style":"color: #67c23a"},null,8,["value"])]),_:1})]),_:1}),t(C,{span:4},{default:a(()=>[t(k,{shadow:"hover",class:"stat-card"},{default:a(()=>[t(D,{title:"今日到账",value:p.today_approved_amount||0,precision:2,prefix:"¥","value-style":"color: #67c23a"},null,8,["value"])]),_:1})]),_:1})]),_:1}),((F=p.banks)==null?void 0:F.length)>0?(u(),m(k,{key:1,shadow:"never",style:{"margin-bottom":"15px"}},{header:a(()=>e[13]||(e[13]=[v("span",{style:{"font-weight":"bold"}},"支付通道统计 (TOP 20)",-1)])),default:a(()=>[t(Y,{data:p.banks,stripe:"",size:"small","max-height":"300"},{default:a(()=>[t(g,{prop:"bank_name",label:"通道名称","min-width":"100","show-overflow-tooltip":""},{default:a(({row:l})=>[t(W,{type:"primary",onClick:E=>G(l.bank_name),underline:!1},{default:a(()=>[s(d(l.bank_name),1)]),_:2},1032,["onClick"])]),_:1}),t(g,{prop:"today_count",label:"今日订单",align:"center",width:"75"},{default:a(({row:l})=>[v("span",fe,d(l.today_count||0),1)]),_:1}),t(g,{prop:"today_amount",label:"今日金额",align:"center",width:"90"},{default:a(({row:l})=>[v("span",be,"¥"+d(l.today_amount||0),1)]),_:1}),t(g,{prop:"today_approved_count",label:"今日到账",align:"center",width:"75"},{default:a(({row:l})=>[v("span",ye,d(l.today_approved_count||0),1)]),_:1}),t(g,{prop:"today_approved_amount",label:"今日到账额",align:"center",width:"90"},{default:a(({row:l})=>[v("span",ve,"¥"+d(l.today_approved_amount||0),1)]),_:1}),t(g,{prop:"pending_count",label:"待审核",align:"center",width:"70"},{default:a(({row:l})=>[t(O,{type:"warning",size:"small"},{default:a(()=>[s(d(l.pending_count||0),1)]),_:2},1024)]),_:1}),t(g,{prop:"approved_count",label:"累计通过",align:"center",width:"75"},{default:a(({row:l})=>[t(O,{type:"success",size:"small"},{default:a(()=>[s(d(l.approved_count||0),1)]),_:2},1024)]),_:1}),t(g,{prop:"total_amount",label:"累计总额",align:"center",width:"100"},{default:a(({row:l})=>[v("span",null,"¥"+d(l.total_amount||0),1)]),_:1}),t(g,{prop:"approved_amount",label:"累计到账",align:"center",width:"90"},{default:a(({row:l})=>[v("span",ge,"¥"+d(l.approved_amount||0),1)]),_:1}),t(g,{prop:"approval_rate",label:"通过率",align:"center",width:"65"},{default:a(({row:l})=>[v("span",{style:oe({color:l.approval_rate>50?"#67c23a":l.approval_rate>20?"#e6a23c":"#f56c6c"})},d(l.approval_rate||0)+"% ",5)]),_:1})]),_:1},8,["data"])]),_:1})):b("",!0),t(ue,{buttons:["refresh","comSearch","quickSearch","columnDisplay"],"quick-search-placeholder":"快速搜索：订单号/ID/手机号"}),t(_e),t($,{modelValue:o.visible,"onUpdate:modelValue":e[8]||(e[8]=l=>o.visible=l),title:o.title,width:"600px","close-on-click-modal":!1},{footer:a(()=>[t(x,{onClick:e[7]||(e[7]=l=>o.visible=!1)},{default:a(()=>e[15]||(e[15]=[s("取消")])),_:1}),t(x,{type:"primary",onClick:q,loading:o.loading},{default:a(()=>[s(d(o.type==="approve"?"通过":"拒绝"),1)]),_:1},8,["loading"])]),default:a(()=>[t(Z,{model:o.form,"label-width":"120px"},{default:a(()=>[t(h,{label:"订单号"},{default:a(()=>[t(w,{modelValue:o.form.order_no,"onUpdate:modelValue":e[0]||(e[0]=l=>o.form.order_no=l),disabled:""},null,8,["modelValue"])]),_:1}),t(h,{label:"用户ID"},{default:a(()=>[t(w,{modelValue:o.form.user_id,"onUpdate:modelValue":e[1]||(e[1]=l=>o.form.user_id=l),disabled:""},null,8,["modelValue"])]),_:1}),t(h,{label:"充值金额"},{default:a(()=>[t(w,{modelValue:o.form.amount,"onUpdate:modelValue":e[2]||(e[2]=l=>o.form.amount=l),disabled:""},{append:a(()=>e[14]||(e[14]=[s("元")])),_:1},8,["modelValue"])]),_:1}),t(h,{label:"支付方式"},{default:a(()=>[t(w,{modelValue:o.form.payment_type_text,"onUpdate:modelValue":e[3]||(e[3]=l=>o.form.payment_type_text=l),disabled:""},null,8,["modelValue"])]),_:1}),o.form.payment_screenshot?(u(),m(h,{key:0,label:"付款截图"},{default:a(()=>[t(N,{src:y(j)(o.form.payment_screenshot),style:{width:"300px",height:"auto"},"preview-src-list":[y(j)(o.form.payment_screenshot)],fit:"contain"},null,8,["src","preview-src-list"])]),_:1})):b("",!0),o.form.user_remark?(u(),m(h,{key:1,label:"用户备注"},{default:a(()=>[t(w,{modelValue:o.form.user_remark,"onUpdate:modelValue":e[4]||(e[4]=l=>o.form.user_remark=l),type:"textarea",rows:3,disabled:""},null,8,["modelValue"])]),_:1})):b("",!0),o.type==="reject"?(u(),m(h,{key:2,label:"审核备注"},{default:a(()=>[t(w,{modelValue:o.form.audit_remark,"onUpdate:modelValue":e[5]||(e[5]=l=>o.form.audit_remark=l),type:"textarea",rows:4,placeholder:"请输入拒绝原因"},null,8,["modelValue"])]),_:1})):(u(),m(h,{key:3,label:"审核备注"},{default:a(()=>[t(w,{modelValue:o.form.audit_remark,"onUpdate:modelValue":e[6]||(e[6]=l=>o.form.audit_remark=l),type:"textarea",rows:4,placeholder:"请输入审核备注（可选）"},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t($,{modelValue:r.visible,"onUpdate:modelValue":e[12]||(e[12]=l=>r.visible=l),title:"充值订单详情",width:"800px","close-on-click-modal":!1},{footer:a(()=>[v("div",he,[v("div",null,[t(te,null,{default:a(()=>[t(x,{disabled:X.value,onClick:e[9]||(e[9]=l=>L("prev")),icon:"ArrowLeft"},{default:a(()=>e[16]||(e[16]=[s("上一条")])),_:1},8,["disabled"]),t(x,{disabled:J.value,onClick:e[10]||(e[10]=l=>L("next"))},{default:a(()=>[e[17]||(e[17]=s(" 下一条")),t(B,{class:"el-icon--right"},{default:a(()=>[t(y(re))]),_:1})]),_:1},8,["disabled"])]),_:1})]),v("div",null,[r.data&&r.data.status==0&&!(r.data.payment_type==="online"&&r.data.audit_remark==="线上支付自动到账")?(u(),K(ne,{key:0},[y(T)("approve")?(u(),m(x,{key:0,type:"success",onClick:H},{default:a(()=>[t(B,null,{default:a(()=>[t(y(se))]),_:1}),e[18]||(e[18]=s(" 审核通过 "))]),_:1})):b("",!0),y(T)("reject")&&r.data.payment_type!=="online"?(u(),m(x,{key:1,type:"warning",onClick:M},{default:a(()=>[t(B,null,{default:a(()=>[t(y(de))]),_:1}),e[19]||(e[19]=s(" 审核拒绝 "))]),_:1})):b("",!0)],64)):b("",!0),t(x,{onClick:e[11]||(e[11]=l=>r.visible=!1)},{default:a(()=>e[20]||(e[20]=[s("关闭")])),_:1})])])]),default:a(()=>[r.data?(u(),m(ee,{key:0,column:2,border:""},{default:a(()=>[t(f,{label:"订单号"},{default:a(()=>[s(d(r.data.order_no),1)]),_:1}),t(f,{label:"订单状态"},{default:a(()=>[t(O,{type:r.data.status_color},{default:a(()=>[s(d(r.data.status_text),1)]),_:1},8,["type"])]),_:1}),t(f,{label:"用户ID"},{default:a(()=>[s(d(r.data.user_id),1)]),_:1}),t(f,{label:"充值金额"},{default:a(()=>[s("¥"+d(r.data.amount),1)]),_:1}),t(f,{label:"支付方式"},{default:a(()=>[s(d(r.data.payment_type_text),1)]),_:1}),t(f,{label:"支付通道"},{default:a(()=>[s(d(r.data.payment_channel||"-"),1)]),_:1}),t(f,{label:"用户手机号"},{default:a(()=>{var l;return[s(d(((l=r.data.user)==null?void 0:l.mobile)||"-"),1)]}),_:1}),t(f,{label:"创建时间"},{default:a(()=>[s(d(r.data.create_time_text),1)]),_:1}),r.data.user_remark?(u(),m(f,{key:0,label:"用户备注"},{default:a(()=>[s(d(r.data.user_remark),1)]),_:1})):b("",!0),r.data.audit_time_text?(u(),m(f,{key:1,label:"审核时间"},{default:a(()=>[s(d(r.data.audit_time_text),1)]),_:1})):b("",!0),r.data.audit_remark?(u(),m(f,{key:2,label:"审核备注"},{default:a(()=>[s(d(r.data.audit_remark),1)]),_:1})):b("",!0),r.data.payment_screenshot?(u(),m(f,{key:3,label:"付款截图",span:2},{default:a(()=>[t(N,{src:y(j)(r.data.payment_screenshot),style:{width:"400px",height:"auto"},"preview-src-list":[y(j)(r.data.payment_screenshot)],fit:"contain"},null,8,["src","preview-src-list"])]),_:1})):b("",!0)]),_:1})):b("",!0)]),_:1},8,["modelValue"])])}}});export{Ie as default};
