import{b as z}from"./baTable-57jWdOQZ.js";import{T as F,a as H}from"./index-DONpsK3B.js";import{a5 as K,as as T,c as V,_ as G}from"./index-DRv2sWQF.js";import{B as R,b as E,l as W,I as u,Z as J,C as p,D as _,O as g,U as b,H as s,u as A,P as t,G as f,_ as C,$ as l,X as i,V as L,W as X,a1 as m,at as Y}from"./vue-BMJJ5Kg4.js";import"./index-CqVz8jMs.js";const Z={class:"default-main ba-table-box"},Q={class:"mlr-12"},ee={class:"mlr-12"},re={key:0,class:"reward-value"},ae={key:0},te={key:1},ne={key:1},se=R({name:"user/activityLog",__name:"index",setup(oe){const y={invite:"邀请记录",draw_count:"抽奖次数变更",balance:"可用金额变更",withdrawable_money:"可提现金额变更",usdt:"USDT变更",static_income:"拓展提现变更",dynamic_income:"服务金额变更",sign_in:"每日签到",sign_in_referral:"直推签到奖励",register_reward:"注册奖励",invite_reward:"邀请好友奖励",lucky_draw:"抽奖行为",lucky_draw_prize:"抽奖奖品发放",finance_purchase:"理财产品购买",finance_settle:"理财产品到期结算",shop_purchase:"商城购物",collection_purchase:"藏品购买",order_cancel:"订单取消退款",user_type_upgrade:"用户状态升级",score:"消费金变更",consignment_coupon:"寄售券变更",consignment_purchase:"寄售购买",consignment_income:"寄售收益",consignment_fee:"寄售服务费",consignment_expire:"寄售流拍失败",consignment_resend:"免费重发寄售",service_fee_recharge:"服务费充值",balance_transfer:"余额划转",green_power:"绿色算力变更",rights_distribute:"权益交割",rights_declaration_submit:"确权申报提交",rights_declaration_approved:"确权申报通过",rights_declaration_rejected:"确权申报拒绝",rights_declaration_cancelled:"确权申报撤销",rights_declaration_reward_balance:"确权申报可用金额奖励",rights_declaration_reward_green_power:"确权申报绿色能量奖励",rights_declaration_reward_consignment_coupon:"确权申报寄售卷奖励",first_trade_reward:"首次交易奖励",questionnaire_reward:"问卷奖励",agent_commission:"代理分红",agent_direct_commission:"直推分红",agent_indirect_commission:"间推分红",agent_team_commission:"团队分红",blind_box_reserve:"盲盒预约",cancel_mining_admin:"后台取消挖矿",collection_mining:"藏品挖矿",consignment_cleared:"寄售清算",consignment_coupon_issued:"寄售券发放",consignment_coupon_sync:"寄售券同步",consignment_coupon_use:"寄售券使用",consignment_offshelf:"寄售下架",consignment_profit_score:"寄售积分收益",daily_dividend:"每日分红",finance_cancel:"理财赎回",finance_compound:"理财复利",finance_gift:"理财赠送",finance_income_daily:"理财每日收益",finance_income_period:"理财周期收益",finance_income_stage:"理财阶段收益",manual_mining:"手动挖矿",manual_mining_admin:"后台手动挖矿",matching_failed:"撮合失败",matching_seller_income:"卖家撮合收入",mining_dividend:"挖矿分红",old_assets_unlock:"老资产解锁",refund:"退款",reserve_used:"预约消耗",score_exchange_green_power:"消费金兑换算力",seller_income:"卖家收入",shop_order:"商城订单",withdraw:"提现"},h=E(!1),o=E(null),v=W(()=>!o.value||!o.value.extra?[]:Object.entries(o.value.extra)),w=e=>{if(e==null||e==="")return"-";const r=Number(e);return Number.isNaN(r)?e:r},B=e=>{if(!e)return"-";const r=Number(e);if(Number.isNaN(r)||r<=0)return"-";const a=new Date(r*1e3);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}:${String(a.getSeconds()).padStart(2,"0")}`},x=e=>{if(e==null||e==="")return"-";if(typeof e=="object")try{return JSON.stringify(e,null,2)}catch{return String(e)}return typeof e=="number"?Number.isInteger(e)?e.toString():e.toFixed(2):e},P=e=>({source:"奖励来源",activity_id:"活动ID",activity_name:"活动名称",reward_money:"可用金额奖励",reward_score:"消费金奖励",reward_withdrawable_money:"可提现金额奖励",reward_green_power:"绿色算力奖励",fund_source:"资金来源",register_reward:"注册奖励金额",invite_reward:"邀请奖励金额",invited_user_id:"被邀请用户ID"})[e]||e,U=e=>{o.value=e,h.value=!0},j=async()=>{var e,r;try{const a=await V({url:"/admin/user.UserActivityLog/clearAll",method:"post"});console.log("清除日志响应:",a),a.code===1?(m.success(a.msg||"清除成功"),d.getData()):m.error(a.msg||"清除失败")}catch(a){console.error("清除日志错误:",a),m.error((a==null?void 0:a.msg)||((r=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:r.msg)||"清除失败，请稍后重试")}},M=async()=>{var e,r;try{const a=await V({url:"/admin/user.User/clearAllExceptLatest",method:"post"});console.log("清除用户响应:",a),a.code===1?(m.success(a.msg||"清除成功"),d.getData()):m.error(a.msg||"清除失败")}catch(a){console.error("清除用户错误:",a),m.error((a==null?void 0:a.msg)||((r=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:r.msg)||"清除失败，请稍后重试")}},d=new z(new K("/admin/user.UserActivityLog/"),{column:[{type:"selection",align:"center",operator:!1},{label:"ID",prop:"id",align:"center",operator:"=",width:80},{label:"用户昵称",prop:"user.nickname",align:"center",operator:"LIKE",operatorPlaceholder:"用户昵称",render:"tag"},{label:"用户名",prop:"user.username",align:"center",operator:"LIKE",operatorPlaceholder:"用户名",render:"tag"},{label:"记录类型",prop:"action_type",align:"center",operator:"=",operatorPlaceholder:"记录类型",render:"tag",custom:{invite:"success",draw_count:"warning",balance:"info",withdrawable_money:"success",usdt:"warning",static_income:"primary",dynamic_income:"success",sign_in:"primary",sign_in_referral:"success",register_reward:"success",invite_reward:"success",lucky_draw:"primary",lucky_draw_prize:"warning",finance_purchase:"danger",finance_settle:"success",shop_purchase:"danger",collection_purchase:"danger",order_cancel:"warning",user_type_upgrade:"success",score:"info",consignment_coupon:"primary",consignment_purchase:"danger",consignment_income:"success",consignment_fee:"warning",consignment_expire:"info",consignment_resend:"success",service_fee_recharge:"primary",balance_transfer:"info",green_power:"success",rights_distribute:"success",rights_declaration_submit:"primary",rights_declaration_approved:"success",rights_declaration_rejected:"danger",rights_declaration_cancelled:"warning",rights_declaration_reward_balance:"success",rights_declaration_reward_green_power:"success",rights_declaration_reward_consignment_coupon:"success"},replaceValue:y},{label:"变动字段",prop:"change_field",align:"center",operator:"=",operatorPlaceholder:"变动字段"},{label:"变动值",prop:"change_value",align:"center",operator:"=",operatorPlaceholder:"变动值",width:110},{label:"原值",prop:"before_value",align:"center",width:110},{label:"现值",prop:"after_value",align:"center",width:110},{label:"备注",prop:"remark",align:"left",operator:"LIKE",operatorPlaceholder:"备注",showOverflowTooltip:!0,formatter:e=>{if(e.action_type==="register_reward"&&e.extra){const r=[];if(e.extra.reward_money>0&&r.push(`可用金额：${e.extra.reward_money}元`),e.extra.reward_score>0&&r.push(`消费金：${e.extra.reward_score}分`),e.extra.reward_withdrawable_money>0&&r.push(`可提现金额：${e.extra.reward_withdrawable_money}元`),e.extra.reward_green_power>0&&r.push(`绿色算力：${e.extra.reward_green_power}`),r.length>0)return`注册奖励（${r.join("，")}）`}if(e.action_type==="rights_distribute"&&e.extra){const r=[];if(e.extra.user_collection_id&&r.push(`藏品ID：${e.extra.user_collection_id}`),e.extra.item_id&&r.push(`商品ID：${e.extra.item_id}`),e.extra.distribution_type==="platform"?r.push("平台收益"):e.extra.distribution_type!=="platform"&&r.push("卖家收益"),r.length>0)return`权益交割（${r.join("，")}）`}return e.remark||"-"}},{label:"创建时间",prop:"create_time",align:"center",render:"datetime",operator:"RANGE",width:170},{label:"操作",align:"center",width:110,render:"buttons",buttons:[{name:"detail",text:"详情",type:"primary",icon:"fa fa-info-circle",render:"basicButton",click:e=>U(e)}],operator:!1}]});return d.mount(),d.getData(),Y("baTable",d),(e,r)=>{const a=u("el-alert"),k=u("el-button"),D=u("el-tooltip"),S=u("el-popconfirm"),c=u("el-descriptions-item"),$=u("el-descriptions"),O=u("el-drawer"),N=J("blur");return _(),p("div",Z,[A(d).table.remark?(_(),g(a,{key:0,class:"ba-table-alert",title:A(d).table.remark,type:"info","show-icon":""},null,8,["title"])):b("",!0),s(F,{buttons:["refresh","comSearch","quickSearch","columnDisplay"],"quick-search-placeholder":"用户 / 备注 / 类型"},{default:t(()=>[s(S,{onConfirm:j,"confirm-button-text":"确定","cancel-button-text":"取消",confirmButtonType:"danger",title:"确定要清除全部日志吗？此操作不可恢复！"},{reference:t(()=>[f("div",Q,[s(D,{content:"清除全部日志",placement:"top"},{default:t(()=>[C((_(),g(k,{class:"table-header-operate",type:"danger"},{default:t(()=>[s(T,{name:"fa fa-trash-o"}),r[1]||(r[1]=f("span",{class:"table-header-operate-text"},"清除全部日志",-1))]),_:1})),[[N]])]),_:1})])]),_:1}),s(S,{onConfirm:M,"confirm-button-text":"确定","cancel-button-text":"取消",confirmButtonType:"danger",title:"确定要清除全部用户（保留最新用户）吗？此操作不可恢复！"},{reference:t(()=>[f("div",ee,[s(D,{content:"清除全部用户（保留最新）",placement:"top"},{default:t(()=>[C((_(),g(k,{class:"table-header-operate",type:"danger"},{default:t(()=>[s(T,{name:"fa fa-users"}),r[2]||(r[2]=f("span",{class:"table-header-operate-text"},"清除全部用户",-1))]),_:1})),[[N]])]),_:1})])]),_:1})]),_:1}),s(H),s(O,{modelValue:h.value,"onUpdate:modelValue":r[0]||(r[0]=n=>h.value=n),title:"日志详情",size:"460px"},{default:t(()=>[o.value?(_(),g($,{key:0,column:1,border:""},{default:t(()=>[s(c,{label:"日志ID"},{default:t(()=>[l(i(o.value.id),1)]),_:1}),s(c,{label:"用户昵称"},{default:t(()=>{var n;return[l(i(((n=o.value.user)==null?void 0:n.nickname)||"-"),1)]}),_:1}),s(c,{label:"用户名"},{default:t(()=>{var n;return[l(i(((n=o.value.user)==null?void 0:n.username)||"-"),1)]}),_:1}),s(c,{label:"关联用户昵称"},{default:t(()=>{var n;return[l(i(((n=o.value.related_user)==null?void 0:n.nickname)||"-"),1)]}),_:1}),s(c,{label:"关联用户用户名"},{default:t(()=>{var n;return[l(i(((n=o.value.related_user)==null?void 0:n.username)||"-"),1)]}),_:1}),s(c,{label:"记录类型"},{default:t(()=>[l(i(y[o.value.action_type]||o.value.action_type),1)]),_:1}),s(c,{label:"变动字段"},{default:t(()=>[l(i(o.value.change_field||"-"),1)]),_:1}),s(c,{label:"变动值"},{default:t(()=>[l(i(w(o.value.change_value)),1)]),_:1}),s(c,{label:"原值"},{default:t(()=>[l(i(w(o.value.before_value)),1)]),_:1}),s(c,{label:"现值"},{default:t(()=>[l(i(w(o.value.after_value)),1)]),_:1}),s(c,{label:"关联用户 ID"},{default:t(()=>[l(i(o.value.related_user_id||"-"),1)]),_:1}),s(c,{label:"备注"},{default:t(()=>[l(i(o.value.remark||"-"),1)]),_:1}),s(c,{label:"创建时间"},{default:t(()=>[l(i(B(o.value.create_time)),1)]),_:1})]),_:1})):b("",!0),v.value.length?(_(),p(L,{key:1},[r[3]||(r[3]=f("h4",{class:"extra-title"},"扩展信息",-1)),s($,{column:1,border:""},{default:t(()=>[(_(!0),p(L,null,X(v.value,(n,q)=>(_(),g(c,{key:q,label:P(n[0])},{default:t(()=>{var I;return[((I=o.value)==null?void 0:I.action_type)==="register_reward"&&n[0].startsWith("reward_")&&typeof n[1]=="number"&&n[1]>0?(_(),p("span",re,[l(i(x(n[1]))+" ",1),n[0]==="reward_money"||n[0]==="reward_withdrawable_money"?(_(),p("span",ae,"元")):n[0]==="reward_score"?(_(),p("span",te,"分")):b("",!0)])):(_(),p("span",ne,i(x(n[1])),1))]}),_:2},1032,["label"]))),128))]),_:1})],64)):b("",!0)]),_:1},8,["modelValue"])])}}}),ue=G(se,[["__scopeId","data-v-f44ab45b"]]);export{ue as default};
