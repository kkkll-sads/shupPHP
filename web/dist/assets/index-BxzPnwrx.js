import{v as B,b as L,_ as M}from"./index-DNBbsmjl.js";import{H as U,F as E}from"./footer-CkaODoBZ.js";import{a as N,p as S}from"./home-e7L03HLI.js";import{B as T,b as $,a as H,o as R,_ as z,Z as j,C as p,H as l,U as g,G as e,X as n,u as i,P as r,a1 as _,I as u,D as d,$ as h,V as G,W as O,O as Q}from"./vue-_nkvHh4F.js";import"./darkSwitch-Cgtir3iY.js";import"./router-D4NHICnd.js";import"./useDark-DEYN0Aux.js";const W={class:"finance-page"},X={key:0,class:"finance-hero"},Y=["src"],Z={class:"hero-overlay"},A={class:"finance-header"},J={class:"product-thumb"},K=["src","alt"],ee={key:1,class:"product-placeholder"},se={class:"product-body"},ae={class:"product-name"},ne={class:"product-summary"},te={class:"product-info"},oe={class:"info-item"},ie={class:"info-label"},ce={class:"info-value"},le={class:"info-item"},re={class:"info-label"},ue={class:"info-value"},de={class:"info-item"},pe={class:"info-label"},_e={class:"info-value"},he={class:"product-progress"},me={class:"progress-header"},fe={key:0,class:"purchase-dialog"},ge={class:"purchase-dialog-header"},ve={class:"price"},ye={class:"purchase-summary"},be={class:"purchase-field"},xe={class:"purchase-tips"},ke={key:0},we={class:"purchase-amount"},Ce=T({__name:"index",setup(Pe){const{t:a}=B.useI18n(),y=L(),f=$(),s=H({loading:!1,banner:null,products:[],purchase:{visible:!1,product:null,quantity:1,loading:!1}}),v=async()=>{s.loading=!0;try{const{data:t}=await N();t.code===1?(s.products=(t.data.list||[]).map(c=>({...c,summary:c.summary||a("finance.Default summary")})),s.banner=t.data.banner||null):_.error(t.msg||a("Load failed"))}catch(t){_.error((t==null?void 0:t.message)||a("Load failed"))}finally{s.loading=!1}},b=()=>{var c;const t=((c=f.value)==null?void 0:c.$el)||f.value;t!=null&&t.scrollIntoView&&t.scrollIntoView({behavior:"smooth"})},x=t=>{if(!y.isLogin()){_.warning(a("finance.Login required"));return}s.purchase.product=t,s.purchase.visible=!0,s.purchase.quantity=t.min_purchase||1},k=async()=>{if(s.purchase.product){s.purchase.loading=!0;try{const{data:t}=await S({product_id:s.purchase.product.id,quantity:s.purchase.quantity});t.code===1?(_.success(a("finance.Purchase success")),s.purchase.visible=!1,await v()):_.error(t.msg||a("finance.Purchase failed"))}catch(t){_.error((t==null?void 0:t.message)||a("finance.Purchase failed"))}finally{s.purchase.loading=!1}}};return R(()=>{v()}),(t,c)=>{const m=u("el-button"),w=u("el-progress"),C=u("el-card"),P=u("el-col"),V=u("el-row"),F=u("el-main"),q=u("el-input-number"),I=u("el-dialog"),D=j("loading");return z((d(),p("div",W,[l(U),s.banner?(d(),p("div",X,[e("img",{src:s.banner,alt:"finance banner"},null,8,Y),e("div",Z,[e("h1",null,n(i(a)("finance.Title")),1),e("p",null,n(i(a)("finance.Subtitle")),1),l(m,{type:"primary",size:"large",onClick:b},{default:r(()=>[h(n(i(a)("finance.Explore products")),1)]),_:1})])])):g("",!0),l(F,{class:"finance-main"},{default:r(()=>[e("div",A,[e("h2",null,n(i(a)("finance.Product list title")),1),e("p",null,n(i(a)("finance.Product list desc")),1)]),l(V,{ref_key:"productContainerRef",ref:f,class:"product-container",gutter:24},{default:r(()=>[(d(!0),p(G,null,O(s.products,o=>(d(),Q(P,{key:o.id,xs:24,sm:12,lg:8},{default:r(()=>[l(C,{class:"product-card",shadow:"hover"},{default:r(()=>[e("div",J,[o.thumbnail?(d(),p("img",{key:0,src:o.thumbnail,alt:o.name},null,8,K)):(d(),p("div",ee,c[3]||(c[3]=[e("i",{class:"fa fa-line-chart"},null,-1)])))]),e("div",se,[e("h3",ae,n(o.name),1),e("p",ne,n(o.summary),1),e("div",te,[e("div",oe,[e("span",ie,n(i(a)("finance.Price")),1),e("span",ce,"¥"+n(o.price.toFixed(2)),1)]),e("div",le,[e("span",re,n(i(a)("finance.Cycle")),1),e("span",ue,n(o.cycle_days)+" "+n(i(a)("finance.Days")),1)]),e("div",de,[e("span",pe,n(i(a)("finance.Yield")),1),e("span",_e,n(o.yield_rate)+"%",1)])]),e("div",he,[e("div",me,[e("span",null,n(o.total_amount>0?i(a)("finance.Sold out",{sold:o.sold_amount}):i(a)("finance.Sold total",{sold:o.sold_amount})),1),e("span",null,n(o.total_amount>0?i(a)("finance.Remaining",{remaining:o.remaining_amount}):i(a)("finance.Unlimited")),1)]),l(w,{"show-text":!1,"stroke-width":10,percentage:Math.min(100,o.progress)},null,8,["percentage"])]),l(m,{type:"primary",size:"large",disabled:o.total_amount>0&&o.remaining_amount<=0,onClick:Ve=>x(o),class:"purchase-btn"},{default:r(()=>[h(n(i(a)("finance.Buy now")),1)]),_:2},1032,["disabled","onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1},512)]),_:1}),l(E),l(I,{modelValue:s.purchase.visible,"onUpdate:modelValue":c[2]||(c[2]=o=>s.purchase.visible=o),title:i(a)("finance.Purchase dialog title"),width:"420px","close-on-click-modal":!1},{footer:r(()=>[l(m,{onClick:c[1]||(c[1]=o=>s.purchase.visible=!1)},{default:r(()=>[h(n(i(a)("Cancel")),1)]),_:1}),l(m,{type:"primary",loading:s.purchase.loading,onClick:k},{default:r(()=>[h(n(i(a)("finance.Confirm purchase")),1)]),_:1},8,["loading"])]),default:r(()=>[s.purchase.product?(d(),p("div",fe,[e("div",ge,[e("h3",null,n(s.purchase.product.name),1),e("span",ve,"¥"+n(s.purchase.product.price.toFixed(2)),1)]),e("p",ye,n(s.purchase.product.summary),1),e("div",be,[e("span",null,n(i(a)("finance.Quantity")),1),l(q,{modelValue:s.purchase.quantity,"onUpdate:modelValue":c[0]||(c[0]=o=>s.purchase.quantity=o),min:s.purchase.product.min_purchase||1,max:s.purchase.product.max_purchase>0?s.purchase.product.max_purchase:void 0,step:1,"controls-position":"right"},null,8,["modelValue","min","max"])]),e("div",xe,[e("span",null,n(i(a)("finance.Min purchase tip",{min:s.purchase.product.min_purchase})),1),s.purchase.product.max_purchase>0?(d(),p("span",ke,n(i(a)("finance.Max purchase tip",{max:s.purchase.product.max_purchase})),1)):g("",!0)]),e("div",we,[h(n(i(a)("finance.Total amount"))+"：",1),e("strong",null,"¥"+n((s.purchase.product.price*s.purchase.quantity).toFixed(2)),1)])])):g("",!0)]),_:1},8,["modelValue","title"])])),[[D,s.loading]])}}}),Ue=M(Ce,[["__scopeId","data-v-a50f0fbc"]]);export{Ue as default};
