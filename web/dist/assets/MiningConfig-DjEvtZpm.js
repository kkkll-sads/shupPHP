import{B as E,b as w,a as N,l as S,I as d,Z as T,C as x,D as g,H as t,P as n,_ as G,O as I,G as i,$ as u,X as O,u as P,aK as A,a1 as m}from"./vue-DnSQgQf0.js";import{c as C,_ as F}from"./index-BR6nH71S.js";const H={class:"mining-config"},K={class:"card-header"},L={class:"card-actions"},R={key:0,class:"form-tip",style:{color:"#f56c6c"}},X={key:1,class:"form-tip",style:{color:"#67c23a"}},Z=E({__name:"MiningConfig",setup($){const c=w(!1),v=w(!1),l=N({continuous_fail_count:5,long_term_days:7,price_top_multiple:7,dividend_balance_rate:.5,dividend_score_rate:.5,daily_dividend_amount:0,dividend_price_rate:0}),p=S(()=>{const o=l.dividend_balance_rate||0,e=l.dividend_score_rate||0;return o+e}),y=()=>{c.value=!0,C({url:"/admin/content.DrawCountConfig/collectionMiningConfig",method:"GET"}).then(o=>{l.continuous_fail_count=o.data.continuous_fail_count??5,l.long_term_days=o.data.long_term_days??7,l.price_top_multiple=o.data.price_top_multiple??7,l.dividend_balance_rate=o.data.dividend_balance_rate??.5,l.dividend_score_rate=o.data.dividend_score_rate??.5,l.daily_dividend_amount=o.data.daily_dividend_amount??0,l.dividend_price_rate=o.data.dividend_price_rate??0}).finally(()=>{c.value=!1})},M=()=>{const o=p.value;if(o>1.01||o<.99){m.warning("分红余额分配比例和分红积分分配比例之和必须等于1（100%）");return}if(l.continuous_fail_count<1||l.continuous_fail_count>100){m.warning("连续失败次数必须在1-100之间");return}if(l.long_term_days<1||l.long_term_days>365){m.warning("长期滞销天数必须在1-365之间");return}if(l.price_top_multiple<1||l.price_top_multiple>100){m.warning("价格触顶倍数必须在1-100之间");return}if(l.dividend_price_rate<0||l.dividend_price_rate>1){m.warning("分红价格比例必须在0-1之间（0表示不按价格比例分红，0.01表示1%）");return}v.value=!0,C({url:"/admin/content.DrawCountConfig/collectionMiningConfig",method:"POST",data:l},{showSuccessMessage:!0}).then(()=>{y()}).finally(()=>{v.value=!1})};return y(),(o,e)=>{const V=d("el-button"),k=d("el-alert"),s=d("el-form-item"),b=d("el-divider"),r=d("el-input-number"),_=d("el-col"),f=d("el-row"),D=d("el-tag"),U=d("el-form"),B=d("el-card"),z=T("loading");return g(),x("div",H,[t(B,{class:"config-card",shadow:"hover"},{header:n(()=>[i("div",K,[e[9]||(e[9]=i("span",{class:"card-title"},"兜底熔断（转分红）配置",-1)),i("div",L,[t(V,{size:"small",onClick:y,loading:c.value,icon:P(A)},{default:n(()=>e[7]||(e[7]=[u("刷新")])),_:1},8,["loading","icon"]),t(V,{size:"small",type:"primary",onClick:M,loading:v.value},{default:n(()=>e[8]||(e[8]=[u("保存")])),_:1},8,["loading"])])])]),default:n(()=>[G((g(),I(U,{model:l,"label-width":"180px"},{default:n(()=>[t(s,{label:"配置说明"},{default:n(()=>[t(k,{type:"info",closable:!1,"show-icon":""},{default:n(()=>e[10]||(e[10]=[i("div",null,'当商品满足任一触发条件时，系统会强制回收并转为"矿机"：',-1),i("div",{class:"alert-tip"},"1. 连续失败：连续指定次数寄售都没卖出去（流拍）",-1),i("div",{class:"alert-tip"},"2. 长期滞销：持有超过指定天数还没卖掉（或没操作上架）",-1),i("div",{class:"alert-tip"},"3. 价格触顶：现价超过了发行价的指定倍数",-1),i("div",{class:"alert-tip"},"转为矿机后，每天会自动发放分红：",-1),i("div",{class:"alert-tip"},[u("    • "),i("strong",null,"分红价格比例"),u("：按藏品当前价格的比例分红（如0.01表示1%，价格374元分红3.74元）")],-1),i("div",{class:"alert-tip"},[u("    • "),i("strong",null,"固定分红金额"),u("：当价格比例为0时，使用固定金额分红（如每日10元）")],-1),i("div",{class:"alert-tip"},"    • 分红按配置比例分配到余额和积分",-1)])),_:1})]),_:1}),t(b),t(f,{gutter:20},{default:n(()=>[t(_,{xs:24,sm:12},{default:n(()=>[t(s,{label:"连续失败次数"},{default:n(()=>[t(r,{modelValue:l.continuous_fail_count,"onUpdate:modelValue":e[0]||(e[0]=a=>l.continuous_fail_count=a),min:1,max:100,step:1,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[11]||(e[11]=i("span",{class:"form-tip"},"次（连续寄售失败达到此次数时，触发强制锁仓转为矿机）",-1))]),_:1})]),_:1}),t(_,{xs:24,sm:12},{default:n(()=>[t(s,{label:"长期滞销天数"},{default:n(()=>[t(r,{modelValue:l.long_term_days,"onUpdate:modelValue":e[1]||(e[1]=a=>l.long_term_days=a),min:1,max:365,step:1,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[12]||(e[12]=i("span",{class:"form-tip"},"天（持有超过此天数还没卖掉或没操作上架时，触发强制锁仓转为矿机）",-1))]),_:1})]),_:1})]),_:1}),t(f,{gutter:20},{default:n(()=>[t(_,{xs:24,sm:12},{default:n(()=>[t(s,{label:"价格触顶倍数"},{default:n(()=>[t(r,{modelValue:l.price_top_multiple,"onUpdate:modelValue":e[2]||(e[2]=a=>l.price_top_multiple=a),min:1,max:100,step:.1,precision:1,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[13]||(e[13]=i("span",{class:"form-tip"},"倍（现价超过发行价的此倍数时，触发强制锁仓转为矿机）",-1))]),_:1})]),_:1})]),_:1}),t(f,{gutter:20},{default:n(()=>[t(_,{xs:24,sm:12},{default:n(()=>[t(s,{label:"分红价格比例"},{default:n(()=>[t(r,{modelValue:l.dividend_price_rate,"onUpdate:modelValue":e[3]||(e[3]=a=>l.dividend_price_rate=a),min:0,max:1,step:.001,precision:3,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[14]||(e[14]=i("span",{class:"form-tip"},"按藏品当前价格的比例分红（如0.01表示1%），设置为0则使用固定金额分红",-1))]),_:1})]),_:1}),t(_,{xs:24,sm:12},{default:n(()=>[t(s,{label:"固定分红金额"},{default:n(()=>[t(r,{modelValue:l.daily_dividend_amount,"onUpdate:modelValue":e[4]||(e[4]=a=>l.daily_dividend_amount=a),min:0,step:.01,precision:2,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[15]||(e[15]=i("span",{class:"form-tip"},"元（当价格比例为0时使用的固定分红金额）",-1))]),_:1})]),_:1})]),_:1}),t(b),t(f,{gutter:20},{default:n(()=>[t(_,{xs:24,sm:12},{default:n(()=>[t(s,{label:"分红余额分配比例"},{default:n(()=>[t(r,{modelValue:l.dividend_balance_rate,"onUpdate:modelValue":e[5]||(e[5]=a=>l.dividend_balance_rate=a),min:0,max:1,step:.01,precision:2,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[16]||(e[16]=i("span",{class:"form-tip"},"例如：0.5 表示 50%",-1))]),_:1})]),_:1}),t(_,{xs:24,sm:12},{default:n(()=>[t(s,{label:"分红积分分配比例"},{default:n(()=>[t(r,{modelValue:l.dividend_score_rate,"onUpdate:modelValue":e[6]||(e[6]=a=>l.dividend_score_rate=a),min:0,max:1,step:.01,precision:2,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[17]||(e[17]=i("span",{class:"form-tip"},"例如：0.5 表示 50%",-1))]),_:1})]),_:1})]),_:1}),t(s,{label:"比例总和"},{default:n(()=>[t(D,{type:p.value>1.01||p.value<.99?"danger":"success",size:"large"},{default:n(()=>[u(O((p.value*100).toFixed(2))+"% ",1)]),_:1},8,["type"]),p.value>1.01||p.value<.99?(g(),x("span",R," 警告：两个比例之和必须等于1（100%） ")):(g(),x("span",X,"正确：比例总和为100%"))]),_:1})]),_:1},8,["model"])),[[z,c.value]])]),_:1})])}}}),J=F(Z,[["__scopeId","data-v-d281a4a6"]]);export{J as default};
