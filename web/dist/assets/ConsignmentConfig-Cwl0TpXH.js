import{B as Y,b as p,a as P,l as X,I as f,Z as ee,C as A,D as g,H as n,P as t,_ as T,O as y,U as ne,G as o,$ as u,X as Z,u as z,aK as I,a1 as w}from"./vue-DnSQgQf0.js";import{c as r,_ as te}from"./index-BR6nH71S.js";const oe={class:"consignment-config"},ae={class:"card-header"},le={class:"card-actions"},se={class:"card-header"},ie={class:"card-actions"},re={class:"card-header"},de={class:"card-actions"},ue={class:"card-header"},fe={class:"card-actions"},ce={key:0,class:"form-tip",style:{color:"#f56c6c"}},me={key:1,class:"form-tip",style:{color:"#67c23a"}},pe=Y({__name:"ConsignmentConfig",setup(ge){const b=p(!1),G=p(!1),l=P({min_increase:.04,max_increase:.06,service_fee_rate:.03,expire_days:7}),k=p(!1),M=p(!1),_=P({expire_days:7}),V=p(!1),O=p(!1),C=P({unlock_hours:null}),h=p(!1),B=p(!1),d=P({profit_balance_rate:.5,profit_score_rate:.5}),$=X(()=>{const a=l.min_increase||0,e=l.max_increase||0;return(a+e)/2*100}),v=X(()=>{const a=d.profit_balance_rate||0,e=d.profit_score_rate||0;return a+e}),F=()=>{b.value=!0,Promise.all([r({url:"/admin/content.DrawCountConfig/collectionPriceIncreaseConfig",method:"GET"}),r({url:"/admin/content.DrawCountConfig/consignmentServiceFeeConfig",method:"GET"}),r({url:"/admin/content.DrawCountConfig/consignmentCouponExpireConfig",method:"GET"})]).then(a=>{l.min_increase=a[0].data.min_increase??.04,l.max_increase=a[0].data.max_increase??.06,l.service_fee_rate=a[1].data.service_fee_rate??.03,l.expire_days=a[2].data.expire_days??7}).finally(()=>{b.value=!1})},j=()=>{if(l.min_increase>l.max_increase){w.warning("最小涨幅不能大于最大涨幅");return}G.value=!0,Promise.all([r({url:"/admin/content.DrawCountConfig/collectionPriceIncreaseConfig",method:"POST",data:{min_increase:l.min_increase,max_increase:l.max_increase}},{showSuccessMessage:!1}),r({url:"/admin/content.DrawCountConfig/consignmentServiceFeeConfig",method:"POST",data:{service_fee_rate:l.service_fee_rate}},{showSuccessMessage:!1}),r({url:"/admin/content.DrawCountConfig/consignmentCouponExpireConfig",method:"POST",data:{expire_days:l.expire_days}},{showSuccessMessage:!1})]).then(()=>{w.success("配置更新成功"),F()}).finally(()=>{G.value=!1})},L=()=>{k.value=!0,r({url:"/admin/content.DrawCountConfig/consignmentExpireDaysConfig",method:"GET"}).then(a=>{_.expire_days=a.data.expire_days??7}).finally(()=>{k.value=!1})},q=()=>{if(_.expire_days<1||_.expire_days>365){w.warning("寄售失败天数必须在1-365天之间");return}M.value=!0,r({url:"/admin/content.DrawCountConfig/consignmentExpireDaysConfig",method:"POST",data:{expire_days:_.expire_days}},{showSuccessMessage:!0}).then(()=>{L()}).finally(()=>{M.value=!1})},N=()=>{V.value=!0,r({url:"/admin/content.DrawCountConfig/consignmentUnlockHoursConfig",method:"GET"}).then(a=>{C.unlock_hours=a.data.unlock_hours??null}).finally(()=>{V.value=!1})},J=()=>{const a=C.unlock_hours;if(a==null||a<0||a>8760){w.warning("请填写有效的寄售解锁小时数（0-8760）");return}O.value=!0,r({url:"/admin/content.DrawCountConfig/consignmentUnlockHoursConfig",method:"POST",data:{unlock_hours:a}},{showSuccessMessage:!0}).then(()=>{N()}).finally(()=>{O.value=!1})},H=()=>{h.value=!0,r({url:"/admin/content.DrawCountConfig/consignmentSettlementConfig",method:"GET"}).then(a=>{d.profit_balance_rate=a.data.profit_balance_rate??.5,d.profit_score_rate=a.data.profit_score_rate??.5}).finally(()=>{h.value=!1})},Q=()=>{const a=v.value;if(a>1.01||a<.99){w.warning("利润余额分配比例和利润积分分配比例之和必须等于1（100%）");return}B.value=!0,r({url:"/admin/content.DrawCountConfig/consignmentSettlementConfig",method:"POST",data:{profit_balance_rate:d.profit_balance_rate,profit_score_rate:d.profit_score_rate}},{showSuccessMessage:!0}).then(()=>{H()}).finally(()=>{B.value=!1})};return F(),L(),H(),N(),(a,e)=>{const c=f("el-button"),x=f("el-alert"),s=f("el-form-item"),m=f("el-input-number"),K=f("el-tag"),W=f("el-divider"),S=f("el-form"),D=f("el-card"),E=f("el-col"),R=f("el-row"),U=ee("loading");return g(),A("div",oe,[n(R,{gutter:20},{default:t(()=>[n(E,{xs:24,lg:12},{default:t(()=>[n(D,{class:"config-card",shadow:"hover"},{header:t(()=>[o("div",ae,[e[10]||(e[10]=o("span",{class:"card-title"},"藏品价格上涨配置",-1)),o("div",le,[n(c,{size:"small",onClick:F,loading:b.value,icon:z(I)},{default:t(()=>e[8]||(e[8]=[u("刷新")])),_:1},8,["loading","icon"]),n(c,{size:"small",type:"primary",onClick:j,loading:G.value},{default:t(()=>e[9]||(e[9]=[u("保存")])),_:1},8,["loading"])])])]),default:t(()=>[T((g(),y(S,{model:l,"label-width":"140px"},{default:t(()=>[n(s,{label:"配置说明"},{default:t(()=>[n(x,{type:"info",closable:!1,"show-icon":""},{default:t(()=>e[11]||(e[11]=[o("div",null,"商品每次被买走后，价格会自动上涨（在最小涨幅和最大涨幅之间随机）",-1),o("div",{class:"alert-tip"},"例如：最小涨幅4%，最大涨幅6%，则每次购买后价格会在原价基础上上涨4%-6%之间（随机，平均5.5%）",-1),o("div",{class:"alert-tip"},"示例：1000元买入，下次卖出价在 1040~1060元之间",-1)])),_:1})]),_:1}),n(s,{label:"最小涨幅"},{default:t(()=>[n(m,{modelValue:l.min_increase,"onUpdate:modelValue":e[0]||(e[0]=i=>l.min_increase=i),min:0,max:1,step:.01,precision:2,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[12]||(e[12]=o("span",{class:"form-tip"},"例如：0.04 表示 4%",-1))]),_:1}),n(s,{label:"最大涨幅"},{default:t(()=>[n(m,{modelValue:l.max_increase,"onUpdate:modelValue":e[1]||(e[1]=i=>l.max_increase=i),min:0,max:1,step:.01,precision:2,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[13]||(e[13]=o("span",{class:"form-tip"},"例如：0.06 表示 6%",-1))]),_:1}),n(s,{label:"平均涨幅"},{default:t(()=>[n(K,{type:"info",size:"large"},{default:t(()=>[u(Z($.value.toFixed(2))+"%",1)]),_:1}),e[14]||(e[14]=o("span",{class:"form-tip"},"平均涨幅 = (最小涨幅 + 最大涨幅) / 2",-1))]),_:1}),l.min_increase>l.max_increase?(g(),y(s,{key:0},{default:t(()=>[n(x,{type:"warning",closable:!1,"show-icon":""},{default:t(()=>e[15]||(e[15]=[u("警告：最小涨幅不能大于最大涨幅")])),_:1})]),_:1})):ne("",!0),n(W),n(s,{label:"寄售服务费费率"},{default:t(()=>[n(m,{modelValue:l.service_fee_rate,"onUpdate:modelValue":e[2]||(e[2]=i=>l.service_fee_rate=i),min:0,max:1,step:.01,precision:2,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[16]||(e[16]=o("span",{class:"form-tip"},"例如：0.03 表示 3%",-1))]),_:1}),n(s,{label:"寄售券有效期"},{default:t(()=>[n(m,{modelValue:l.expire_days,"onUpdate:modelValue":e[3]||(e[3]=i=>l.expire_days=i),min:1,max:365,step:1,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[17]||(e[17]=o("span",{class:"form-tip"},"天（用户购买商品后获得的寄售券有效期天数）",-1))]),_:1})]),_:1},8,["model"])),[[U,b.value]])]),_:1})]),_:1}),n(E,{xs:24,lg:12},{default:t(()=>[n(D,{class:"config-card",shadow:"hover"},{header:t(()=>[o("div",se,[e[20]||(e[20]=o("span",{class:"card-title"},"寄售解锁配置",-1)),o("div",ie,[n(c,{size:"small",onClick:N,loading:V.value,icon:z(I)},{default:t(()=>e[18]||(e[18]=[u("刷新")])),_:1},8,["loading","icon"]),n(c,{size:"small",type:"primary",onClick:J,loading:O.value},{default:t(()=>e[19]||(e[19]=[u("保存")])),_:1},8,["loading"])])])]),default:t(()=>[T((g(),y(S,{model:C,"label-width":"140px"},{default:t(()=>[n(s,{label:"配置说明"},{default:t(()=>[n(x,{type:"info",closable:!1,"show-icon":""},{default:t(()=>e[21]||(e[21]=[o("div",null,"购买后需等待指定小时数才能上架寄售。此配置必须在后台显式设置，系统不使用默认硬编码。",-1),o("div",{class:"alert-tip"},"例如：填写48表示购买后48小时可寄售",-1)])),_:1})]),_:1}),n(s,{label:"解锁小时数"},{default:t(()=>[n(m,{modelValue:C.unlock_hours,"onUpdate:modelValue":e[4]||(e[4]=i=>C.unlock_hours=i),min:0,max:8760,step:1,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[22]||(e[22]=o("span",{class:"form-tip"},"单位：小时，必须显式设置（0-8760）",-1))]),_:1})]),_:1},8,["model"])),[[U,V.value]])]),_:1})]),_:1}),n(E,{xs:24,lg:12},{default:t(()=>[n(D,{class:"config-card",shadow:"hover"},{header:t(()=>[o("div",re,[e[25]||(e[25]=o("span",{class:"card-title"},"寄售失败（流拍）配置",-1)),o("div",de,[n(c,{size:"small",onClick:L,loading:k.value,icon:z(I)},{default:t(()=>e[23]||(e[23]=[u("刷新")])),_:1},8,["loading","icon"]),n(c,{size:"small",type:"primary",onClick:q,loading:M.value},{default:t(()=>e[24]||(e[24]=[u("保存")])),_:1},8,["loading"])])])]),default:t(()=>[T((g(),y(S,{model:_,"label-width":"140px"},{default:t(()=>[n(s,{label:"配置说明"},{default:t(()=>[n(x,{type:"info",closable:!1,"show-icon":""},{default:t(()=>e[26]||(e[26]=[o("div",null,"寄售商品超过指定天数未售出时，系统会自动标记为流拍失败",-1),o("div",{class:"alert-tip"},"例如：设置为7天，则寄售超过7天未售出的商品会自动标记为流拍失败",-1),o("div",{class:"alert-tip"},"注意：此配置由定时任务每天执行，建议设置为1-365天之间",-1)])),_:1})]),_:1}),n(s,{label:"流拍天数"},{default:t(()=>[n(m,{modelValue:_.expire_days,"onUpdate:modelValue":e[5]||(e[5]=i=>_.expire_days=i),min:1,max:365,step:1,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[27]||(e[27]=o("span",{class:"form-tip"},"天（寄售超过此天数未售出时，自动标记为流拍失败）",-1))]),_:1})]),_:1},8,["model"])),[[U,k.value]])]),_:1})]),_:1})]),_:1}),n(R,{gutter:20,style:{"margin-top":"20px"}},{default:t(()=>[n(E,{xs:24},{default:t(()=>[n(D,{class:"config-card",shadow:"hover"},{header:t(()=>[o("div",ue,[e[30]||(e[30]=o("span",{class:"card-title"},"交易结算配置",-1)),o("div",fe,[n(c,{size:"small",onClick:H,loading:h.value,icon:z(I)},{default:t(()=>e[28]||(e[28]=[u("刷新")])),_:1},8,["loading","icon"]),n(c,{size:"small",type:"primary",onClick:Q,loading:B.value},{default:t(()=>e[29]||(e[29]=[u("保存")])),_:1},8,["loading"])])])]),default:t(()=>[T((g(),y(S,{model:d,"label-width":"180px"},{default:t(()=>[n(s,{label:"配置说明"},{default:t(()=>[n(x,{type:"info",closable:!1,"show-icon":""},{default:t(()=>e[31]||(e[31]=[o("div",null,"成功卖出后，系统会自动进行交易结算：",-1),o("div",{class:"alert-tip"},"1. 本金：全额退回给卖家余额",-1),o("div",{class:"alert-tip"},"2. 利润（卖出价 - 买入价）：按配置比例分配，一部分进余额，一部分进积分",-1)])),_:1})]),_:1}),n(s,{label:"利润余额分配比例"},{default:t(()=>[n(m,{modelValue:d.profit_balance_rate,"onUpdate:modelValue":e[6]||(e[6]=i=>d.profit_balance_rate=i),min:0,max:1,step:.01,precision:2,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[32]||(e[32]=o("span",{class:"form-tip"},"例如：0.5 表示 50%",-1))]),_:1}),n(s,{label:"利润积分分配比例"},{default:t(()=>[n(m,{modelValue:d.profit_score_rate,"onUpdate:modelValue":e[7]||(e[7]=i=>d.profit_score_rate=i),min:0,max:1,step:.01,precision:2,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"]),e[33]||(e[33]=o("span",{class:"form-tip"},"例如：0.5 表示 50%",-1))]),_:1}),n(s,{label:"比例总和"},{default:t(()=>[n(K,{type:v.value>1.01||v.value<.99?"danger":"success",size:"large"},{default:t(()=>[u(Z((v.value*100).toFixed(2))+"% ",1)]),_:1},8,["type"]),v.value>1.01||v.value<.99?(g(),A("span",ce," 警告：两个比例之和必须等于1（100%） ")):(g(),A("span",me,"正确：比例总和为100%"))]),_:1})]),_:1},8,["model"])),[[U,h.value]])]),_:1})]),_:1})]),_:1})])}}}),Ce=te(pe,[["__scopeId","data-v-bfc9ef03"]]);export{Ce as default};
