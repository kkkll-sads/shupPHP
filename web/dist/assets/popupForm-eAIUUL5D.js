import{B as D,am as ee,b as F,l as te,w as E,o as oe,I as d,Z as k,O as y,D as c,P as n,_ as I,G as r,F as P,u as o,a0 as z,C as q,U as O,X as u,a9 as le,H as i,V as se,W as ie,$ as x}from"./vue-_nkvHh4F.js";import{v as re,e as ae,a5 as ne,_ as me}from"./index-DNBbsmjl.js";import{F as W}from"./index-B-1L-T0t.js";import"./index-Cl6ixW7i.js";import"./baTable-Cho2KrQQ.js";import"./index-BNmCRBQg.js";const de={class:"title"},ue={key:0,class:"pool-preview"},pe={class:"pool-preview__title"},_e={class:"pool-preview__code"},ce={class:"pool-preview__name"},ge={class:"pool-preview__sub"},fe={class:"pool-preview__metric"},be={class:"value"},ve={class:"pool-preview__metric"},Ve={class:"value"},ye={class:"pool-preview__metric"},Ce={class:"value"},we={class:"dialog-footer"},Fe=D({__name:"popupForm",setup(ke){const t=ee("baTable"),{t:f}=re.useI18n(),U=ae(),C=F(),v=F([]),V=F(void 0),j=new ne("/admin/TradingTimeConfig/"),K=l=>{const e=(l==null?void 0:l.start_time)||"",a=(l==null?void 0:l.end_time)||"",m=Number((e||"00:00").split(":")[0]),b=Number((a||"00:00").split(":")[0]);let g="pool-card--purple",_="#FAF5FF";return m>=5&&b<=12?(g="pool-card--blue",_="#F0F7FF"):m>=12&&b<=18?(g="pool-card--orange",_="#FFF7F0"):(m>=18||b<=5)&&(g="pool-card--green",_="#F0FDF4"),{code:(l==null?void 0:l.code)||"D-Asset",name:(l==null?void 0:l.title)||"资产池",subName:(l==null?void 0:l.sub_name)||"资产池",roi:(l==null?void 0:l.roi)||"+3.0%",quota:(l==null?void 0:l.quota)||"不限",themeClass:g,dataBg:_}},p=te(()=>K(t.form.items)),h=async()=>{var l;try{const e=await j.index({select:1,limit:999,where:JSON.stringify([["status","=","1"]])});e.code===1&&((l=e.data)!=null&&l.list)&&(v.value=e.data.list.map(a=>({id:a.id,label:`${a.name} (${a.start_time} - ${a.end_time})`,start_time:a.start_time,end_time:a.end_time})))}catch(e){console.error("加载时间区间配置失败:",e)}},R=l=>{if(l){const e=v.value.find(a=>a.id===l);e&&(t.form.items.start_time=e.start_time,t.form.items.end_time=e.end_time)}},H=()=>{var e,a;if(!((e=t.form.items)!=null&&e.start_time)||!((a=t.form.items)!=null&&a.end_time)){V.value=void 0;return}const l=v.value.find(m=>m.start_time===t.form.items.start_time&&m.end_time===t.form.items.end_time);V.value=l?l.id:void 0};E(()=>t.form.operate,l=>{["Add","Edit"].includes(l)&&(h(),setTimeout(()=>{H()},100))},{immediate:!0}),E(()=>{var l,e;return[(l=t.form.items)==null?void 0:l.start_time,(e=t.form.items)==null?void 0:e.end_time]},()=>{H()},{deep:!0}),oe(()=>{h()});const G={title:[{required:!0,message:"专场标题不能为空",trigger:"blur"}],code:[{required:!0,message:"资产池代码不能为空",trigger:"blur"}],roi:[{required:!0,message:"年化收益率不能为空",trigger:"blur"}],quota:[{required:!0,message:"额度不能为空",trigger:"blur"}],sub_name:[{required:!0,message:"副标题不能为空",trigger:"blur"}],start_time:[{required:!0,message:"开始时间不能为空",trigger:"change"}],end_time:[{required:!0,message:"结束时间不能为空",trigger:"change"}],status:[{required:!0,message:"状态不能为空",trigger:"change"}]};return(l,e)=>{const a=d("el-input"),m=d("el-form-item"),b=d("el-option"),g=d("el-select"),_=d("el-time-picker"),J=d("el-input-number"),L=d("el-form"),M=d("el-scrollbar"),T=d("el-button"),X=d("el-dialog"),Z=k("drag"),Q=k("zoom"),Y=k("loading");return c(),y(X,{class:"ba-operate-dialog","close-on-click-modal":!1,"destroy-on-close":!0,"model-value":["Add","Edit"].includes(o(t).form.operate),onClose:o(t).toggleForm},{header:n(()=>[I((c(),q("div",de,[x(u(o(t).form.operate?o(f)(String(o(t).form.operate)):""),1)])),[[Z,[".ba-operate-dialog",".el-dialog__header"]],[Q,".ba-operate-dialog"]])]),footer:n(()=>[r("div",we,[i(T,{onClick:o(t).toggleForm},{default:n(()=>[x(u(o(f)("Cancel")),1)]),_:1},8,["onClick"]),i(T,{type:"primary",onClick:e[12]||(e[12]=w=>o(t).onSubmit(C.value))},{default:n(()=>[x(u(o(f)("Confirm")),1)]),_:1})])]),default:n(()=>[I((c(),y(M,{class:"ba-table-form-scrollbar"},{default:n(()=>{var w,N,A,B,S,$;return[r("div",{class:z(["ba-operate-form","ba-"+o(t).form.operate+"-form"]),style:P((N=(w=o(U))==null?void 0:w.layout)!=null&&N.shrink?"":"width: calc(100% - "+(o(t).form.labelWidth||160)/2+"px)")},[p.value?(c(),q("div",ue,[r("div",{class:z(["pool-preview__head",p.value.themeClass])},[r("div",pe,[r("span",_e,u(p.value.code),1),r("span",ce,u(p.value.name),1)]),r("div",ge,u(p.value.subName),1)],2),r("div",{class:"pool-preview__body",style:P({backgroundColor:p.value.dataBg})},[r("div",fe,[e[13]||(e[13]=r("span",{class:"label"},"目标年化",-1)),r("span",be,u(p.value.roi),1)]),r("div",ve,[e[14]||(e[14]=r("span",{class:"label"},"额度",-1)),r("span",Ve,u(p.value.quota),1)]),r("div",ye,[e[15]||(e[15]=r("span",{class:"label"},"时间区间",-1)),r("span",Ce,u(((A=o(t).form.items)==null?void 0:A.start_time)||"--")+" - "+u(((B=o(t).form.items)==null?void 0:B.end_time)||"--"),1)])],4)])):O("",!0),o(t).form.loading?O("",!0):(c(),y(L,{key:1,ref_key:"formRef",ref:C,onKeyup:e[11]||(e[11]=le(s=>o(t).onSubmit(C.value),["enter"])),model:o(t).form.items,"label-position":($=(S=o(U))==null?void 0:S.layout)!=null&&$.shrink?"top":"right","label-width":(o(t).form.labelWidth||160)+"px",rules:G},{default:n(()=>[i(m,{prop:"title",label:"专场标题"},{default:n(()=>[i(a,{modelValue:o(t).form.items.title,"onUpdate:modelValue":e[0]||(e[0]=s=>o(t).form.items.title=s),type:"string",placeholder:"请输入专场标题"},null,8,["modelValue"])]),_:1}),i(W,{label:"专场图片",type:"image",modelValue:o(t).form.items.image,"onUpdate:modelValue":e[1]||(e[1]=s=>o(t).form.items.image=s),prop:"image","input-attr":{returnFullUrl:!0,limit:1}},null,8,["modelValue"]),i(m,{label:"时间区间"},{default:n(()=>[i(g,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=s=>V.value=s),placeholder:"选择时间区间（选择后自动填充开始和结束时间）",clearable:"",filterable:"",style:{width:"100%"},onChange:R},{default:n(()=>[(c(!0),q(se,null,ie(v.value,s=>(c(),y(b,{key:s.id,label:s.label,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[16]||(e[16]=r("span",{style:{"margin-left":"10px",color:"#999"}},"或手动输入下方时间",-1))]),_:1}),i(m,{prop:"start_time",label:"开始时间"},{default:n(()=>[i(_,{modelValue:o(t).form.items.start_time,"onUpdate:modelValue":e[3]||(e[3]=s=>o(t).form.items.start_time=s),format:"HH:mm","value-format":"HH:mm",placeholder:"选择开始时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),i(m,{prop:"end_time",label:"结束时间"},{default:n(()=>[i(_,{modelValue:o(t).form.items.end_time,"onUpdate:modelValue":e[4]||(e[4]=s=>o(t).form.items.end_time=s),format:"HH:mm","value-format":"HH:mm",placeholder:"选择结束时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),i(W,{label:"状态",modelValue:o(t).form.items.status,"onUpdate:modelValue":e[5]||(e[5]=s=>o(t).form.items.status=s),type:"radio",prop:"status","input-attr":{border:!0,content:{1:o(f)("Enable"),0:o(f)("Disable")}}},null,8,["modelValue","input-attr"]),i(m,{prop:"code",label:"资产池代码"},{default:n(()=>[i(a,{modelValue:o(t).form.items.code,"onUpdate:modelValue":e[6]||(e[6]=s=>o(t).form.items.code=s),type:"string",placeholder:"请输入资产池代码，如：Pool-A"},null,8,["modelValue"])]),_:1}),i(m,{prop:"roi",label:"年化收益率"},{default:n(()=>[i(a,{modelValue:o(t).form.items.roi,"onUpdate:modelValue":e[7]||(e[7]=s=>o(t).form.items.roi=s),type:"string",placeholder:"请输入年化收益率，如：+5.5%"},null,8,["modelValue"]),e[17]||(e[17]=r("span",{style:{"margin-left":"10px",color:"#999"}},"格式示例：+5.5%",-1))]),_:1}),i(m,{prop:"quota",label:"额度"},{default:n(()=>[i(a,{modelValue:o(t).form.items.quota,"onUpdate:modelValue":e[8]||(e[8]=s=>o(t).form.items.quota=s),type:"string",placeholder:"请输入额度，如：100万"},null,8,["modelValue"]),e[18]||(e[18]=r("span",{style:{"margin-left":"10px",color:"#999"}},"格式示例：100万、500万、不限",-1))]),_:1}),i(m,{prop:"sub_name",label:"副标题"},{default:n(()=>[i(a,{modelValue:o(t).form.items.sub_name,"onUpdate:modelValue":e[9]||(e[9]=s=>o(t).form.items.sub_name=s),type:"string",placeholder:"请输入副标题"},null,8,["modelValue"])]),_:1}),i(m,{prop:"sort",label:"排序"},{default:n(()=>[i(J,{modelValue:o(t).form.items.sort,"onUpdate:modelValue":e[10]||(e[10]=s=>o(t).form.items.sort=s),min:0,max:9999,"controls-position":"right",placeholder:"请输入排序值"},null,8,["modelValue"]),e[19]||(e[19]=r("span",{style:{"margin-left":"10px",color:"#999"}},"数值越大越靠前",-1))]),_:1})]),_:1},8,["model","label-position","label-width"]))],6)]}),_:1})),[[Y,o(t).form.loading]])]),_:1},8,["model-value","onClose"])}}}),Ne=me(Fe,[["__scopeId","data-v-70a17d1e"]]);export{Ne as default};
