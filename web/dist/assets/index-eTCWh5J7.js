import{b as A}from"./baTable-Cho2KrQQ.js";import{_ as K}from"./popupForm.vue_vue_type_script_setup_true_lang-C3Qh3Ks8.js";import{T as L,a as S}from"./index-Cl6ixW7i.js";import{a5 as $,ab as w,c as D,f as b,T as q}from"./index-DNBbsmjl.js";import{B as G,a as T,a1 as c,I as m,C as H,D as p,O as g,U as y,H as t,u as n,P as l,$ as d,X as u,at as O}from"./vue-_nkvHh4F.js";import"./index-B-1L-T0t.js";import"./validate-BKCUlVTv.js";import"./index-BNmCRBQg.js";const F={class:"default-main ba-table-box"},ae=G({name:"user/realName",__name:"index",setup(M){const _=new A(new $("/admin/user.RealName/"),{column:[{label:"ID",prop:"id",align:"center",operator:"=",operatorPlaceholder:"ID",width:70},{label:"用户名",prop:"username",align:"center",operator:"LIKE",operatorPlaceholder:"模糊查询"},{label:"昵称",prop:"nickname",align:"center",operator:"LIKE",operatorPlaceholder:"模糊查询"},{label:"真实姓名",prop:"real_name",align:"center",operator:"LIKE",operatorPlaceholder:"模糊查询"},{label:"身份证号",prop:"id_card",align:"center",operator:"LIKE",operatorPlaceholder:"模糊查询"},{label:"实名状态",prop:"real_name_status",align:"center",operator:"select",operatorOptions:[{label:"待审核",value:"1"},{label:"已通过",value:"2"},{label:"已拒绝",value:"3"}],render:"tag",custom:{1:"warning",2:"success",3:"danger"},replaceValue:{1:"待审核",2:"已通过",3:"已拒绝"},width:100},{label:"审核时间",prop:"audit_time",align:"center",render:"datetime",sortable:"custom",operator:"RANGE",width:160},{label:"审核备注",prop:"audit_remark",align:"center",operator:"LIKE",operatorPlaceholder:"模糊查询",show:!1},{label:"创建时间",prop:"create_time",align:"center",render:"datetime",sortable:"custom",operator:"RANGE",width:160},{label:"操作",align:"center",width:280,render:"buttons",buttons:r=>{const e=[];return e.push({render:"tipButton",name:"read",title:"查看详情",text:"",type:"primary",icon:"fa fa-eye",class:"table-row-read",display:()=>w("read"),click:()=>{I(r)}}),(r.real_name_status==1||r.real_name_status==3)&&e.push({render:"tipButton",name:"approve",title:"审核通过",text:"",type:"success",icon:"fa fa-check",class:"table-row-approve",display:()=>w("approve"),click:()=>{V(r,"approve")}}),(r.real_name_status==1||r.real_name_status==2)&&e.push({render:"tipButton",name:"reject",title:"审核拒绝",text:"",type:"warning",icon:"fa fa-times",class:"table-row-reject",display:()=>w("reject"),click:()=>{V(r,"reject")}}),e.push({render:"confirmButton",name:"delete",title:"删除",text:"",type:"danger",icon:"fa fa-trash",class:"table-row-delete",display:()=>w("del"),popconfirm:{confirmButtonText:"删除",cancelButtonText:"取消",confirmButtonType:"danger",title:"确定要删除该实名认证记录吗？删除后将清除用户的实名信息。"},click:()=>{N(r)}}),e},operator:!1}],dblClickNotEditColumn:[void 0]}),a=T({visible:!1,loading:!1,type:"approve",title:"",form:{user_id:"",username:"",real_name:"",id_card:"",id_card_front:"",id_card_back:"",audit_remark:""}}),o=T({visible:!1,data:null}),V=(r,e)=>{a.type=e,a.title=e==="approve"?"审核通过":"审核拒绝",a.form={user_id:r.id,username:r.username,real_name:r.real_name||"",id_card:r.id_card||"",id_card_front:r.id_card_front||"",id_card_back:r.id_card_back||"",audit_remark:""},a.visible=!0},B=async()=>{if(a.type==="reject"&&!a.form.audit_remark.trim()){c.warning("拒绝原因不能为空");return}a.loading=!0;try{const r=a.type==="approve"?"/admin/user.RealName/approve":"/admin/user.RealName/reject",e=await D({url:r,method:"post",data:{id:a.form.user_id,audit_remark:a.form.audit_remark}});e.code==1?(c.success(e.msg),a.visible=!1,_.getData()):c.error(e.msg)}catch(r){c.error(r.message||"操作失败")}finally{a.loading=!1}},I=async r=>{try{const e=await D({url:"/admin/user.RealName/read",method:"get",params:{id:r.id}});e.code==1?(o.data=e.data.row,o.visible=!0):c.error(e.msg)}catch(e){c.error(e.message||"获取详情失败")}},N=async r=>{try{const e=await _.api.del([r.id]);e.code==1?(c.success(e.msg||"删除成功"),_.getData()):c.error(e.msg||"删除失败")}catch(e){c.error(e.message||"删除失败")}},C=r=>({0:"未实名",1:"待审核",2:"已通过",3:"已拒绝"})[r]||"未知",E=r=>({0:"info",1:"warning",2:"success",3:"danger"})[r]||"info";return _.mount(),_.getData(),O("baTable",_),(r,e)=>{const U=m("el-alert"),k=m("el-input"),f=m("el-form-item"),v=m("el-image"),j=m("el-form"),h=m("el-button"),x=m("el-dialog"),s=m("el-descriptions-item"),P=m("el-tag"),R=m("el-descriptions");return p(),H("div",F,[n(_).table.remark?(p(),g(U,{key:0,class:"ba-table-alert",title:n(_).table.remark,type:"info","show-icon":""},null,8,["title"])):y("",!0),t(L,{buttons:["refresh","add","edit","delete","comSearch","quickSearch","columnDisplay"],"quick-search-placeholder":"快速搜索：ID/用户名/真实姓名/身份证号"}),t(S),t(K),t(x,{modelValue:a.visible,"onUpdate:modelValue":e[7]||(e[7]=i=>a.visible=i),title:a.title,width:"600px","close-on-click-modal":!1},{footer:l(()=>[t(h,{onClick:e[6]||(e[6]=i=>a.visible=!1)},{default:l(()=>e[10]||(e[10]=[d("取消")])),_:1}),t(h,{type:"primary",onClick:B,loading:a.loading},{default:l(()=>[d(u(a.type==="approve"?"通过":"拒绝"),1)]),_:1},8,["loading"])]),default:l(()=>[t(j,{model:a.form,"label-width":"100px"},{default:l(()=>[t(f,{label:"用户ID"},{default:l(()=>[t(k,{modelValue:a.form.user_id,"onUpdate:modelValue":e[0]||(e[0]=i=>a.form.user_id=i),disabled:""},null,8,["modelValue"])]),_:1}),t(f,{label:"用户名"},{default:l(()=>[t(k,{modelValue:a.form.username,"onUpdate:modelValue":e[1]||(e[1]=i=>a.form.username=i),disabled:""},null,8,["modelValue"])]),_:1}),t(f,{label:"真实姓名"},{default:l(()=>[t(k,{modelValue:a.form.real_name,"onUpdate:modelValue":e[2]||(e[2]=i=>a.form.real_name=i),disabled:""},null,8,["modelValue"])]),_:1}),t(f,{label:"身份证号"},{default:l(()=>[t(k,{modelValue:a.form.id_card,"onUpdate:modelValue":e[3]||(e[3]=i=>a.form.id_card=i),disabled:""},null,8,["modelValue"])]),_:1}),a.form.id_card_front?(p(),g(f,{key:0,label:"身份证正面"},{default:l(()=>[t(v,{src:n(b)(a.form.id_card_front),style:{width:"300px",height:"auto"},"preview-src-list":[n(b)(a.form.id_card_front)],fit:"contain"},null,8,["src","preview-src-list"])]),_:1})):y("",!0),a.form.id_card_back?(p(),g(f,{key:1,label:"身份证反面"},{default:l(()=>[t(v,{src:n(b)(a.form.id_card_back),style:{width:"300px",height:"auto"},"preview-src-list":[n(b)(a.form.id_card_back)],fit:"contain"},null,8,["src","preview-src-list"])]),_:1})):y("",!0),a.type==="reject"?(p(),g(f,{key:2,label:"审核备注"},{default:l(()=>[t(k,{modelValue:a.form.audit_remark,"onUpdate:modelValue":e[4]||(e[4]=i=>a.form.audit_remark=i),type:"textarea",rows:4,placeholder:"请输入拒绝原因"},null,8,["modelValue"])]),_:1})):(p(),g(f,{key:3,label:"审核备注"},{default:l(()=>[t(k,{modelValue:a.form.audit_remark,"onUpdate:modelValue":e[5]||(e[5]=i=>a.form.audit_remark=i),type:"textarea",rows:4,placeholder:"请输入审核备注（可选）"},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(x,{modelValue:o.visible,"onUpdate:modelValue":e[9]||(e[9]=i=>o.visible=i),title:"实名认证详情",width:"800px","close-on-click-modal":!1},{footer:l(()=>[t(h,{onClick:e[8]||(e[8]=i=>o.visible=!1)},{default:l(()=>e[11]||(e[11]=[d("关闭")])),_:1})]),default:l(()=>[o.data?(p(),g(R,{key:0,column:2,border:""},{default:l(()=>[t(s,{label:"用户ID"},{default:l(()=>[d(u(o.data.id),1)]),_:1}),t(s,{label:"用户名"},{default:l(()=>[d(u(o.data.username),1)]),_:1}),t(s,{label:"昵称"},{default:l(()=>[d(u(o.data.nickname),1)]),_:1}),t(s,{label:"手机号"},{default:l(()=>[d(u(o.data.mobile),1)]),_:1}),t(s,{label:"真实姓名"},{default:l(()=>[d(u(o.data.real_name||"--"),1)]),_:1}),t(s,{label:"身份证号"},{default:l(()=>[d(u(o.data.id_card||"--"),1)]),_:1}),t(s,{label:"实名状态"},{default:l(()=>[t(P,{type:E(o.data.real_name_status)},{default:l(()=>[d(u(C(o.data.real_name_status)),1)]),_:1},8,["type"])]),_:1}),t(s,{label:"审核时间"},{default:l(()=>[d(u(o.data.audit_time?n(q)(o.data.audit_time):"--"),1)]),_:1}),t(s,{label:"审核备注",span:2},{default:l(()=>[d(u(o.data.audit_remark||"--"),1)]),_:1}),o.data.id_card_front?(p(),g(s,{key:0,label:"身份证正面",span:2},{default:l(()=>[t(v,{src:n(b)(o.data.id_card_front),style:{width:"400px",height:"auto"},"preview-src-list":[n(b)(o.data.id_card_front)],fit:"contain"},null,8,["src","preview-src-list"])]),_:1})):y("",!0),o.data.id_card_back?(p(),g(s,{key:1,label:"身份证反面",span:2},{default:l(()=>[t(v,{src:n(b)(o.data.id_card_back),style:{width:"400px",height:"auto"},"preview-src-list":[n(b)(o.data.id_card_back)],fit:"contain"},null,8,["src","preview-src-list"])]),_:1})):y("",!0)]),_:1})):y("",!0)]),_:1},8,["modelValue"])])}}});export{ae as default};
