import{d as U,b as z}from"./baTable-C5P52-5P.js";import{T as A,a as G}from"./index-CY3WncDq.js";import{v as K,a5 as L}from"./index-BHof7fb5.js";import{B as q,a as B,a1 as b,ai as H,I as m,Z as R,C as y,D as h,O as j,U as x,H as e,u as E,P as l,_ as N,V as C,$ as r,X as n,G as S,F as W,at as X}from"./vue-BMJJ5Kg4.js";import"./index-1f7Hqibh.js";const Z={class:"default-main ba-table-box"},J={key:0,style:{"margin-top":"20px"}},ie=q({name:"collection/userCollection",__name:"index",setup(Q){const{t:$}=K.useI18n(),D=U([]);D.push({render:"tipButton",name:"detail",title:"详情",text:"",type:"primary",icon:"fa fa-eye",class:"table-row-info",disabledTip:!1,click:o=>{F(o)}},{render:"tipButton",name:"toMining",title:"转矿机",text:"",type:"danger",icon:"fa fa-cog",class:"table-row-edit",disabledTip:!1,click:o=>{M(o)},display:o=>o.mining_status===0&&o.consignment_status!==2&&o.delivery_status===0},{render:"tipButton",name:"userStats",title:"用户统计",text:"",type:"success",icon:"fa fa-user",class:"table-row-info",disabledTip:!1,click:o=>{O(o)}});const f=new z(new L("/admin/collection.UserCollection/"),{pk:"id",column:[{type:"selection",align:"center",operator:!1},{label:"ID",prop:"id",align:"center",operator:"=",operatorPlaceholder:"ID",width:70},{label:"用户ID",prop:"user_id",align:"center",operator:"=",width:80},{label:"手机号",prop:"mobile",align:"center",operator:"LIKE",operatorPlaceholder:"手机号",width:130},{label:"昵称",prop:"nickname",align:"center",operator:"LIKE",operatorPlaceholder:"昵称",width:120},{label:"藏品ID",prop:"item_id",align:"center",operator:"=",width:80},{label:"藏品名称",prop:"item_title",align:"center",operator:"LIKE",operatorPlaceholder:"藏品名称",minWidth:150},{label:"购买价格",prop:"buy_price",align:"center",operator:!1,width:100,render:o=>`<span style="color: #f56c6c; font-weight: bold;">¥${Number(o.buy_price).toFixed(2)}</span>`},{label:"当前价格",prop:"current_price",align:"center",operator:!1,width:100,render:o=>`¥${Number(o.current_price||0).toFixed(2)}`},{label:"增值",prop:"appreciation",align:"center",operator:!1,width:100,render:o=>{const c=Number(o.appreciation||0);return`<span style="color: ${c>=0?"#67c23a":"#f56c6c"};">${c>=0?"+":""}${c.toFixed(2)}</span>`}},{label:"寄售状态",prop:"consignment_status_text",align:"center",operator:"select",operatorOptions:[{label:"未寄售",value:0},{label:"寄售中",value:1},{label:"已售出",value:2}],width:100,render:"tag",replaceValue:{0:"未寄售",1:"寄售中",2:"已售出"},custom:{0:"info",1:"warning",2:"success"}},{label:"矿机状态",prop:"mining_status_text",align:"center",operator:"select",operatorOptions:[{label:"未转矿机",value:0},{label:"矿机运行中",value:1}],width:100,render:"tag",replaceValue:{0:"未转为矿机",1:"矿机运行中"},custom:{0:"info",1:"danger"}},{label:"所属专场",prop:"session_title",align:"center",width:120},{label:"确权编号",prop:"asset_code",align:"center",width:160},{label:"购买时间",prop:"buy_time",align:"center",render:"datetime",operator:"RANGE",width:160},{label:"创建时间",prop:"create_time",align:"center",render:"datetime",operator:"RANGE",width:160},{label:$("Operate"),prop:"operate",align:"center",width:200,render:"buttons",buttons:D,operator:!1}],defaultOrder:{id:"desc"}},{defaultItems:{}});X("baTable",f);const d=B({visible:!1,loading:!1,data:null}),O=async o=>{const c=(o==null?void 0:o.user_id)||0,u=(o==null?void 0:o.mobile)||"";if(!c&&!u){b.warning("请先选择一条记录");return}d.visible=!0,d.loading=!0,d.data=null;try{const s=f.api,w={};u&&(w.mobile=u),c&&(w.user_id=c);const _=await s.postData("userStats",w);_.code===1?d.data=_.data:b.error(_.msg||"获取统计失败")}catch(s){b.error(s.message||"获取统计失败")}finally{d.loading=!1}},i=B({visible:!1,loading:!1,data:null}),F=async o=>{i.visible=!0,i.loading=!0,i.data=null;try{const u=await f.api.postData("detail",{id:o.id});u.code===1?i.data=u.data:b.error(u.msg||"获取详情失败")}catch(c){b.error(c.message||"获取详情失败")}finally{i.loading=!1}},M=async o=>{try{await H.confirm("确定要将此藏品转为矿机吗？转为矿机后将强制锁仓分红，且不可逆！","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const u=await f.api.postData("toMining",{user_collection_id:o.id});u.code===1?(b.success(u.msg||"操作成功"),f.refresh()):b.error(u.msg||"操作失败")}catch(c){c!=="cancel"&&b.error(c.message||"操作失败")}};return(o,c)=>{const u=m("el-alert"),s=m("el-descriptions-item"),w=m("el-descriptions"),_=m("el-statistic"),g=m("el-col"),P=m("el-row"),p=m("el-table-column"),v=m("el-tag"),k=m("el-table"),I=m("el-dialog"),T=R("loading");return h(),y("div",Z,[E(f).table.remark?(h(),j(u,{key:0,class:"ba-table-alert",title:E(f).table.remark,type:"info","show-icon":""},null,8,["title"])):x("",!0),e(A,{buttons:["refresh","comSearch","quickSearch","columnDisplay"],"quick-search-placeholder":"快速搜索：手机号/昵称/藏品名称/确权编号"}),e(G),e(I,{modelValue:d.visible,"onUpdate:modelValue":c[0]||(c[0]=a=>d.visible=a),title:"用户藏品统计",width:"80%",top:"5vh"},{default:l(()=>[N((h(),y("div",null,[d.data?(h(),y(C,{key:0},[e(w,{column:4,border:"",style:{"margin-bottom":"20px"}},{default:l(()=>[e(s,{label:"用户ID"},{default:l(()=>{var a;return[r(n((a=d.data.user)==null?void 0:a.id),1)]}),_:1}),e(s,{label:"手机号"},{default:l(()=>{var a;return[r(n((a=d.data.user)==null?void 0:a.mobile),1)]}),_:1}),e(s,{label:"昵称"},{default:l(()=>{var a;return[r(n((a=d.data.user)==null?void 0:a.nickname),1)]}),_:1}),e(s,{label:"注册时间"},{default:l(()=>{var a;return[r(n((a=d.data.user)==null?void 0:a.create_time),1)]}),_:1})]),_:1}),e(P,{gutter:20,style:{"margin-bottom":"20px"}},{default:l(()=>[e(g,{span:4},{default:l(()=>{var a;return[e(_,{title:"藏品总数",value:((a=d.data.stats)==null?void 0:a.total_count)||0},null,8,["value"])]}),_:1}),e(g,{span:4},{default:l(()=>{var a;return[e(_,{title:"总价值",value:((a=d.data.stats)==null?void 0:a.total_value)||0,precision:2,prefix:"¥"},null,8,["value"])]}),_:1}),e(g,{span:4},{default:l(()=>{var a;return[e(_,{title:"平均价格",value:((a=d.data.stats)==null?void 0:a.avg_price)||0,precision:2,prefix:"¥"},null,8,["value"])]}),_:1}),e(g,{span:4},{default:l(()=>{var a;return[e(_,{title:"持有中",value:((a=d.data.stats)==null?void 0:a.holding)||0},null,8,["value"])]}),_:1}),e(g,{span:4},{default:l(()=>{var a;return[e(_,{title:"寄售中",value:((a=d.data.stats)==null?void 0:a.consigning)||0},null,8,["value"])]}),_:1}),e(g,{span:4},{default:l(()=>{var a;return[e(_,{title:"已售出",value:((a=d.data.stats)==null?void 0:a.sold)||0},null,8,["value"])]}),_:1}),e(g,{span:4},{default:l(()=>{var a;return[e(_,{title:"矿机中",value:((a=d.data.stats)==null?void 0:a.mining)||0},null,8,["value"])]}),_:1})]),_:1}),e(k,{data:d.data.collections||[],stripe:"",border:"","max-height":"400"},{default:l(()=>[e(p,{prop:"id",label:"记录ID",width:"80",align:"center"}),e(p,{prop:"item_id",label:"藏品ID",width:"80",align:"center"}),e(p,{prop:"title",label:"藏品名称","min-width":"150",align:"center"}),e(p,{prop:"buy_price",label:"购买价格",width:"100",align:"center"},{default:l(({row:a})=>[r("¥"+n(a.buy_price),1)]),_:1}),e(p,{prop:"current_price",label:"当前价格",width:"100",align:"center"},{default:l(({row:a})=>[r("¥"+n(a.current_price),1)]),_:1}),e(p,{prop:"appreciation",label:"增值",width:"100",align:"center"},{default:l(({row:a})=>[S("span",{style:W({color:a.appreciation>=0?"#67c23a":"#f56c6c"})},n(a.appreciation>=0?"+":"")+n(a.appreciation),5)]),_:1}),e(p,{prop:"consignment_status_text",label:"寄售状态",width:"100",align:"center"},{default:l(({row:a})=>[e(v,{type:a.consignment_status===0?"info":a.consignment_status===1?"warning":"success",size:"small"},{default:l(()=>[r(n(a.consignment_status_text),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"mining_status_text",label:"矿机状态",width:"100",align:"center"},{default:l(({row:a})=>[e(v,{type:a.mining_status===1?"danger":"info",size:"small",effect:"plain"},{default:l(()=>[r(n(a.mining_status_text),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"session_title",label:"所属专场",width:"120",align:"center"}),e(p,{prop:"buy_time_text",label:"购买时间",width:"160",align:"center"})]),_:1},8,["data"])],64)):x("",!0)])),[[T,d.loading]])]),_:1},8,["modelValue"]),e(I,{modelValue:i.visible,"onUpdate:modelValue":c[1]||(c[1]=a=>i.visible=a),title:"藏品详情",width:"70%"},{default:l(()=>{var a;return[N((h(),y("div",null,[i.data?(h(),y(C,{key:0},[e(w,{column:2,border:""},{default:l(()=>[e(s,{label:"记录ID"},{default:l(()=>{var t;return[r(n((t=i.data.row)==null?void 0:t.id),1)]}),_:1}),e(s,{label:"用户ID"},{default:l(()=>{var t;return[r(n((t=i.data.row)==null?void 0:t.user_id),1)]}),_:1}),e(s,{label:"手机号"},{default:l(()=>{var t;return[r(n((t=i.data.row)==null?void 0:t.mobile),1)]}),_:1}),e(s,{label:"昵称"},{default:l(()=>{var t;return[r(n((t=i.data.row)==null?void 0:t.nickname),1)]}),_:1}),e(s,{label:"藏品ID"},{default:l(()=>{var t;return[r(n((t=i.data.row)==null?void 0:t.item_id),1)]}),_:1}),e(s,{label:"藏品名称"},{default:l(()=>{var t;return[r(n((t=i.data.row)==null?void 0:t.title),1)]}),_:1}),e(s,{label:"购买价格"},{default:l(()=>{var t;return[r("¥"+n((t=i.data.row)==null?void 0:t.price),1)]}),_:1}),e(s,{label:"当前价格"},{default:l(()=>{var t;return[r("¥"+n((t=i.data.row)==null?void 0:t.current_price),1)]}),_:1}),e(s,{label:"发行价格"},{default:l(()=>{var t;return[r("¥"+n((t=i.data.row)==null?void 0:t.issue_price),1)]}),_:1}),e(s,{label:"所属专场"},{default:l(()=>{var t;return[r(n((t=i.data.row)==null?void 0:t.session_title),1)]}),_:1}),e(s,{label:"资产包"},{default:l(()=>{var t;return[r(n(((t=i.data.row)==null?void 0:t.package_name)||"-"),1)]}),_:1}),e(s,{label:"订单号"},{default:l(()=>{var t;return[r(n(((t=i.data.row)==null?void 0:t.order_no)||"-"),1)]}),_:1}),e(s,{label:"确权编号",span:2},{default:l(()=>{var t;return[r(n(((t=i.data.row)==null?void 0:t.asset_code)||"-"),1)]}),_:1}),e(s,{label:"购买时间"},{default:l(()=>{var t;return[r(n((t=i.data.row)==null?void 0:t.buy_time_text),1)]}),_:1}),e(s,{label:"创建时间"},{default:l(()=>{var t;return[r(n((t=i.data.row)==null?void 0:t.create_time_text),1)]}),_:1}),e(s,{label:"矿机状态"},{default:l(()=>{var t;return[e(v,{type:((t=i.data.row)==null?void 0:t.mining_status)===1?"danger":"info"},{default:l(()=>{var V;return[r(n((V=i.data.row)==null?void 0:V.mining_status_text),1)]}),_:1},8,["type"])]}),_:1}),e(s,{label:"矿机启动时间"},{default:l(()=>{var t;return[r(n(((t=i.data.row)==null?void 0:t.mining_start_time_text)||"-"),1)]}),_:1}),e(s,{label:"上次分红时间"},{default:l(()=>{var t;return[r(n(((t=i.data.row)==null?void 0:t.last_dividend_time_text)||"-"),1)]}),_:1})]),_:1}),(a=i.data.consignments)!=null&&a.length?(h(),y("div",J,[c[2]||(c[2]=S("h4",null,"寄售记录",-1)),e(k,{data:i.data.consignments,stripe:"",border:""},{default:l(()=>[e(p,{prop:"id",label:"寄售ID",width:"80",align:"center"}),e(p,{prop:"price",label:"寄售价格",width:"100",align:"center"},{default:l(({row:t})=>[r("¥"+n(t.price),1)]),_:1}),e(p,{prop:"status_text",label:"状态",width:"100",align:"center"},{default:l(({row:t})=>[e(v,{type:t.status===2?"success":t.status===1?"warning":"info",size:"small"},{default:l(()=>[r(n(t.status_text),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"create_time_text",label:"创建时间",width:"160",align:"center"}),e(p,{prop:"update_time_text",label:"更新时间",width:"160",align:"center"})]),_:1},8,["data"])])):x("",!0)],64)):x("",!0)])),[[T,i.loading]])]}),_:1},8,["modelValue"])])}}});export{ie as default};
