import{B as L,ab as R,a as T,l as k,u as d,C as l,D as o,G as i,X as p,a8 as V,V as m,W as _,F as w,$ as E,a0 as x,H as F,ac as C}from"./vue-_nkvHh4F.js";import{j as r,S,A as N,C as U,_ as $,D as j}from"./index-DNBbsmjl.js";const I=["id"],X={key:0,class:"loading"},z={key:1,class:"captcha-img-box"},M=["src","alt"],Y=["onClick"],A={key:2,class:"captcha-prompt"},G={key:3,class:"captcha-prompt"},H={class:"captcha-refresh-box"},P=["title"],W=L({__name:"index",props:{uuid:{default:""},callback:{type:Function,default:()=>{}},class:{default:""},unset:{type:Boolean,default:!1},error:{default:r.global.t("validate.The correct area is not clicked, please try again!")},success:{default:r.global.t("validate.Verification is successful!")},apiBaseURL:{default:""}},emits:["destroy"],setup(h,{emit:u}){R(e=>({"09831d2d":d(S),d491669a:D.value,"2e1ecf29":B.value,"2545ff7a":a.captcha.width,"69aaf5f3":a.captcha.height}));const t=h,a=T({loading:!0,xy:[],tip:"",captcha:{id:"",text:"",base64:"",width:350,height:200}}),f=u,g=()=>{a.loading=!0,N(t.uuid,t.apiBaseURL).then(e=>{a.xy=[],a.tip="",a.loading=!1,a.captcha=e.data})},b=e=>{if(a.xy.length<a.captcha.text.length&&(a.xy.push(e.offsetX+","+e.offsetY),a.xy.length==a.captcha.text.length)){const s=[a.xy.join("-"),e.target.width,e.target.height].join(";");U(t.uuid,s,t.unset,t.apiBaseURL).then(()=>{a.tip=t.success,setTimeout(()=>{var c;(c=t.callback)==null||c.call(t,s),y()},1500)}).catch(()=>{a.tip=t.error,setTimeout(()=>{g()},1500)})}},v=e=>{a.xy.splice(e,1)},y=()=>{f("destroy")},B=k(()=>(a.captcha.height+200)/2+"px"),D=k(()=>(a.captcha.width+24)/2+"px");return g(),(e,s)=>(o(),l("div",{id:e.uuid},[i("div",{class:x(["ba-click-captcha",t.class])},[a.loading?(o(),l("div",X,p(d(r).global.t("utils.Loading")),1)):(o(),l("div",z,[i("img",{class:"captcha-img",onClick:s[0]||(s[0]=V(c=>b(c),["prevent"])),src:a.captcha.base64,alt:d(r).global.t("validate.Captcha loading failed, please click refresh button")},null,8,M),(o(!0),l(m,null,_(a.xy,(c,n)=>(o(),l("span",{key:n,class:"step",onClick:q=>v(n),style:w(`left:${parseFloat(c.split(",")[0])-13}px;top:${parseFloat(c.split(",")[1])-13}px`)},p(n+1),13,Y))),128))])),a.tip?(o(),l("div",A,p(a.tip),1)):(o(),l("div",G,[E(p(d(r).global.t("validate.Please click"))+" ",1),(o(!0),l(m,null,_(a.captcha.text,(c,n)=>(o(),l("span",{key:n,class:x(a.xy.length>n?"clicaptcha-clicked":"")},p(c),3))),128))])),i("div",H,[s[1]||(s[1]=i("div",{class:"captcha-refresh-line captcha-refresh-line-l"},null,-1)),i("i",{class:"fa fa-refresh captcha-refresh-btn",title:d(r).global.t("Refresh"),onClick:g},null,8,P),s[2]||(s[2]=i("div",{class:"captcha-refresh-line captcha-refresh-line-r"},null,-1))])],2),i("div",{class:"ba-layout-shade",onClick:y})],8,I))}}),Z=$(W,[["__scopeId","data-v-c3370b98"]]),O=(h,u,t={})=>{const a=document.createElement("div"),f=F(Z,{uuid:h,callback:u,...t,key:j(),onDestroy:()=>{C(null,a)}});C(f,a),document.body.appendChild(a.firstElementChild)};export{O as c};
