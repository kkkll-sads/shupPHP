import{B as X,aa as Z,a as P,I as m,Z as J,C as U,D as p,H as o,P as i,_ as Q,G as u,O as _,U as Y,u as n,p as ee,X as c,a9 as V,a8 as z,$ as k,V as ae,W as ne}from"./vue-BMJJ5Kg4.js";import{c as w,v as oe,x as te,y as F,f as le,T as S,G as ie,a8 as de,_ as me}from"./index-DRv2sWQF.js";import{b as I}from"./validate-CzjpH8Rv.js";const D="/admin/routine.AdminInfo/",y=new Map([["index",D+"index"],["edit",D+"edit"],["log","/admin/auth.AdminLog/index"]]);function re(){return w({url:y.get("index"),method:"get"})}function se(g={}){return w({url:y.get("log"),method:"get",params:g})}function T(g){return w({url:y.get("edit"),method:"post",data:g},{showSuccessMessage:!0})}const ue={class:"default-main"},fe={class:"admin-info"},pe={class:"image-slot"},ce={class:"admin-info-base"},ge={class:"admin-nickname"},_e={class:"admin-other"},Ie={class:"admin-info-form"},be=X({name:"routine/adminInfo",__name:"adminInfo",setup(g){const{t}=oe.useI18n(),b=Z("formRef"),x=te(),e=P({adminInfo:{},formKey:F(),buttonLoading:!1,log:[],logFilter:{limit:12},logCurrentPage:1,logPageSize:12,logTotal:100,logLoading:!0});re().then(d=>{e.adminInfo=d.data.info,e.formKey=F(),e.logFilter.search=[{field:"admin_id",val:d.data.info.id,operator:"eq"}],v()});const v=()=>{se(e.logFilter).then(d=>{e.log=d.data.list,e.logTotal=d.data.total,e.logLoading=!1}).catch(()=>{e.logLoading=!1})},B=d=>{e.logPageSize=d,e.logFilter.limit=d,v()},K=d=>{e.logCurrentPage=d,e.logFilter.page=d,v()},R=P({nickname:[I({name:"required",title:t("routine.adminInfo.User nickname")})],email:[I({name:"email",title:t("routine.adminInfo.e-mail address")})],mobile:[I({name:"mobile",message:t("Please enter the correct field",{field:t("routine.adminInfo.phone number")})})],password:[I({name:"password"})]}),A=d=>{let a=new FormData;a.append("file",d.raw),de(a).then(r=>{r.code==1&&T({id:e.adminInfo.id,avatar:r.data.file.url}).then(()=>{x.dataFill({avatar:r.data.file.full_url}),e.adminInfo.avatar=r.data.file.full_url})})},h=()=>{var d;(d=b.value)==null||d.validate(a=>{if(a){let r={...e.adminInfo};delete r.last_login_time,delete r.username,delete r.avatar,e.buttonLoading=!0,T(r).then(()=>{x.dataFill({nickname:e.adminInfo.nickname}),e.buttonLoading=!1}).catch(()=>{e.buttonLoading=!1})}})};return(d,a)=>{const r=m("Icon"),N=m("el-image"),$=m("el-upload"),f=m("el-input"),s=m("el-form-item"),C=m("el-button"),j=m("el-form"),L=m("el-col"),E=m("el-timeline-item"),M=m("el-timeline"),q=m("el-pagination"),G=m("el-card"),O=m("el-row"),H=J("loading");return p(),U("div",ue,[o(O,{gutter:30},{default:i(()=>[o(L,{class:"lg-mb-20",xs:24,sm:24,md:24,lg:10},{default:i(()=>[u("div",fe,[n(ee)(e.adminInfo)?Y("",!0):(p(),_($,{key:0,class:"avatar-uploader",action:"","show-file-list":!1,onChange:A,"auto-upload":!1,accept:"image/gif, image/jpg, image/jpeg, image/bmp, image/png, image/webp"},{default:i(()=>[o(N,{fit:"cover",src:n(le)(e.adminInfo.avatar),class:"avatar"},{error:i(()=>[u("div",pe,[o(r,{size:"30",color:"#c0c4cc",name:"el-icon-Picture"})])]),_:1},8,["src"])]),_:1})),u("div",ce,[u("div",ge,c(e.adminInfo.nickname),1),u("div",_e,[u("div",null,c(n(t)("routine.adminInfo.Last logged in on"))+" "+c(n(S)(e.adminInfo.last_login_time)),1)])]),u("div",Ie,[(p(),_(j,{onKeyup:a[10]||(a[10]=V(l=>h(),["enter"])),key:e.formKey,"label-position":"top",rules:R,ref_key:"formRef",ref:b,model:e.adminInfo},{default:i(()=>[o(s,{label:n(t)("routine.adminInfo.user name")},{default:i(()=>[o(f,{disabled:"",modelValue:e.adminInfo.username,"onUpdate:modelValue":a[0]||(a[0]=l=>e.adminInfo.username=l)},null,8,["modelValue"])]),_:1},8,["label"]),o(s,{label:n(t)("routine.adminInfo.User nickname"),prop:"nickname"},{default:i(()=>[o(f,{placeholder:n(t)("routine.adminInfo.Please enter a nickname"),modelValue:e.adminInfo.nickname,"onUpdate:modelValue":a[1]||(a[1]=l=>e.adminInfo.nickname=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),o(s,{label:n(t)("routine.adminInfo.e-mail address"),prop:"email"},{default:i(()=>[o(f,{placeholder:n(t)("Please input field",{field:n(t)("routine.adminInfo.e-mail address")}),modelValue:e.adminInfo.email,"onUpdate:modelValue":a[2]||(a[2]=l=>e.adminInfo.email=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),o(s,{label:n(t)("routine.adminInfo.phone number"),prop:"mobile"},{default:i(()=>[o(f,{placeholder:n(t)("Please input field",{field:n(t)("routine.adminInfo.phone number")}),modelValue:e.adminInfo.mobile,"onUpdate:modelValue":a[3]||(a[3]=l=>e.adminInfo.mobile=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),o(s,{label:n(t)("routine.adminInfo.autograph"),prop:"motto"},{default:i(()=>[o(f,{onKeyup:[a[4]||(a[4]=V(z(()=>{},["stop"]),["enter"])),a[5]||(a[5]=V(z(l=>h(),["ctrl"]),["enter"]))],placeholder:n(t)("routine.adminInfo.This guy is lazy and doesn write anything"),type:"textarea",modelValue:e.adminInfo.motto,"onUpdate:modelValue":a[6]||(a[6]=l=>e.adminInfo.motto=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),o(s,{label:n(t)("routine.adminInfo.New password"),prop:"password"},{default:i(()=>[o(f,{type:"password",placeholder:n(t)("routine.adminInfo.Please leave blank if not modified"),modelValue:e.adminInfo.password,"onUpdate:modelValue":a[7]||(a[7]=l=>e.adminInfo.password=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),o(s,null,{default:i(()=>[o(C,{type:"primary",loading:e.buttonLoading,onClick:a[8]||(a[8]=l=>h())},{default:i(()=>[k(c(n(t)("routine.adminInfo.Save changes")),1)]),_:1},8,["loading"]),o(C,{onClick:a[9]||(a[9]=l=>n(ie)(n(b)))},{default:i(()=>[k(c(n(t)("Reset")),1)]),_:1})]),_:1})]),_:1},8,["rules","model"]))])])]),_:1}),Q((p(),_(L,{xs:24,sm:24,md:24,lg:12},{default:i(()=>[o(G,{header:n(t)("routine.adminInfo.Operation log"),shadow:"never"},{default:i(()=>[o(M,null,{default:i(()=>[(p(!0),U(ae,null,ne(e.log,(l,W)=>(p(),_(E,{key:W,size:"large",timestamp:n(S)(l.create_time)},{default:i(()=>[k(c(l.title),1)]),_:2},1032,["timestamp"]))),128))]),_:1}),o(q,{currentPage:e.logCurrentPage,"page-size":e.logPageSize,"page-sizes":[12,22,52,100],background:"",layout:"prev, next, jumper",total:e.logTotal,onSizeChange:B,onCurrentChange:K},null,8,["currentPage","page-size","total"])]),_:1},8,["header"])]),_:1})),[[H,e.logLoading]])]),_:1})])}}}),ke=me(be,[["__scopeId","data-v-63de0f4f"]]);export{ke as default};
