import{b as N}from"./baTable-Cho2KrQQ.js";import{T as B,a as E}from"./index-Cl6ixW7i.js";import{v as P,a5 as A}from"./index-DNBbsmjl.js";import{B as O,b as v,a1 as p,I as d,Z as S,C as q,D as u,O as _,U as m,H as r,u as b,P as t,_ as M,G as z,$ as n,X as i,at as G}from"./vue-_nkvHh4F.js";import"./index-BNmCRBQg.js";const H={class:"default-main ba-table-box"},K=O({name:"collection/matchingPool",__name:"index",setup($){const{t:c}=P.useI18n(),f=v(!1),a=v(null),s=new N(new A("/admin/collection.MatchingPool/"),{column:[{type:"selection",align:"center",operator:!1},{label:c("Id"),prop:"id",align:"center",operator:"=",operatorPlaceholder:c("Id"),width:70},{label:"藏品ID",prop:"item_id",align:"center",operator:"=",operatorPlaceholder:"藏品ID"},{label:"藏品标题",prop:"item_title",align:"center",operator:"LIKE",operatorPlaceholder:c("Fuzzy query"),render:(e=>e.item_title||"-")},{label:"时段",prop:"session_title",align:"center",render:(e=>e.session_title||"-")},{label:"用户ID",prop:"user_id",align:"center",operator:"="},{label:"用户昵称",prop:"user_nickname",align:"center",render:(e=>e.user_nickname||"-")},{label:"消耗算力",prop:"power_used",align:"center",render:(e=>Number(e.power_used).toFixed(2))},{label:"获得权重",prop:"weight",align:"center"},{label:"状态",prop:"status",align:"center",render:"tag",operator:"select",operatorOptions:[{label:"待撮合",value:"pending"},{label:"已撮合",value:"matched"},{label:"已取消",value:"cancelled"}],replaceValue:{pending:"待撮合",matched:"已撮合",cancelled:"已取消"},custom:{pending:"warning",matched:"success",cancelled:"info"}},{label:"撮合时间",prop:"match_time",align:"center",render:"datetime",operator:"RANGE",width:160},{label:"撮合订单号",prop:"match_order_no",align:"center",render:(e=>e.match_order_no||"-")},{label:c("Create time"),prop:"create_time",align:"center",render:"datetime",sortable:"custom",operator:"RANGE",width:160},{label:c("Operate"),prop:"operate",align:"center",width:150,render:"buttons",buttons:(e=>[{name:"查看详情",type:"primary",icon:"fa fa-eye",click:()=>{w(e.id)}},{name:"delete",render:"confirmButton",type:"danger",icon:"fa fa-trash",title:"确认删除该撮合记录？"}]),operator:!1}]},{defaultItems:{}}),y=e=>({pending:"warning",matched:"success",cancelled:"info"})[e]||"info",h=e=>e?new Date(e*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-",w=async e=>{try{const l=await s.api.detail({id:e});l.code===1?(a.value=l.data,f.value=!0):p.error(l.msg||"获取详情失败")}catch{p.error("获取详情失败")}},D=async()=>{var e;try{const l=await s.api.postData("clearOrphans",{});if(l.code===1){const g=((e=l.data)==null?void 0:e.cleared)??0;p.success(`已清除 ${g} 条未关联用户订单`),s.onTableHeaderAction("refresh",{})}else p.error(l.msg||"清除失败")}catch{p.error("清除失败")}};return G("baTable",s),s.mount(),s.getData(),(e,l)=>{const g=d("el-alert"),k=d("el-button"),o=d("el-descriptions-item"),I=d("el-tag"),x=d("el-descriptions"),T=d("el-dialog"),C=S("blur");return u(),q("div",H,[b(s).table.remark?(u(),_(g,{key:0,class:"ba-table-alert",title:b(s).table.remark,type:"info","show-icon":""},null,8,["title"])):m("",!0),r(B,{buttons:["refresh","comSearch","quickSearch","columnDisplay","delete"],"quick-search-placeholder":b(c)("Quick search placeholder",{fields:b(c)("Id")})},{refreshAppend:t(()=>[M((u(),_(k,{class:"table-header-operate",type:"danger",plain:"",onClick:D},{default:t(()=>l[1]||(l[1]=[z("span",{class:"table-header-operate-text"},"一键清除未关联用户订单",-1)])),_:1})),[[C]])]),_:1},8,["quick-search-placeholder"]),r(E),r(T,{modelValue:f.value,"onUpdate:modelValue":l[0]||(l[0]=V=>f.value=V),title:"撮合池详情",width:"800px","destroy-on-close":""},{default:t(()=>[a.value?(u(),_(x,{key:0,column:2,border:""},{default:t(()=>[r(o,{label:"记录ID"},{default:t(()=>[n(i(a.value.id),1)]),_:1}),r(o,{label:"状态"},{default:t(()=>[r(I,{type:y(a.value.status)},{default:t(()=>[n(i(a.value.status_text),1)]),_:1},8,["type"])]),_:1}),r(o,{label:"藏品ID"},{default:t(()=>[n(i(a.value.item_id),1)]),_:1}),r(o,{label:"藏品标题"},{default:t(()=>[n(i(a.value.item_title||"-"),1)]),_:1}),r(o,{label:"时段ID"},{default:t(()=>[n(i(a.value.session_id),1)]),_:1}),r(o,{label:"时段名称"},{default:t(()=>[n(i(a.value.session_title||"-"),1)]),_:1}),r(o,{label:"用户ID"},{default:t(()=>[n(i(a.value.user_id),1)]),_:1}),r(o,{label:"用户昵称"},{default:t(()=>[n(i(a.value.user_nickname||"-"),1)]),_:1}),r(o,{label:"消耗算力"},{default:t(()=>[n(i(a.value.power_used),1)]),_:1}),r(o,{label:"获得权重"},{default:t(()=>[n(i(a.value.weight),1)]),_:1}),a.value.match_time?(u(),_(o,{key:0,label:"撮合时间"},{default:t(()=>[n(i(h(a.value.match_time)),1)]),_:1})):m("",!0),a.value.match_order_no?(u(),_(o,{key:1,label:"撮合订单号"},{default:t(()=>[n(i(a.value.match_order_no),1)]),_:1})):m("",!0),r(o,{label:"创建时间"},{default:t(()=>[n(i(h(a.value.create_time)),1)]),_:1}),r(o,{label:"更新时间"},{default:t(()=>[n(i(h(a.value.update_time)),1)]),_:1})]),_:1})):m("",!0)]),_:1},8,["modelValue"])])}}});export{K as default};
