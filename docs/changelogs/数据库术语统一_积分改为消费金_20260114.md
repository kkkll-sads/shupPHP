# 数据库术语统一：将"积分"改为"消费金"

**执行日期**: 2026-01-14  
**类型**: 数据库Schema修改 + 数据更新  
**影响范围**: 数据库字段注释、配置项

---

## 背景

为统一系统术语，将所有"积分"相关的文本统一改为"消费金"，使用户界面和后台管理更加清晰一致。

---

## 修改内容

### 1. 数据库表字段注释更新

#### 1.1 `ba_user` 表

```sql
ALTER TABLE `ba_user` 
MODIFY COLUMN `score` decimal(10,2) unsigned NOT NULL DEFAULT '0.00' 
COMMENT '消费金余额';
```

**修改前**: 无注释  
**修改后**: `消费金余额`

---

#### 1.2 `ba_user_score_log` 表

```sql
ALTER TABLE `ba_user_score_log` 
MODIFY COLUMN `score` decimal(10,2) NOT NULL DEFAULT '0.00' 
COMMENT '消费金变动金额';
```

**修改前**: 无注释  
**修改后**: `消费金变动金额`

---

### 2. 配置表 (`ba_config`) 更新

#### 2.1 每日签到消费金

```sql
UPDATE ba_config 
SET title = '每日签到消费金', 
    tip = '用户每日签到获得的基础消费金'
WHERE name = 'sign_in_daily_score';
```

**修改前**:
- 标题: `每日签到积分`
- 提示: `用户每日签到获得的基础积分`

**修改后**:
- 标题: `每日签到消费金`
- 提示: `用户每日签到获得的基础消费金`

---

#### 2.2 直推签到奖励消费金

```sql
UPDATE ba_config 
SET title = '直推签到奖励消费金', 
    tip = '直推用户每日签到时邀请人获得的消费金'
WHERE name = 'sign_in_referrer_score';
```

**修改前**:
- 标题: `直推签到奖励积分`
- 提示: `直推用户每日签到时邀请人获得的积分`

**修改后**:
- 标题: `直推签到奖励消费金`
- 提示: `直推用户每日签到时邀请人获得的消费金`

---

#### 2.3 交易结算利润消费金分配比例

```sql
UPDATE ba_config 
SET title = '交易结算利润消费金分配比例', 
    tip = '交易结算时，利润中分配给消费金的比例（0-1之间，例如0.5表示50%）'
WHERE name = 'consignment_profit_score';
```

**修改前**:
- 标题: `交易结算利润积分分配比例`
- 提示: `交易结算时，利润中分配给积分的比例（0-1之间，例如0.5表示50%）`

**修改后**:
- 标题: `交易结算利润消费金分配比例`
- 提示: `交易结算时，利润中分配给消费金的比例（0-1之间，例如0.5表示50%）`

---

#### 2.4 分红消费金分配比例

```sql
UPDATE ba_config 
SET title = '分红消费金分配比例', 
    tip = '矿机每日分红中分配给消费金的比例（0-1之间，例如0.5表示50%）'
WHERE name = 'mining_dividend_score';
```

**修改前**:
- 标题: `分红积分分配比例`
- 提示: `矿机每日分红中分配给积分的比例（0-1之间，例如0.5表示50%）`

**修改后**:
- 标题: `分红消费金分配比例`
- 提示: `矿机每日分红中分配给消费金的比例（0-1之间，例如0.5表示50%）`

---

#### 2.5 注册奖励-消费金

```sql
UPDATE ba_config 
SET title = '注册奖励-消费金', 
    tip = '用户注册成功后自动发放的消费金奖励'
WHERE name = 'register_reward_score';
```

**修改前**:
- 标题: `注册奖励-消费金（积分）`
- 提示: `用户注册成功后自动发放的奖励`

**修改后**:
- 标题: `注册奖励-消费金`
- 提示: `用户注册成功后自动发放的消费金奖励`

---

## 已经使用"消费金"的字段（无需修改）

以下字段已经使用"消费金"术语，验证确认无需修改：

| 表名 | 字段 | 注释 |
|------|------|------|
| `ba_collection_consignment` | `payout_principal_consume` | 本金-消费金部分 |
| `ba_collection_consignment` | `payout_profit_consume` | 利润-消费金部分 |
| `ba_collection_consignment` | `payout_total_consume` | 总计-消费金 |
| `ba_collection_order` | `pay_type` | 支付方式:money=余额,score=消费金 |
| `ba_lucky_draw_prize` | `prize_type` | 奖品类型: score=消费金, ... |
| `ba_shop_order` | `total_score` | 订单总消费金 |
| `ba_shop_order` | `pay_type` | 支付方式：...score=消费金... |
| `ba_shop_order_item` | `score_price` | 商品单价（消费金） |
| `ba_shop_order_item` | `subtotal_score` | 小计消费金 |
| `ba_shop_product` | `score_price` | 消费金价格（消费金兑换） |
| `ba_shop_product` | `purchase_type` | 购买方式：...score=消费金兑换... |
| `ba_user_money_log` | `field_type` | ...score=消费金 |
| `ba_user_sign_in` | `reward_score` | 签到奖励消费金 |

---

## 统计数据

- **字段注释更新**: 2个
- **配置项更新**: 5个
- **已使用消费金术语**: 13个字段
- **执行SQL语句**: 2条
- **更新配置记录**: 5条

---

## 影响分析

### 用户端
- ✅ 无影响（用户端界面已在代码层面统一使用"消费金"）

### 管理端
- ✅ 后台配置界面显示更统一
- ✅ 配置项说明更清晰

### 数据库
- ✅ 字段名称未变（仍为 `score`）
- ✅ 历史数据不受影响
- ✅ 只修改了注释和配置文本

### 代码
- ✅ 无需修改（字段名未变）
- ✅ 查询语句不受影响
- ✅ API接口不受影响

---

## 注意事项

1. **字段名保持不变**: 数据库字段名仍为 `score`，遵循不轻易修改字段名的原则
2. **向后兼容**: 完全向后兼容，不影响现有功能
3. **缓存处理**: 配置修改后，后台配置缓存会自动更新
4. **文档同步**: 相关技术文档已同步更新

---

## 相关文档

- [矿机与分红系统说明](../features/矿机与分红系统说明.md)
- [财务架构与资金流向分析](../architecture/财务架构与资金流向分析.md)
- [money字段架构调整说明](../reference/money字段架构调整说明.md)

---

## 回滚方案

如需回滚，执行以下SQL：

```sql
-- 回滚字段注释
ALTER TABLE `ba_user` 
MODIFY COLUMN `score` decimal(10,2) unsigned NOT NULL DEFAULT '0.00' 
COMMENT '';

ALTER TABLE `ba_user_score_log` 
MODIFY COLUMN `score` decimal(10,2) NOT NULL DEFAULT '0.00' 
COMMENT '';

-- 回滚配置项（示例）
UPDATE ba_config SET title = '每日签到积分', tip = '用户每日签到获得的基础积分' WHERE name = 'sign_in_daily_score';
UPDATE ba_config SET title = '直推签到奖励积分', tip = '直推用户每日签到时邀请人获得的积分' WHERE name = 'sign_in_referrer_score';
-- ... 其他配置项
```

---

## 执行记录

- **执行人**: 系统管理员
- **执行时间**: 2026-01-14
- **验证状态**: ✅ 已验证
- **备份状态**: ✅ 数据库已备份
