# 用户资金字段对照表

## 完整字段概览（Updated 2025-12-27）

| 字段名 | 中文名 | 简述 | 核心 | 计入总资产 | 可提现 |
|--------|--------|------|------|-----------|--------|
| `money` | 总资产展示值 | **派生值（只读）**：四个真实余额池之和<br/>`balance_available + withdrawable_money + score + service_fee_balance` | ❌ 展示 | - | - |
| `balance_available` | 可用余额<br/>专项金 | • 充值流入<br/>• 退款流入<br/>• 购买优先扣款<br/>• 不可提现 | ✅ 核心 | ✅ 是 | ❌ 否 |
| `withdrawable_money` | 可提现余额 | • 成交回款<br/>• 收益分红<br/>• 奖励发放<br/>• 可提现<br/>• 购买补扣 | ✅ 核心 | ✅ 是 | ✅ 是 |
| `score` | 积分<br/>消费金 | • 利润50%<br/>• 分红50%<br/>• 商城消费<br/>• 兑换算力 | ✅ 核心 | ✅ 是 | ❌ 否 |
| `service_fee_balance` | 确权金<br/>手续费余额 | • 从其他余额划转<br/>• 寄售手续费扣除<br/>• 不可逆转 | ✅ 核心 | ✅ 是 | ❌ 否 |
| `pending_activation_gold` | 待激活金 | • 旧资产解锁门槛（≥1000）<br/>• 独立核算<br/>• 解锁后获得藏品+寄售券 | ⚪ 独立 | ❌ 否 | ❌ 否 |
| `green_power` | 绿色算力 | • 预约/撮合燃料<br/>• 注册赠送<br/>• 积分兑换 | ⚪ 功能 | ❌ 否 | ❌ 否 |
| ~~`static_income`~~ | ~~拓展提现~~ | **已废弃** → 合并至 `withdrawable_money` | ❌ 废弃 | - | - |
| ~~`dynamic_income`~~ | ~~服务金额~~ | **已废弃** → 与 `service_fee_balance` 重复 | ❌ 废弃 | - | - |

---

## 资金流向图

### 入账流向

```
充值 ────────────────────────► balance_available（可用余额）
                                     │
                                     ├─► 购买藏品（优先扣款）
                                     └─► 划转确权金 → service_fee_balance

退款 ────────────────────────► balance_available（统一退回）

成交本金 ────────────────────► withdrawable_money（可提现余额）
                                     │
利润/分红 ──┬── 50% ────────► withdrawable_money    │
            └── 50% ────────► score（消费金）       ├─► 提现
                                                      │
奖励（注册/签到/邀请）────────► withdrawable_money ──┘

商城消费 ◄──────────────────── score（消费金）

寄售手续费 ◄────────────────── service_fee_balance（确权金）

预约/撮合消耗 ◄──────────────── green_power（绿色算力）
```

### 混合支付逻辑

```
购买藏品/预约：
┌─────────────────────────────────────┐
│ 1. 优先扣除：balance_available      │
│ 2. 不足时补扣：withdrawable_money   │
└─────────────────────────────────────┘
```

---

## 使用场景对照

| 场景 | 操作字段 | 说明 |
|------|---------|------|
| **用户充值** | `balance_available` + | 全额进入可用余额 |
| **购买藏品** | `balance_available` - <br/> `withdrawable_money` - | 混合支付，优先扣可用余额 |
| **未中签退款** | `balance_available` + | 统一退回可用余额 |
| **寄售成交（卖家）** | `withdrawable_money` + <br/> `score` + | 本金+利润50%可提现<br/>利润50%消费金 |
| **每日分红** | `withdrawable_money` + <br/> `score` + | 50%可提现，50%消费金 |
| **注册奖励** | `withdrawable_money` + | 可直接提现 |
| **签到奖励（活动）** | `withdrawable_money` + | 可直接提现 |
| **签到奖励（系统）** | `score` + | 消费金 |
| **邀请奖励** | `withdrawable_money` + | 可直接提现 |
| **用户提现** | `withdrawable_money` - | 只能从可提现余额提现 |
| **商城购物** | `score` - | 使用消费金抵扣 |
| **寄售上架** | `service_fee_balance` - | 扣除手续费 |
| **充值确权金** | `balance_available` - <br/> `service_fee_balance` + | 从可用余额划转（不可逆） |
| **兑换算力** | `score` - <br/> `green_power` + | 消费金换算力 |

---

## 数据库存储

### ba_user 表字段

```sql
-- 总资产（派生值，只读展示）
money decimal(10,2) UNSIGNED DEFAULT 0.00 
  COMMENT '总资产（派生值=balance_available+withdrawable_money+score+service_fee_balance）'

-- 四个真实余额池（业务操作）
balance_available decimal(10,2) UNSIGNED DEFAULT 0.00 
  COMMENT '可用余额（专项金）：充值、退款流入，购买优先扣款'

withdrawable_money decimal(10,2) UNSIGNED DEFAULT 0.00 
  COMMENT '可提现余额：成交、收益、奖励流入，可提现'

score decimal(10,2) UNSIGNED DEFAULT 0.00 
  COMMENT '积分/消费金：利润分配、分红流入，商城消费'

service_fee_balance decimal(10,2) UNSIGNED DEFAULT 0.00 
  COMMENT '确权金/手续费余额：划转流入，寄售手续费扣除'

-- 独立字段（不计入总资产）
pending_activation_gold decimal(10,2) UNSIGNED DEFAULT 0.00 
  COMMENT '待激活金：旧资产解锁门槛，不计入总资产'

green_power decimal(10,2) UNSIGNED DEFAULT 0.00 
  COMMENT '绿色算力：预约/撮合燃料，不计入总资产'
```

---

## 业务规则总结

### 充值规则
- 充值 → `balance_available`（可用余额）
- 可用余额不可提现，只能用于购买

### 购买规则
- 优先扣除 `balance_available`
- 不足时补扣 `withdrawable_money`

### 退款规则
- 所有退款统一退回 `balance_available`

### 成交规则
- 本金 100% → `withdrawable_money`
- 利润 50% → `withdrawable_money`
- 利润 50% → `score`

### 分红规则
- 分红 50% → `withdrawable_money`
- 分红 50% → `score`

### 奖励规则
- 注册奖励 → `withdrawable_money`
- 签到奖励（活动） → `withdrawable_money`
- 签到奖励（系统） → `score`
- 邀请奖励 → `withdrawable_money`

### 提现规则
- 只能从 `withdrawable_money` 提现
- 提现时扣除 `withdrawable_money`

### 确权金规则
- 从 `balance_available` 或 `withdrawable_money` 划转
- 划转到 `service_fee_balance`
- **不可逆**：不能从确权金转回其他余额

---

## 注意事项

1. ⚠️ **money字段为只读**：永远不要直接写入money字段
2. ⚠️ **操作四个池子**：所有业务逻辑只操作四个真实余额池
3. ⚠️ **混合支付顺序**：购买时必须优先扣balance_available
4. ⚠️ **退款统一规则**：所有退款必须退回balance_available
5. ⚠️ **50/50分配**：成交利润和分红必须按50/50分配
6. ⚠️ **确权金不可逆**：划转到service_fee_balance后不能转回

---

**最后更新：** 2025-12-27  
**版本：** v2.0（money字段改造完成版）

