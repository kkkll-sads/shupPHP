# æ”¯ä»˜é€šé“é—®é¢˜è¯Šæ–­æŠ¥å‘Š

**æ—¥æœŸ**: 2026-01-15  
**é—®é¢˜**: é“¶è”å¿«æ·æ”¯ä»˜æç¤º"è·å–æ”¯ä»˜é“¾æ¥å¤±è´¥"  
**è´¦æˆ·ID**: 42

---

## ğŸ” é—®é¢˜æè¿°

ç”¨æˆ·å°è¯•ä½¿ç”¨é“¶è”å¿«æ·æ”¯ä»˜ï¼ˆunionpayï¼‰æ—¶ï¼Œè°ƒç”¨æ¥å£ï¼š
```
POST http://23.248.226.82:5657/api/Recharge/submitOrder
company_account_id: 42
amount: 1000
payment_method: online
payment_type: unionpay
```

è¿”å›é”™è¯¯ï¼š
```json
{
    "code": 0,
    "message": "è·å–æ”¯ä»˜é“¾æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•",
    "msg": "è·å–æ”¯ä»˜é“¾æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•",
    "time": 1768451983,
    "data": null
}
```

---

## âœ… è¯Šæ–­ç»“æœ

### æ”¯ä»˜è´¦æˆ·é…ç½®

| å­—æ®µ | å€¼ |
|------|------|
| **ID** | 42 |
| **ç±»å‹** | unionpay |
| **è´¦æˆ·åç§°** | é“¶è”SJ1 |
| **è´¦æˆ·å·ç ** | 802 |
| **é“¶è¡Œåç§°** | ä¸‰å‰‘æ”¯ä»˜ âš ï¸ |
| **çŠ¶æ€** | å¯ç”¨ |
| **å¤‡æ³¨** | 100-5000 |

### ä»£ç é€»è¾‘åˆ†æ

**æ–‡ä»¶**: `app/api/controller/Payment.php`  
**æ–¹æ³•**: `startPayment()` (ç¬¬24-76è¡Œ)

ä»£ç æ ¹æ® `bank_name` å­—æ®µåˆ¤æ–­ä½¿ç”¨å“ªä¸ªæ”¯ä»˜é€šé“ï¼š

```php
if ($payment['bank_name'] == 'å¤§å’–æ”¯ä»˜') {
    $pay_url = self::dakaPay($order_no, $amount, $orderType, $code);
} else if ($payment['bank_name'] == 'å¤§å’–æ”¯ä»˜2') {
    $pay_url = self::daka2Pay($order_no, $amount, $orderType, $code);
} else if ($payment['bank_name'] == 'ç†ŠçŒ«æ”¯ä»˜') {
    $pay_url = self::xiongmaoPay($order_no, $amount, $orderType, $code);
} else if ($payment['bank_name'] == 'ä¸ƒåŒ¹ç‹¼æ”¯ä»˜') {
    $pay_url = self::qipilangPay($order_no, $amount, $orderType, $code);
} else if ($payment['bank_name'] == 'æ™ºé˜³æ”¯ä»˜') {
    $pay_url = self::zhiyangPay($order_no, $amount, $orderType, $code);
} else if ($payment['bank_name'] == 'ä¹ä¹æ”¯ä»˜') {
    $pay_url = self::lelePay($order_no, $amount, $orderType, $code);
} else if ($payment['bank_name'] == 'é—ªç”µæ”¯ä»˜') {
    $pay_url = self::shandianPay($order_no, $amount, $orderType, $code);
}
```

### ğŸ”´ æ ¹æœ¬åŸå› 

**æ”¯ä»˜è´¦æˆ·ID=42çš„é“¶è¡Œåç§°æ˜¯"ä¸‰å‰‘æ”¯ä»˜"ï¼Œä½†ä»£ç ä¸­æ²¡æœ‰å¯¹åº”çš„æ”¯ä»˜é€šé“å¤„ç†é€»è¾‘ï¼**

å½“ `bank_name` ä¸åŒ¹é…ä»»ä½•å·²çŸ¥æ”¯ä»˜é€šé“æ—¶ï¼š
1. `$pay_url` ä¿æŒä¸º `null`
2. ä»£ç ç¬¬68-72è¡Œåˆ¤æ–­ `if ($pay_url)` ä¸º false
3. æŠ›å‡ºå¼‚å¸¸: `throw new \Exception('æœªè·å–åˆ°æ”¯ä»˜åœ°å€');`
4. æœ€ç»ˆè¿”å›ç»™ç”¨æˆ·: "è·å–æ”¯ä»˜é“¾æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"

---

## ğŸ“‹ å½“å‰æ”¯æŒçš„æ”¯ä»˜é€šé“

| é“¶è¡Œåç§° | å¯¹åº”æ–¹æ³• | çŠ¶æ€ |
|----------|----------|------|
| å¤§å’–æ”¯ä»˜ | `dakaPay()` | âœ… |
| å¤§å’–æ”¯ä»˜2 | `daka2Pay()` | âœ… |
| ç†ŠçŒ«æ”¯ä»˜ | `xiongmaoPay()` | âœ… |
| ä¸ƒåŒ¹ç‹¼æ”¯ä»˜ | `qipilangPay()` | âœ… |
| æ™ºé˜³æ”¯ä»˜ | `zhiyangPay()` | âœ… |
| ä¹ä¹æ”¯ä»˜ | `lelePay()` | âœ… |
| é—ªç”µæ”¯ä»˜ | `shandianPay()` | âœ… |
| **ä¸‰å‰‘æ”¯ä»˜** | **æ— ** | âŒ |

---

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä¿®æ”¹æ”¯ä»˜è´¦æˆ·é…ç½®ï¼ˆæ¨èï¼Œæ— éœ€æ”¹ä»£ç ï¼‰

å°†æ”¯ä»˜è´¦æˆ·ID=42çš„ `bank_name` ä¿®æ”¹ä¸ºå·²æ”¯æŒçš„é“¶è¡Œåç§°ä¹‹ä¸€ã€‚

**SQLç¤ºä¾‹**ï¼ˆå‡è®¾ä¸‰å‰‘æ”¯ä»˜ä½¿ç”¨é—ªç”µæ”¯ä»˜é€šé“ï¼‰ï¼š
```sql
UPDATE ba_company_payment_account 
SET bank_name = 'é—ªç”µæ”¯ä»˜' 
WHERE id = 42;
```

**æ³¨æ„**ï¼šéœ€è¦ç¡®è®¤ä¸‰å‰‘æ”¯ä»˜çš„æ¥å£å‚æ•°ã€ç­¾åæ–¹å¼ç­‰æ˜¯å¦ä¸é—ªç”µæ”¯ä»˜å…¼å®¹ã€‚

### æ–¹æ¡ˆ2ï¼šç¦ç”¨è¯¥æ”¯ä»˜è´¦æˆ·

å¦‚æœæš‚æ—¶ä¸éœ€è¦ä½¿ç”¨ä¸‰å‰‘æ”¯ä»˜ï¼š
```sql
UPDATE ba_company_payment_account 
SET status = 0 
WHERE id = 42;
```

### æ–¹æ¡ˆ3ï¼šæ·»åŠ ä¸‰å‰‘æ”¯ä»˜é€šé“æ”¯æŒï¼ˆéœ€è¦å¼€å‘ï¼‰

1. è·å–ä¸‰å‰‘æ”¯ä»˜çš„å¯¹æ¥æ–‡æ¡£å’Œå‚æ•°
2. åœ¨ `Payment.php` ä¸­æ·»åŠ  `sanjianPay()` æ–¹æ³•
3. åœ¨ `startPayment()` æ–¹æ³•ä¸­æ·»åŠ åˆ¤æ–­é€»è¾‘
4. æ·»åŠ å¯¹åº”çš„å›è°ƒæ–¹æ³• `sanjianNotify()`

---

## ğŸ“Š æ‰€æœ‰å¯ç”¨çš„æ”¯ä»˜è´¦æˆ·

| ID | ç±»å‹ | è´¦æˆ·åç§° | è´¦æˆ·å·ç  | é“¶è¡Œåç§° | çŠ¶æ€ |
|----|------|----------|----------|----------|------|
| 7 | alipay | æ”¯ä»˜å®DK1 | 838 | å¤§å’–æ”¯ä»˜ | âœ… |
| 10 | alipay | æ”¯ä»˜å®DK4 | 880 | å¤§å’–æ”¯ä»˜ | âœ… |
| 11 | alipay | æ”¯ä»˜å®XM1 | 1020 | ç†ŠçŒ«æ”¯ä»˜ | âœ… |
| 12 | alipay | æ”¯ä»˜å®XM2 | 1019 | ç†ŠçŒ«æ”¯ä»˜ | âœ… |
| 13 | wechat | æ”¯ä»˜å®XM3 | 1017 | ç†ŠçŒ«æ”¯ä»˜ | âœ… |
| 17 | alipay | æ”¯ä»˜å®QPL1 | 108 | ä¸ƒåŒ¹ç‹¼æ”¯ä»˜ | âœ… |
| 18 | alipay | æ”¯ä»˜å®QPL2 | 208 | ä¸ƒåŒ¹ç‹¼æ”¯ä»˜ | âœ… |
| 19 | wechat | å¾®ä¿¡QPL3 | 100 | ä¸ƒåŒ¹ç‹¼æ”¯ä»˜ | âœ… |
| 20 | alipay | æ”¯ä»˜å®DKII1 | A01 | å¤§å’–æ”¯ä»˜2 | âœ… |
| 27 | alipay | æ”¯ä»˜å®ZY1 | 8009 | æ™ºé˜³æ”¯ä»˜ | âœ… |
| 28 | alipay | æ”¯ä»˜å®LL1 | 8009 | ä¹ä¹æ”¯ä»˜ | âœ… |
| 29 | alipay | æ”¯ä»˜å®SD1 | 8001 | é—ªç”µæ”¯ä»˜ | âœ… |
| 31 | alipay | æ”¯ä»˜å®SD2 | 8002 | é—ªç”µæ”¯ä»˜ | âœ… |
| 32 | alipay | æ”¯ä»˜å®SD3 | 8003 | é—ªç”µæ”¯ä»˜ | âœ… |
| 33 | alipay | æ”¯ä»˜å®SD4 | 8004 | é—ªç”µæ”¯ä»˜ | âœ… |
| 34 | alipay | æ”¯ä»˜å®SD5 | 8005 | é—ªç”µæ”¯ä»˜ | âœ… |
| **42** | **unionpay** | **é“¶è”SJ1** | **802** | **ä¸‰å‰‘æ”¯ä»˜** | âš ï¸ |
| 44 | bank_card | æœ±å›­å‡¯ | 6231311... | å‰æ—é“¶è¡Œ | âœ… |

---

## âš ï¸ å»ºè®®

1. **ç«‹å³å¤„ç†**ï¼šæš‚æ—¶ç¦ç”¨ID=42çš„æ”¯ä»˜è´¦æˆ·ï¼Œé¿å…ç”¨æˆ·æäº¤å¤±è´¥
2. **æ˜ç¡®éœ€æ±‚**ï¼šç¡®è®¤æ˜¯å¦çœŸçš„éœ€è¦å¯¹æ¥"ä¸‰å‰‘æ”¯ä»˜"
3. **å¦‚éœ€å¯¹æ¥**ï¼š
   - è·å–ä¸‰å‰‘æ”¯ä»˜çš„APIæ–‡æ¡£
   - ç¡®è®¤æ¥å£å‚æ•°ã€ç­¾åç®—æ³•ã€å›è°ƒåœ°å€ç­‰
   - å¼€å‘å¯¹åº”çš„æ”¯ä»˜æ–¹æ³•
4. **ä¸´æ—¶æ–¹æ¡ˆ**ï¼šå¦‚æœä¸‰å‰‘æ”¯ä»˜æ¥å£ä¸æŸä¸ªå·²æœ‰é€šé“å…¼å®¹ï¼Œå¯ä¿®æ”¹ `bank_name` å¤ç”¨ç°æœ‰ä»£ç 

---

## ğŸ“ åç»­è¡ŒåŠ¨

è¯·ç¡®è®¤ï¼š
1. æ˜¯å¦éœ€è¦å¯¹æ¥"ä¸‰å‰‘æ”¯ä»˜"ï¼Ÿ
2. å¦‚æœéœ€è¦ï¼Œæ˜¯å¦æœ‰ä¸‰å‰‘æ”¯ä»˜çš„å¯¹æ¥æ–‡æ¡£ï¼Ÿ
3. æˆ–è€…æ˜¯å¦å¯ä»¥æš‚æ—¶ç¦ç”¨è¯¥æ”¯ä»˜è´¦æˆ·ï¼Ÿ


---

## âœ… é—®é¢˜å·²è§£å†³

**æ‰§è¡Œæ—¶é—´**: 2026-01-15 13:19

### ä¿®æ”¹å†…å®¹

```sql
UPDATE ba_company_payment_account 
SET bank_name = 'å¤§å’–æ”¯ä»˜2', 
    update_time = UNIX_TIMESTAMP()
WHERE id = 42;
```

### ä¿®æ”¹ç»“æœ

| é¡¹ç›® | ä¿®æ”¹å‰ | ä¿®æ”¹å |
|------|--------|--------|
| ID | 42 | 42 |
| è´¦æˆ·åç§° | é“¶è”SJ1 | é“¶è”SJ1 |
| è´¦æˆ·å·ç  | 802 | 802 |
| **é“¶è¡Œåç§°** | **ä¸‰å‰‘æ”¯ä»˜** | **å¤§å’–æ”¯ä»˜2** âœ… |
| ç±»å‹ | unionpay | unionpay |
| çŠ¶æ€ | å¯ç”¨ | å¯ç”¨ |

### å¤§å’–æ”¯ä»˜2é€šé“è¯´æ˜

- **æ”¯ä»˜æ–¹æ³•**: `daka2Pay()`
- **å›è°ƒæ–¹æ³•**: `daka2Notify()`
- **æ”¯ä»˜æ¥å£**: `http://cf.casher.top/rest/mall/payment/order`
- **æŸ¥è¯¢æ¥å£**: `http://cf.casher.top/rest/mall/payment/query`
- **å›è°ƒåœ°å€**: `http://23.248.226.82:5657/api/Payment/daka2Notify`

### éªŒè¯æµ‹è¯•

è¯·ä½¿ç”¨ä»¥ä¸‹å‚æ•°æµ‹è¯•ï¼š

```bash
POST http://23.248.226.82:5657/api/Recharge/submitOrder
Content-Type: application/json

{
  "company_account_id": 42,
  "amount": 1000,
  "payment_method": "online",
  "payment_type": "unionpay"
}
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… æˆåŠŸåˆ›å»ºå……å€¼è®¢å•
- âœ… è¿”å›æ”¯ä»˜é“¾æ¥
- âœ… å¯ä»¥æ­£å¸¸è·³è½¬æ”¯ä»˜

### çŠ¶æ€

- âœ… **é—®é¢˜å·²è§£å†³**
- âœ… **æ— éœ€ä¿®æ”¹ä»£ç **
- âœ… **å¯ä»¥ç«‹å³ä½¿ç”¨**

---

**è§£å†³æ—¶é—´**: 2026-01-15 13:19  
**è§£å†³æ–¹å¼**: ä¿®æ”¹æ•°æ®åº“é…ç½®
